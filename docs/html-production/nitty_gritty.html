<!doctype html><html><head><title>ct - nitty gritty</title><link rel="stylesheet" href="/css/ct.css"><link rel="stylesheet" href="/css/custom.css"> <script>var CT={"_":{"vals":{},"extReqs":{},"scriptImportCb":{},"onImport":function(fullpath){CT._.scriptImportCb[fullpath].forEach(function(cb){cb();});},"triggerOnload":function(n){(n||window)._ct_onload.forEach(function(cb){cb();});}},"info":{"page":location.pathname.slice(1,-5),"userAgent":navigator.userAgent||navigator.vendor||window.opera},"net":{"_path":"","_mode":"ct","_retry":0,"_cache":false,"_encode":true,"_spinner":false,"_scrambler":"1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ+/=_","_scramble":function(s){var s2="",sl=s.length,i,z,c=CT.net._scrambler,cl=c.length,chl=cl/2;for(i=0;i<sl;i++){z=c.indexOf(s[i]);if(z==-1)
s2+=s[i];else
s2+=c[(z+chl)%cl];}
return s2;},"_encoder":function(d){return CT.net._scramble(btoa(d));},"_decoder":function(d){return atob(CT.net._scramble(d));},"_silentFail":true,"setRetry":function(val){CT.net._retry=val;},"setMode":function(mode){if(mode!="ct"&&mode!="basic"&&mode!="passthrough"){CT.log("CT.net.setMode() - illegal mode specified: "+mode);CT.log("mode must be one of: 'ct', 'basic', 'passthrough'");}else
CT.net._mode=mode;},"setSilentFail":function(bool){CT.net._silentFail=bool;},"setScrambler":function(s){CT.net._scrambler=s;},"setSpinner":function(bool){CT.net._spinner=bool;},"setCache":function(bool){CT.net._cache=bool;},"setEncoder":function(func){CT.net._encoder=func;},"setDecoder":function(func){CT.net._decoder=func;},"fullPath":function(p){if(!CT.net._path){var s=document.getElementsByTagName("script");for(var i=0;i<s.length;i++){if(s[i].src.slice(-8)=="CT/ct.js"){CT.net._path=s[i].src.replace("CT/ct.js","");break;}}
CT.net._path=CT.net._path||"/";}
return CT.net._path+p;},"xhr":function(path,method,params,async,cb,headers,passthrough,noct,responseType){var xhr=window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"),xto=window.core&&core.config&&core.config.xhr_timeout;xhr.open(method,path,async);if(xto&&async)
xhr.timeout=xto;if(responseType)
xhr.responseType=responseType;if(!(headers&&"Content-Type"in headers))
xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var header in headers)
xhr.setRequestHeader(header,headers[header]);xhr.onreadystatechange=cb&&function(){(xhr.readyState==4)&&cb(xhr);};if(params){if(!passthrough&&CT.net._mode!="passthrough"){if(!noct&&CT.net._mode=="ct")
params=CT.net._rd(params,true);params=JSON.stringify(params);}
if(CT.net._encode&&!(params instanceof FormData||path.startsWith("http")))
params=CT.net._encoder(params);}
xhr.send(params);if(!async)
return xhr.responseText;},"_fallback_error":function(msg){if(CT.net._silentFail)
CT.log(msg);else
alert(msg);},"_u2l":function(s){return btoa(encodeURIComponent(s));},"_l2u":function(s){return decodeURIComponent(atob(s));},"_rd":function(d,enc){if(d){if(typeof d=="string")
return CT.net[(enc?"_u2l":"_l2u")](d);if(typeof d=="object"){var k,o=Array.isArray(d)?[]:{};for(k in d)
o[k]=CT.net._rd(d[k],enc);return o;}}
return d;},"_ctsuccess":function(data,signature,b64){var pl=JSON.parse(data);if(b64)pl=CT.net._rd(pl);if(CT.net._cache&&signature)
CT.storage.set(signature,pl);return pl;},"_ctresponse":function(data,signature,noenc){if(CT.net._encode&&!noenc)
data=CT.net._decoder(data);var code=data.charAt(0),result={success:!!(code%2)};data=data.slice(1);if(code=="2"||code=="3")
result.data=CT.net._rd(data);else if(result.success)
result.data=CT.net._ctsuccess(data,signature,code=="3");else
result.data=data;return result;},"_xhrcb":function(path,cb,eb,cbarg,ebarg,errMsg,signature,_500as200,noct,spinner,basic){if(CT.net._spinner||spinner){CT.net._spinner_node=CT.net._spinner_node||CT.dom.spinner();document.body.appendChild(CT.net._spinner_node);}
cb=cb||function(){};eb=eb||function(payload){CT.net._fallback_error((errMsg||"error")+": "+payload);};return function(xhr){if(xhr.status==200||(_500as200&&xhr.status==500)){if(CT.net._spinner||spinner)
CT.dom.remove(CT.net._spinner_node);var data=xhr.responseType=="blob"?xhr.response:xhr.responseText.trim();if(basic||CT.net._mode=="basic")
cb(data,cbarg);else if(!noct&&CT.net._mode=="ct"){var result=CT.net._ctresponse(data,signature,path.startsWith("http"));if(result.success)
cb(result.data,cbarg);else
eb(result.data,ebarg);}else
cb(CT.net._ctsuccess(data,signature),cbarg);}else
eb("request to "+path+" failed! ("+xhr.status+" - "+xhr.responseText+")",ebarg);};},"formData":function(data,params,dname){var fd=new FormData();if(params)for(var param in params)
fd.append(param,params[param]);fd.append(dname||"data",data);return fd;},"formUp":function(data,opts,dname){opts.params=CT.net.formData(data,opts.params,dname);opts.passthrough=true;opts.headers=opts.headers||{};opts.headers["Content-Type"]="multipart/form-data";return CT.net.post(opts);},"post":function(path,params,errMsg,cb,eb,headers,cbarg,ebarg,sync,passthrough,noct,spinner,basic,responseType,retry){if(arguments.length==1&&typeof arguments[0]!="string"){var obj=arguments[0];path=obj.path;params=obj.params;errMsg=obj.errMsg;cb=obj.cb;eb=obj.eb;headers=obj.headers;cbarg=obj.cbarg;ebarg=obj.ebarg;sync=obj.sync;passthrough=obj.passthrough;noct=obj.noct;spinner=obj.spinner;basic=obj.basic;responseType=obj.responseType;retry=obj.retry;}
var signature;if(CT.net._cache){signature=path+JSON.stringify(params);var cachedVersion=CT.storage.get(signature);if(cachedVersion)
return cb(cachedVersion,cbarg);}
retry=retry||CT.net._retry;if(retry&&retry==CT.net._retry){var origEb=eb;eb=function(msg){retry-=1;if(retry)
setTimeout(CT.net.post,(CT.net._retry-retry)*1000,path,params,errMsg,cb,eb,headers,cbarg,ebarg,sync,passthrough,noct,spinner,basic,responseType,retry);else
origEb&&origEb(msg);};}
return CT.net.xhr(path,"POST",params,!sync,CT.net._xhrcb(path,cb,eb,cbarg,ebarg,errMsg,signature,null,noct,spinner,basic),headers,passthrough,noct,responseType);},"put":function(path,params,cb,headers,passthrough,_500as200,noct,spinner,basic){CT.net.xhr(path,"PUT",params,true,CT.net._xhrcb(path,cb,null,null,null,null,null,_500as200,noct,spinner,basic),headers,passthrough,noct);},"del":function(path,params,cb,headers){CT.net.xhr(path,"DELETE",params,true,CT.net._xhrcb(path,cb),headers);},"qs":function(path,qsp){path=path||"";if(qsp){var qs=[];for(var key in qsp)
qs.push(key+"="+escape(qsp[key]));path+="?"+qs.join("&");}
return path;},"get":function(path,qsp,isjson,ctjson){var d,cachedVersion,cache=CT.net._cache&&(isjson||ctjson);path=CT.net.qs(path,qsp);if(cache){cachedVersion=CT.storage.get(path);if(cachedVersion)
return cachedVersion;}
d=CT.net.xhr(path,"GET");if(ctjson)
d=CT.net._ctresponse(d,path).data;else{if(isjson)
d=JSON.parse(d);if(cache)
CT.storage.set(path,d);}
return d;}},"scriptImport":function(modpath,cb,delay){var h=document.getElementsByTagName("head")[0],fp=(modpath.slice(0,4)=="http")&&modpath||(CT.net.fullPath(modpath.replace(/\./g,"/")+".js")),fresh=!(fp in CT._.scriptImportCb);if(fresh)
CT._.scriptImportCb[fp]=[];if(cb)
CT._.scriptImportCb[fp].push(cb);if(fresh){h.appendChild(CT.dom.script(fp));h.appendChild(CT.dom.script(null,"CT._.onImport('"+fp+"');",delay));}},"require":function(modname,lazy){if(modname.slice(0,4)=="http"||modname.startsWith("/")){if(!(modname in CT._.extReqs)){CT._.extReqs[modname]=true;eval(CT.net.get(modname));}}else{var modpath=modname.split("."),curpath,curmod=window;while(curmod&&modpath.length){curpath=modpath.shift();if(curpath in curmod)
curmod=curmod[curpath];else{modpath.unshift(curpath);modpath.forEach(function(p,i){curmod=curmod[p]={};});modpath.length=0;curmod=null;}}
if(!curmod)
eval(CT.net.get(CT.net.fullPath(modname.replace(/\./g,"/")+".js")));}
return eval(modname);},"initCSS":function(){var scfg=core.config.css,sec,sload=function(c){c.forEach(function(css){CT.dom.addStyle(null,css);});},pn=location.pathname;if(Array.isArray(scfg))
return sload(scfg);for(sec in scfg){if(sec.startsWith("!")){if(!pn.startsWith(sec.slice(1)))
sload(scfg[sec])}else if(pn.startsWith(sec))
sload(scfg[sec])}},"initCore":function(){var cfg=core.config;CT.initCSS();if(cfg.autoparse)
CT.dom.setAutoparse(cfg.autoparse);CT.layout.header(cfg.header);cfg.footer&&CT.layout.footer(cfg.footer);cfg.mobile.scale&&CT.dom.meta("viewport","width=device-width, initial-scale=1");cfg.borderbox&&CT.dom.addStyle("* {box-sizing: border-box;}");if(!cfg.modals)
cfg.modals={};if(cfg.escapeModals)
cfg.modals.escape=true;if(CT.modal){cfg.modals.escape&&CT.key&&CT.key.on("ESCAPE",CT.modal.close);CT.modal.defaults(cfg.modals);}
cfg.onload&&cfg.onload();},"setVal":function(k,v){CT._.vals[k]=v;},"getVal":function(k){return CT._.vals[k];},"clipboard":function(val,msg){var n=CT.dom.field(null,val,"transparent");document.body.appendChild(n);n.select();document.execCommand('copy');CT.dom.remove(n);alert(msg||"copied to clipboard");},"onload":function(cb,n){n=n||window;if(!n._ct_onload){n._ct_onload=[];n.addEventListener('load',function(){CT._.triggerOnload(n);});}
n._ct_onload.push(cb);},"on":function(evt,cb,node){(node||window).addEventListener(evt,cb);},"onresize":function(cb,n){CT.on("resize",cb,n);},"diffmerge":function(orig,diff){for(var k in diff){if(typeof(diff[k])=="object"){if(!orig[k])
orig[k]={};CT.diffmerge(orig[k],diff[k]);}else
orig[k]=diff[k];}},"dmerge":function(){var i,k,v,o={};for(i=arguments.length-1;i>-1;i--){if(arguments[i]){for(k in arguments[i]){v=arguments[i][k];if(v&&typeof v=="object")
o[k]=Array.isArray(v)?v.slice():CT.dmerge(v);else
o[k]=v;}}}
return o;},"merge":function(){var i,k,o={};for(i=arguments.length-1;i>-1;i--)
if(arguments[i])
for(k in arguments[i])
o[k]=arguments[i][k];return o;},"bind":function(ctx,obj){for(var p in obj){if(typeof obj[p]=="function")
obj[p]=obj[p].bind(ctx);else if(obj[p]&&typeof obj[p]=="object")
CT.bind(ctx,obj[p]);}},"Class":function(obj,parent){obj.fullInit=function(){if(parent)
parent.prototype.fullInit.apply(this,arguments);if(obj.init)
obj.init.apply(this,arguments);};var c=function(){var instance=CT.dmerge(c.prototype);CT.bind(instance,instance);if(!instance.CLASSNAME){instance.CLASSNAME="CT Class";CT.log("Class missing CLASSNAME property -- falling back to 'CT Class'");}
if(!instance.log)
instance.log=CT.log.getLogger(instance.CLASSNAME);obj.fullInit.apply(instance,arguments);return instance;};c.prototype=CT.merge(obj,parent&&parent.prototype);return c;}};CT.info.android=/Android/.test(CT.info.userAgent);CT.info.iOs=/iPhone|iPad/.test(CT.info.userAgent);CT.info.mobile=/android.+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(CT.info.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(CT.info.userAgent.substr(0,4));CT.info.iPhone=CT.info.userAgent.indexOf("iPhone")!=-1;CT.info.iPad=CT.info.userAgent.indexOf("iPad")!=-1;CT.info.androidTablet=CT.info.android&&!CT.info.mobile;CT.info.tablet=CT.info.iPad||CT.info.androidTablet;CT.info.isStockAndroid=(CT.info.userAgent.indexOf("Mozilla/5.0")!=-1)&&(CT.info.userAgent.indexOf("Android ")!=-1)&&(CT.info.userAgent.indexOf("AppleWebKit")!=-1)&&(CT.info.userAgent.indexOf("Chrome")==-1);CT.info.isMac=/Macintosh/.test(CT.info.userAgent);CT.info.isChrome=CT.info.userAgent.indexOf("Chrome")!=-1;CT.info.isFirefox=CT.info.userAgent.indexOf("Firefox")!=-1;CT.log=function(msg,level){if(CT.log._silent)
return;msg=CT.log._fix(msg);for(var i=0;i<CT.log.grep._ins.length;i++)
if(msg.indexOf(CT.log.grep._ins[i])==-1)
return;for(var i=0;i<CT.log.grep._outs.length;i++)
if(msg.indexOf(CT.log.grep._outs[i])!=-1)
return;var s=(new Date()).toLocaleTimeString().slice(0,-3);if(level)
for(var i=0;i<level;i++)
s+=" ";console.log(s,msg);};CT.log.grep=function(ins,outs){CT.log.grep._ins=ins||[];CT.log.grep._outs=outs||[];};CT.log.grep._ins=[];CT.log.grep._outs=[];CT.log._fix=function(a){return(typeof(a)=="object")?JSON.stringify(a):a;}
CT.log._silent=true;CT.log.set=function(bool){CT.log._silent=bool;};CT.log._loggerCounts={};CT.log.getLogger=function(component){var lc=CT.log._loggerCounts;if(!(component in lc))
lc[component]=0;var signature=component+" {"+lc[component]+"}";lc[component]+=1;var logger=function(){var str_arr=[];for(var i=0;i<logger.arguments.length;i++)
str_arr.push(CT.log._fix(logger.arguments[i]));CT.log("["+signature+"] "+str_arr.join(" "));};return logger;};CT.log._tcbs={};CT.log._timer=CT.log.getLogger("timer");CT.log.startTimer=function(tname,msg){CT.log._tcbs[tname]=Date.now();msg&&CT.log._timer("Initiated",tname,"with",msg);};CT.log.endTimer=function(tname,msg){var duration=(Date.now()-CT.log._tcbs[tname])/1000;CT.log._timer("Completed in",duration,"seconds:",tname,msg);};CT.event={cbs:{},unsubscribe:function(ename,cb){var cbs=CT.event.cbs;cbs[ename]&&CT.data.remove(cbs[ename],cb);},subscribe:function(ename,cb){var cbs=CT.event.cbs;if(!cbs[ename])
cbs[ename]=[];CT.data.append(cbs[ename],cb);},emit:function(ename,data){var cbs=CT.event.cbs;cbs[ename]&&cbs[ename].forEach(cb=>cb(data));}};if(!window.JSON)
CT.require("CT.lib.shims.JSON",true);if(!"sessionStorage"in window)
CT.require("CT.lib.shims.sessionStorage",true);if(!document.createElement("div").classList)
CT.require("CT.lib.shims.classList",true);if(!window.requestAnimationFrame)
CT.require("CT.lib.shims.requestAnimationFrame",true);if(!Object.values)
CT.require("CT.lib.shims.ObjectValues",true);if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)
CT.require("CT.lib.shims.getUserMedia",true);if(typeof MediaStream!=='undefined'&&!('stop'in MediaStream.prototype))
CT.require("CT.lib.shims.MediaStreamStop",true);if(!window.addEventListener)
window.addEventListener=window.attachEvent;;window.CT.all=window.CT.all||{};window.CT.Browser=window.CT.Browser||{};CT.Browser=CT.Class({CLASSNAME:"CT.Browser",_:{nodes:{},edit:function(data,noreview){var _=this._,oz=this.opts,view=this.view;CT.db.put(data,function(dfull){if(data.key){oz.saveMessage&&alert(oz.saveMessage);return noreview||view(dfull);}
_.items.push(dfull);_.tlist.postAdd(dfull,true);});},load:function(d){var _=this._,oz=this.opts,fview=this.firstview;if(d.name)
return this.view(d);CT.dom.setContent(_.nodes.content,CT.dom.div([CT.dom.div(oz.opener||("what's this "+oz.modelName+" called?"),"bigger centered"),CT.dom.smartField({classname:"w1",blurs:oz.blurs,cb:function(name){d.name=name;fview(d);}})],"margined padded bordered round"));},filter:function(){var _=this._,refresher=function(val){CT.dom.each(_.tlist,function(n,i){CT.dom[(!val||n.firstChild.innerHTML.toLowerCase().includes(val.toLowerCase()))?"show":"hide"](n);});clearbutt.style.display=val?"inline":"none";},sf=CT.dom.smartField({keyup:refresher}),clearbutt=CT.dom.span("X","hidden pointer");clearbutt.onclick=function(){sf.value="";refresher();}
return CT.dom.span([sf,clearbutt]);},build:function(items){this.items(items);var _=this._,oz=this.opts,defs={modelName:oz.modelName},defz=this.defaults,ntxt="new "+oz.modelName;if(oz.owner)
defs.owner=user.core.get("key");_.items=items;_.tlist=CT.panel.triggerList([ntxt].concat(items),function(d){_.load((d==ntxt)?CT.merge(defs,defz()):d);});CT.dom.setContent(_.nodes.list,_.tlist);var maker=CT.dom.id("tlnew"+oz.modelName),h=document.location.hash.slice(1),hd=h&&CT.data.get(h);if(hd&&hd.modelName==oz.modelName)
setTimeout(CT.dom.id("tl"+h).firstChild.onclick,200);else
maker.trigger();if(oz.filter){CT.dom.setContent(maker.firstChild,CT.dom.div("+","biggest bold shiftup"));maker.style.float="right";_.tlist.parentNode.insertBefore(CT.dom.div([_.filter(),maker],"browser_filter"),_.tlist);}},setup:function(){var _=this._,nz=_.nodes,oz=this.opts;nz.list=CT.dom.div(null,"ctlist");nz.content=CT.dom.div(null,"ctcontent");CT.dom.setContent(oz.parent,[nz.list,nz.content]);CT.db.get(oz.modelName,_.build,null,null,null,oz.owner&&{owner:user.core.get("key")});}},namer:function(d,classes){var n=CT.dom.div(d.name,"pointer "+(classes||"bigger centered"));n.onclick=function(){var sf=CT.dom.smartField({value:d.name,cb:function(name){if(name==d.name)return;CT.db.put({key:d.key,name:name},function(newd){d.name=newd.name;d.label=newd.label;CT.dom.setContent(n,d.name);CT.dom.setContent(CT.dom.id("tl"+d.key).firstChild,d.label);});}});CT.dom.setContent(n,sf);sf.focus();};return n;},view:function(d){CT.dom.setContent(_.nodes.content,[this.namer(d),JSON.stringify(d)]);},firstview:function(d){this.view(d);},defaults:function(){},items:function(items){},init:function(opts){this.opts=CT.merge(opts,{parent:"ctmain",modelName:null,nopts:{},owner:true,filter:true,blurs:["name please","title","what's it called?"]});setTimeout(this._.setup);}});;window.CT.Drop=window.CT.Drop||{};CT.Drop=CT.Class({CLASSNAME:"CT.Drop",_position:function(){var ipos=CT.align.offset(this.anchor);if(this.opts.setWidth)
this.node.style.width=(this.anchor.clientWidth+2)+"px";this.node.style.top=(ipos.top+this.anchor.clientHeight+this.opts.shiftV)+"px";this.node.style.left=(ipos.left+this.opts.shiftH)+"px";},_hide:function(){this.node.className=this.className+" hider";this.opts.onHide&&this.opts.onHide();},expand:function(cb){cb=cb||this.opts.onShow;var n=this.node,opts=this.opts;!this.opts.relative&&this._position();this.viewing=true;if(opts.constrained)
n.className=this.className+" drop-open";else{n.className=this.className;n.style.maxHeight=(opts.content.scrollHeight||1000)+"px";}
CT.trans.trans({node:n,cb:function(){if(opts.constrained)n.className+=" scrolly";cb&&cb();}});},retract:function(){if(!this.viewing)
return;this.viewing=false;this.node.className=this.className;if(!this.opts.constrained)
this.node.style.maxHeight="0px";CT.trans.trans({node:this.node,cb:this._hide});},slide:function(){if(this.viewing)
this.retract();else
this.expand();},_setAnchor:function(){if(this.opts.setClick)
this.anchor.onclick=this.slide;},init:function(opts){this.opts=opts=CT.merge(opts,{content:CT.dom.node(),parent:document.body,rows:false,shiftH:0,shiftV:0,relative:false,setClick:true,setNodeClick:true,setWidth:true,constrained:true,translucent:false,transparent:false,round:false,border:null});this.className=opts.relative?"relative drop":((opts.transparent?"backtrans":opts.translucent?"whitebacktrans":"whiteback")+" drop mosthigh");if(opts.round)
this.className+=" round";if(opts.rows)
this.className+=" drop-rows";this.anchor=opts.anchor;this.node=CT.dom.node(opts.content,null,this.className+" hider");if(opts.border)
this.node.style.border="1px solid "+opts.border;if(opts.setNodeClick)
this.node.onclick=this.slide;opts.parent.appendChild(this.node);CT.drag.makeDraggable(this.node,{constraint:"horizontal"});setTimeout(this._setAnchor);}});;window.CT.Pager=window.CT.Pager||{};CT.Pager=CT.Class({"CLASSNAME":"CT.Pager","offset":0,"limit":20,"data":[],"init":function(renderCb,requestCb,limit,nodeClass,nodeId){this.id=CT.Pager._id;CT.Pager._id+=1;this._renderCb=renderCb;this._requestCb=requestCb;if(limit)
this.limit=limit;this._build(nodeClass,nodeId);},"remove":function(d){CT.data.remove(this.data,d);this._load();},"_build":function(nodeClass,nodeId){this.content=CT.dom.node();this.next=CT.dom.button("next",this._next);this.previous=CT.dom.button("previous",this._previous);this.node=CT.dom.node([this.content,this.previous,this.next],null,nodeClass,nodeId);this.node.pager=this;this._load();},"_next":function(){this.offset+=this.limit;this._load();},"_previous":function(){this.offset-=this.limit;this._load();},"_updateButtons":function(){if(this.offset==0)
CT.dom.hide(this.previous);else if(this.offset==this.limit)
CT.dom.show(this.previous,"inline");if(this.max)
CT.dom[((this.offset+this.limit)>=this.max)?"hide":"show"](this.next,"inline");},"_render":function(){CT.dom.setContent(this.content,this._renderCb(this.data.slice(this.offset,this.offset+this.limit)));},"_refill":function(data){CT.data.addSet(data);this.data=this.data.concat(data);if(data.length<this.limit){this.max=this.data.length;this.full=true;}
this._load();},"_load":function(){if(this.full||(this.offset+this.limit)<=this.data.length){this._render();this._updateButtons();}else{this._requestCb({"limit":this.limit,"offset":this.offset},this._refill);}}});CT.Pager._id=0;;window.CT.align=window.CT.align||{};CT.align={"absers":[],"fullscreeners":[],"centerscreeners":[],"_setLeft":function(n,x){return n.style.left=(8+x)+"px";},"absed":function(node,leftpx,toppx,rightpx,bottompx){node.style.position="absolute";CT.align._setLeft(node,leftpx);if(toppx!=null)
node.style.top=toppx+"px";if(rightpx!=null)
node.style.right=rightpx+"px";if(bottompx!=null)
node.style.bottom=bottompx+"px";CT.align.absers.push([node,leftpx,toppx,rightpx,bottompx]);return node;},"centernode":function(n){if(n.scrollHeight){n.origScrollHeight=n.origScrollHeight||n.scrollHeight;var parentHeight=CT.align.height();var paddedHeight=parentHeight-100;var nodeHeight=parseInt(n.style.height)||n.origScrollHeight;if(nodeHeight>paddedHeight||nodeHeight<n.origScrollHeight){nodeHeight=Math.min(n.origScrollHeight,paddedHeight);n.style.height=nodeHeight+"px";}
n.style.top=(parentHeight-nodeHeight)/2+"px";n.style.left=(CT.align.width()/2)-(n.clientWidth/2)+"px";}},"centerall":function(){for(var i=0;i<CT.align.centerscreeners.length;i++)
CT.align.centernode(CT.align.centerscreeners[i]);},"centered":function(n){n.style.position="fixed";CT.align.centernode(n);if(CT.align.centerscreeners.indexOf(n)==-1)
CT.align.centerscreeners.push(n);return n;},"resize":function(){var abs=CT.align.absers;for(var i=0;i<abs.length;i++)
CT.align._setLeft(abs[i][0],abs[i][1]);CT.align.centerall();},"position":function(obj){var curleft=curtop=0;if(obj.offsetParent)do{curleft+=obj.offsetLeft;curtop+=obj.offsetTop;}while(obj=obj.offsetParent);return[curleft,curtop];},"offset":function(n){var o={"top":0,"left":0};while(n){if(n==(CT.dom.ALLNODE||document.body))
break;o["top"]+=n.offsetTop;o["left"]+=n.offsetLeft;n=n.offsetParent;}
return o;},"height":function(n){return n?n.clientHeight:window.innerHeight;},"width":function(n){return n?n.clientWidth:window.innerWidth;}};;window.CT.autocomplete=window.CT.autocomplete||{};CT.autocomplete.Guesser=CT.Class({CLASSNAME:"CT.autocomplete.Guesser",targets:[],_doNothing:function(){},_returnTrue:function(){return true;},tapTag:function(data){this.opts.tapCb(data);this.retract();},addTag:function(data){var n=CT.dom.node(data.label,"div","tagline","ac"+data.label.replace(/ /g,""));data.label.toLowerCase().split(" ").forEach(function(word){for(var i=1;i<=word.length;i++)
n.className+=" "+word.slice(0,i);});this.node.firstChild.appendChild(n);this.targets.push(n);n.onclick=function(){this.tapTag(data);}.bind(this);},guesser:function(frag){this._update(this.opts.data.filter(function(d){var i,parts=d.label.toLowerCase().split(" ");for(i=0;i<parts.length;i++)
if(parts[i].slice(0,frag.length)==frag)
return true;}));},_hide:function(){this.node.className=this.className+" hider";this.opts.onHide&&this.opts.onHide();this.input.blur();},_upOne:function(d){if(!CT.dom.id("ac"+d.label.replace(/ /g,"")))
this.addTag(d);},_update:function(data){data.forEach(this._upOne);},_onUp:function(e){if(!this.viewing){this.opts.expandCb();CT.dom.mod({className:"tagline",show:true});this.expand(function(){this.input.active=true;this.input.focus();}.bind(this));return true;}},_unselect:function(){if(this.selection){this.selection.classList.remove("drop-selection");this.selection=null;}},_select:function(godown){if(this.targets.length){var index=this.targets.indexOf(this.selection);index+=godown?1:-1;if(index<0)
index=this.targets.length-1;else if(index>=this.targets.length)
index=0;this._unselect();this.selection=this.targets[index];this.selection.classList.add("drop-selection");this.selection.scrollIntoViewIfNeeded();}},_onKeyUp:function(e){e=e||window.event;var code=e.keyCode||e.which;if(code==27)
return this._retract();if(code==38||code==40)
this._select(code==40);else if(code==13||code==3){if(this.selection){this.selection.onclick();this._unselect();this.targets.length=0;}else{this.input.blur();this.opts.enterCb(this.input.value);}}else if(this.input.value){var tagfrag=this.input.value.toLowerCase();this.targets=CT.dom.className(tagfrag,this.node);this._unselect();CT.dom.mod({className:"tagline",hide:true});if(this.targets.length)
CT.dom.mod({className:tagfrag,show:true});else
this.opts.guessCb(tagfrag,this._update);if(!this.viewing)
this.expand();}else CT.dom.mod({className:"tagline",hide:true});this.opts.keyUpCb();},_onTap:function(data){this.input.value=data.label;this.input.onenter&&this.input.onenter();},_focus:function(){this.input.focus();},_retract:function(){this._unselect();this.targets.length=0;this.retract();setTimeout(this._focus,500);},_waitRetract:function(){this._unselect();this.targets.length=0;setTimeout(this.retract,500);},init:function(opts){this.opts=opts=CT.merge(opts,{rows:true,setClick:false},this.opts,{enterCb:this._doNothing,keyUpCb:this._doNothing,expandCb:this._doNothing,tapCb:this._onTap,guessCb:this.guesser,anchor:opts.input,data:[]});if(opts.rows&&this.className.indexOf("drop-rows")==-1){this.className+=" drop-rows";this.node.classList.add("drop-rows");}
opts.data=opts.data.map(function(d){return typeof d=="string"?{label:d}:d;});CT.autocomplete.Guesser.id+=1;this.id=CT.autocomplete.Guesser.id;this.input=this.anchor=opts.input;CT.gesture.listen("down",this.input,this._returnTrue);CT.gesture.listen("up",this.input,this._onUp);this.input.addEventListener("keyup",this._onKeyUp);this.input.addEventListener("blur",this._waitRetract);}},CT.Drop);CT.autocomplete.Guesser.id=0;CT.autocomplete.DBGuesser=CT.Class({CLASSNAME:"CT.autocomplete.DBGuesser",guesser:function(frag){var filters=CT.merge(this.opts.filters);filters[this.opts.property]={comparator:"like",value:frag+"%"};CT.db.get(this.opts.modelName,this._update,null,null,null,filters);}},CT.autocomplete.Guesser);;window.CT.bound=window.CT.bound||{};CT.bound={_:{keys:{},opts:{mode:"storage",storage:{},db:{}},set:function(data){var _=CT.bound._,oz=_.opts,dboz=oz.db,params,fulld;CT.data.add(data);fulld=CT.data.get(data.key);if(oz.mode=="storage")
CT.storage.set(data.key,fulld);else{params={action:"edit",data:data};if(dboz.pw)
params.pw=dboz.pw;CT.net.post({path:"/_db",params:params});}
return fulld;},load:function(key){if(!CT.data.get(key)){if(CT.bound._.opts.mode=="storage")
CT.data.add(CT.storage.get(key)||{key:key});else
CT.db.one(key);}}},register:function(key,node,constructor){var _=CT.bound._,kz=_.keys;node._constructor=constructor;if(!kz[key]){kz[key]=[];_.load(key);}
kz[key].push(node);},mutate:function(data){var _=CT.bound._,fulld=_.set(data);(_.keys[data.key]||[]).forEach(function(node){CT.dom.setContent(node,node._constructor(fulld));});},init:function(opts){var _=CT.bound._,opts=_.opts=CT.merge(opts,_.opts);if(opts.mode=="storage")
CT.storage.init(opts.storage);}};;window.CT.cal=window.CT.cal||{};CT.cal={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],stamp:function(day,date,month,year){return CT.cal.days[day]+" "+CT.cal.months[month]+" "+date+" "+year;},slot:function(tslot,appz,unslot){var year=tslot.when.getFullYear(),month=tslot.when.getMonth(),date=tslot.when.getDate(),day=tslot.when.getDay(),aod,amy,amyd,mdate,pfunc=CT.data[unslot?"remove":"append"];if(tslot.schedule=="daily")
pfunc(appz.daily,tslot);else if(tslot.schedule=="weekly")
pfunc(appz.weekly[day],tslot);else if(tslot.schedule=="offday"){aod=appz.offday[day];if(!aod[tslot.taskkey])
aod[tslot.taskkey]=[];pfunc(aod[tslot.taskkey],tslot);}else if(tslot.schedule=="monthly (date)"){mdate=appz.monthly_date[date]=appz.monthly_date[date]||[];pfunc(mdate,tslot);}else if(tslot.schedule=="monthly (day)")
pfunc(appz.monthly_day[day],tslot);else{amy=appz[tslot.schedule][month][year];if(!amy)
amy=appz[tslot.schedule][month][year]={};amyd=appz[tslot.schedule][month][year][date];if(!amyd)
amyd=appz[tslot.schedule][month][year][date]={};if(!amyd[tslot.taskkey])
amyd[tslot.taskkey]=[];pfunc(amyd[tslot.taskkey],tslot);}}};CT.cal.Cal=CT.Class({CLASSNAME:"CT.cal.Cal",_:{shift:function(diff){this.opts.now.setMonth(this.opts.now.getMonth()+diff);this.orient();},update:function(d){var n=this.opts.now,orient=this.orient;return function(){n.setFullYear(d.getFullYear());n.setMonth(d.getMonth());n.setDate(d.getDate());orient();};},slots:function(task,appz){task.timeslots.forEach(function(tslot){tslot.task=task;tslot.taskkey=task.task?task.task.key:task.key;tslot.when=new Date(tslot.when);CT.cal.slot(tslot,appz);});},slot:function(slot,dobj,cslots,isov){var ukey=window.user&&user.core.get("key"),uslots=cslots.filter(function(c){return c.task.steward.key==ukey;}),comms=cslots.map(function(s){return s.task;}),volunteers=comms.map(function(comm){var fn=comm.steward.firstName;if(comm.steward.key==ukey)
fn+=" (you)";return fn;}).join(", "),opts=this.opts,task=slot.task,taskname=task.name||task.task.name,adata,iseditor=task.editors.includes(ukey),amod,hmsg="volunteer for ",oflo=this._.oflo(slot),duration=slot.duration+" hours",time=slot.when.toTimeString().slice(0,5);if(iseditor)
hmsg="edit or "+hmsg;hmsg+=taskname;if(isov){duration=oflo+" hours ("+duration+" total)";time="00:00";}else if(oflo)
duration=(slot.duration-oflo)+" hours ("+duration+" total)";return CT.hover.set({auto:true,content:hmsg,node:CT.dom.div([[CT.dom.span(time),CT.dom.pad(),CT.dom.span(taskname),CT.dom.pad(),CT.dom.span(duration,"small")],CT.dom.div(volunteers,"small")],"appointment",null,{onclick:function(e){adata=[CT.dom.div(taskname,"bigger"),task.description,slot.duration+" hours"];if(iseditor){adata.unshift(CT.dom.link("edit",function(){opts.click.edit(slot,dobj);},null,"right padded"));}
["steps","requirements"].forEach(function(slist){if(task[slist]&&task[slist].length){adata.push([CT.dom.div(slist,"big"),task[slist]]);}});adata.push(CT.dom.div("Participate","big"));adata.push(volunteers||"no participants yet!");if(opts.click.volunteer)
adata.push(opts.click.volunteer(slot,dobj,uslots));if(iseditor&&opts.click.exception&&(slot.schedule!="once"))
adata.push(opts.click.exception(slot,dobj));amod=CT.modal.modal(CT.dom.div(adata,"subpadded5"),null,{onclick:function(){amod.hide();}});e.stopPropagation();}})});},oflo:function(s){var w=s.when;return Math.max(0,w.getHours()+w.getMinutes()/60+s.duration-24);}},slot:function(tslot){CT.cal.slot(tslot,this._.appointments);},unslot:function(tslot){CT.cal.slot(tslot,this._.appointments,true);},commit:function(tslot){CT.cal.slot(tslot,this._.commitments);},uncommit:function(tslot){CT.cal.slot(tslot,this._.commitments,true);},day:function(date,month,year){var _=this._,opts=this.opts,tname,n,tk,dayslots,appz=_.appointments,commz=_.commitments,dobj=new Date(year,month,date),day=dobj.getDay(),week=Math.ceil(date/7);slots=appz.daily.slice().concat(appz.weekly[day].slice()).concat((appz.monthly_date[date]||[]).slice()),cslots=commz.daily.slice().concat(commz.weekly[day].slice()).concat((commz.monthly_date[date]||[]).slice()),emoyeda=appz.exception[month][year][date]||{},cemoyeda=commz.exception[month][year][date]||{},oncers=appz.once[month][year][date]||{},concers=commz.once[month][year][date]||{},mday=appz.monthly_day[day],cmday=commz.monthly_day[day],offday=appz.offday[day],overflow=_.overflow;for(tname in oncers)
slots=slots.concat(oncers[tname]);for(tname in concers)
cslots=cslots.concat(concers[tname]);slots=slots.concat(mday.filter(function(slot){return Math.ceil(slot.when.getDate()/7)==week;}));cslots=cslots.concat(cmday.filter(function(slot){return Math.ceil(slot.when.getDate()/7)==week;}));slots.sort(function(a,b){return a.when.toTimeString()>b.when.toTimeString()?1:-1;});cslots=cslots.filter(function(slot){var steward=slot.task.steward.key,exz=cemoyeda[slot.taskkey]||[];for(var i=0;i<exz.length;i++)
if(exz[i].task.steward.key==steward)
return false;return true;});dayslots=slots.filter(function(slot){tk=slot.taskkey;return(!emoyeda[tk]||!emoyeda[tk].length)&&(!offday[tk]||!offday[tk].length);});_.overflow=dayslots.filter(_.oflo);n=CT.dom.div([CT.dom.div(date,"right relative above"),CT.dom.div(overflow.concat(dayslots).map(function(slot,i){return _.slot(slot,new Date(dobj.getTime()),cslots.filter(function(s){return s.task.task.key==slot.task.key;}),i<overflow.length);}),"abs all0")],(date==opts.now.getDate())&&"today");if(opts.click.date){n.classList.add("pointer");n.onclick=function(){opts.click.date(date,month,year);};CT.hover.set({auto:true,node:n,content:"register a task for "+CT.cal.months[month]+" "+date});}else if(opts.update)
n.onclick=_.update(dobj);return n;},days:function(){var _=this._,opts=this.opts,now=opts.now,year=now.getFullYear(),month=now.getMonth(),offset=new Date(year,month).getDay(),last=new Date(year,month+1,0).getDate(),prevlast=new Date(year,month,0).getDate(),i,appz=_.appointments,commz=_.commitments,dayz=CT.cal.days.map(function(day,di){var daynode=CT.dom.div(day);if(opts.click.day){daynode.classList.add("pointer");daynode.onclick=function(){opts.click.day(day,di);};CT.hover.set({auto:true,node:daynode,content:"register a weekly task for "+day});}
return daynode;});_.overflow=[];["once","exception"].forEach(function(variety){[appz,commz].forEach(function(section){if(!section[variety][month][year])
section[variety][month][year]={};});});for(i=offset-1;i>-1;i--)
dayz.push(CT.dom.div(prevlast-i,"other"));for(i=1;i<=last;i++)
dayz.push(this.day(i,month,year));i=0;while(dayz.length%7)
dayz.push(CT.dom.div(++i,"other"));return dayz;},month:function(){var _=this._,shift=_.shift,now=this.opts.now;return CT.dom.div([CT.dom.button("previous",function(){shift(-1);}),CT.dom.span(CT.cal.months[now.getMonth()]+" "+now.getFullYear(),"biggerest bold"),CT.dom.button("next",function(){shift(1);})],"centered");},stewardship:function(steward,task,commitment){steward.commitments=steward.commitments||{};if(commitment){commitment.task=task;steward.commitments[task.name]=commitment;}else
return steward.commitments[task.name];},unsteward:function(steward,task,commitment){delete steward.commitments[task.name];},commitment:function(commitment,task){this.stewardship(commitment.steward,task,commitment);this._.slots(commitment,this._.commitments);},appointment:function(task){var thaz=this;this._.slots(task,this._.appointments);task.commitments.forEach(function(comm){thaz.commitment(comm,task);});},appointments:function(){this.opts.appointments.forEach(this.appointment);},orient:function(){CT.dom.setContent(this.node,[CT.dom.div(this.month(),"month"),CT.dom.div(this.days(),"days")]);},build:function(){this.appointments();this.orient();},load:function(){var opts=this.opts,tasks=opts.appointments,builder=this.build,slots=[],commitments=[],cslots=[],uslots=[];if(opts.timeslots=="data")
return builder();tasks.forEach(function(task){slots=slots.concat(task.timeslots);commitments=commitments.concat(task.commitments);});CT.db.multi(slots.concat(commitments),function(objz){tasks.forEach(function(task){task.timeslots=task.timeslots.map(function(tskey){return CT.data.get(tskey);});task.commitments=task.commitments.map(function(ckey){var c=CT.data.get(ckey);cslots=cslots.concat(c.timeslots);uslots.push(c.steward);return c;});});CT.db.multi(cslots.concat(uslots),function(objz2){tasks.forEach(function(task){task.commitments.forEach(function(commitment){commitment.steward=CT.data.get(commitment.steward);commitment.timeslots=commitment.timeslots.map(function(tskey){return CT.data.get(tskey);});});});builder();});});},setNode:function(){var oz=this.opts;this.node=CT.dom.div(null,"cal");this.node.cal=this;this.node.value=function(){return oz.now.toDateString();};},init:function(opts){this.opts=opts=CT.merge(opts,{now:new Date(),timeslots:"key",appointments:[],update:false,click:{}});var _=this._,appz;["appointments","commitments"].forEach(function(aname){appz=_[aname]={};appz.daily=[];appz.weekly=CT.cal.days.map(function(d){return[];});appz.offday=CT.cal.days.map(function(d){return{};});appz.once=CT.cal.months.map(function(m){return{};});appz.exception=CT.cal.months.map(function(m){return{};});appz.monthly_day=CT.cal.days.map(function(d){return[];});appz.monthly_date=[];});this.setNode();this.load();}});;window.CT.canvas=window.CT.canvas||{};window.CT.canvas.Canvas=window.CT.canvas.Canvas||{};CT.canvas.Canvas=CT.Class({"CLASSNAME":"CT.canvas.Canvas","_":{"controllers":{},"propagate":function(ename,args){var _c=this._.vars.controllers,cname,c,rval;for(cname in _c){c=_c[cname];rval=c[ename].apply(c,args)||rval;}
return rval;},"on":{"up":function(){this._.propagate("up");},"hover":function(pos){this._.propagate("hover",[this._.where(pos)]);},"down":function(pos){this.canvas.noDrag=this._.propagate("down",[this._.where(pos)]);},"drag":function(dir,dist,dx,dy,dt){this._.propagate("drag",[dir,dist,dx,dy,dt]);}},"where":function(e){var xo=this.canvas.offsetLeft+this.view.offsetLeft,yo=this.canvas.offsetTop+this.view.offsetTop;return{x:e.x+this.view.scrollLeft-xo,y:e.y+this.view.scrollTop-yo};}},"draw":function(dt){this._.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var k in this._.controllers)
this._.controllers[k].draw(this._.ctx);},"render":function(){if(!this.canvas)return;requestAnimationFrame(this.render);var now=new Date().getTime(),deltaTime=now-(this.startTime||now);this.startTime=now;this.draw(deltaTime);},"dismantle":function(){if(this.canvas){CT.gesture.unlisten('hover',this.canvas);CT.gesture.unlisten('drag',this.canvas);CT.gesture.unlisten('down',this.canvas);CT.gesture.unlisten('up',this.canvas);CT.dom.remove(this.canvas);this.canvas=null;}},"build":function(){this.canvas=CT.dom.node("","canvas","","",{"width":this._.vars.width,"height":this._.vars.height});this._.ctx=this.canvas.getContext('2d');CT.gesture.listen('hover',this.canvas,this._.on.hover);CT.gesture.listen('drag',this.canvas,this._.on.drag);CT.gesture.listen('down',this.canvas,this._.on.down);CT.gesture.listen('up',this.canvas,this._.on.up);this._.vars.zoom&&CT.gesture.pinch2zoom(this.canvas);},"register":function(name,controller){var _v=this._.vars,_co=this._.controllers,_d=controller.getDimensions();_co[name]=controller;_v.width=Math.max(_v.width,_d.width);_v.height=Math.max(_v.height,_d.height);if(this.canvas){this.canvas.width=_v.width;this.canvas.height=_v.height;}},"init":function(vars){this._.vars=CT.merge(vars,{"width":CT.align.width(vars.view),"height":CT.align.height(vars.view),"controllers":{},"zoom":false});for(var cname in this._.vars.controllers)
this.register(cname,this._.vars.controllers[cname]);this.view=this._.vars.view;this.build();}});;window.CT.canvas.Controller=window.CT.canvas.Controller||{};CT.canvas.Controller=CT.Class({"CLASSNAME":"CT.canvas.Controller","nodes":[],"nodesByName":{},"_":{"on":{"up":function(node){},"hover":function(node){},"down":function(node){},"drag":function(node){}},"propagate":function(ename,args){var rval;if(this._.vars.input)this.nodes.forEach(function(n){rval=n[ename].apply(n,args)&&n||rval;});if(rval)
this._.on[ename](rval);return rval;},bounds:function(normalize){var n,padding=this._.vars.padding,endNodeX,endNodeY,maxX=maxY=minX=minY=0;this.nodes.forEach(function(node){n=node._.vars;endNodeX=n.x+n.width;endNodeY=n.y+n.height;if(maxX<endNodeX+padding)
maxX=endNodeX+padding;if(maxY<endNodeY+padding)
maxY=endNodeY+padding;if(minX==0||(n.x-padding)<minX)
minX=n.x-padding;if(minY==0||(n.y-padding)<minY)
minY=n.y-padding;});normalize&&this.nodes.forEach(function(n){n.move(-minX,-minY);});this._.vars.width=maxX-minX;this._.vars.height=maxY-minY;}},"getDimensions":function(){return{"width":this._.vars.width,"height":this._.vars.height};},"on":function(evt,cb){this._.on[evt]=cb;},"up":function(){this.selected=null;return this._.propagate("up");},"hover":function(pos){return this._.propagate("hover",[pos]);},"down":function(pos){this.selected=this._.propagate("down",[pos]);return this.selected;},"drag":function(dir,dist,dx,dy,dt){if(this.selected&&this._.vars.draggable){this.selected.move(dx,dy);return true;}},"get":function(name){return this.nodesByName[name];},"draw":function(ctx){this.nodes.forEach(function(n){n.draw(ctx);});},"addNode":function(n){this.nodes.push(n);this.nodesByName[n._.vars.name]=n;},"rmNode":function(n){CT.data.remove(this.nodes,n);delete this.nodesByName[n.name];},"init":function(vars){var v=this._.vars=CT.merge(vars,{"input":true,"draggable":true,"normalize":true,"padding":5});v.nodes.forEach(this.addNode);if(v.dimensions){v.width=v.dimensions.width;v.height=v.dimensions.height;delete v.dimensions;}else
this._.bounds(v.normalize);}});;window.CT.canvas.Node=window.CT.canvas.Node||{};CT.canvas.Node=CT.Class({"CLASSNAME":"CT.canvas.Node","_":{"mids":function(){var _v=this._.vars;_v.mids={};_v.mids.x=_v.x+(_v.width/2);_v.mids.y=_v.y+(_v.height/2);},"draw_box":function(ctx){var _v=this._.vars,gradient,x=_v.x,y=_v.y,r=_v.radius,width=_v.width,height=_v.height,lineWidth=_v.over?(2*_v.border):_v.border,radius={tl:r,tr:r,br:r,bl:r};ctx.strokeStyle=_v.selected?_v.color_selected:_v.color_unselected;ctx.lineWidth=_v.selected?(2*lineWidth):lineWidth;ctx.beginPath();ctx.moveTo(x+radius.tl,y);ctx.lineTo(x+width-radius.tr,y);ctx.quadraticCurveTo(x+width,y,x+width,y+radius.tr);ctx.lineTo(x+width,y+height-radius.br);ctx.quadraticCurveTo(x+width,y+height,x+width-radius.br,y+height);ctx.lineTo(x+radius.bl,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height-radius.bl);ctx.lineTo(x,y+radius.tl);ctx.quadraticCurveTo(x,y,x+radius.tl,y);ctx.closePath();gradient=ctx.createLinearGradient(x,y,x,y+height);gradient.addColorStop(0,"white");gradient.addColorStop(1,_v.color);ctx.fillStyle=gradient;ctx.shadowColor=_v.shadowColor;ctx.shadowBlur=_v.shadowBlur;ctx.shadowOffsetX=_v.shadowOffsetX;ctx.shadowOffsetY=_v.shadowOffsetY;ctx.fill();ctx.stroke();}},"components":{},"move":function(x,y){this._.vars.x+=x;this._.vars.y+=y;this._.mids();},"contains":function(e){var x=this._.vars.x,y=this._.vars.y,w=this._.vars.width,h=this._.vars.height;return((e.x>=x)&&(e.x<=x+w)&&(e.y>=y)&&(e.y<=y+h));},"hover":function(e){this._.vars.over=this.contains(e);},"up":function(e){},"down":function(e){this._.vars.selected=this.contains(e);return this._.vars.selected&&this;},"build":function(){},"draw":function(ctx){var v=this._.vars,c=this.components;this.build();v.box&&this._.draw_box(ctx);v.drawOrder.forEach(function(component){c[component](ctx);});},"init":function(vars){this.id=CT.canvas.Node.id;CT.canvas.Node.id+=1;this._.vars=CT.merge(vars,{"inputPadding":5,"border":1,"radius":5,"box":true,"over":false,"selected":false,"color_selected":"red","color_unselected":"#0023AA","shadowColor":"99AAAA","shadowBlur":10,"shadowOffsetX":4,"shadowOffsetY":4,"drawOrder":Object.keys(this.components)});this._.mids();}});CT.canvas.Node.id=0;;window.CT.canvas.Text=window.CT.canvas.Text||{};CT.canvas.Text=CT.Class({"CLASSNAME":"CT.canvas.Text","components":{"text":function(ctx){var _v=this._.vars,i=0,line='',lines=[],x=_v.x+_v.padding,y=_v.y+_v.padding,width=_v.width-_v.padding*2,height=_v.height-_v.padding*2,lineHeight=_v.lineHeight,words=_v.label.split(' '),yStart,xStart,lastMetrics,testLine,metrics,testWidth;ctx.shadowColor=_v.textShadowColor;ctx.shadowBlur=_v.textShadowBlur;ctx.shadowOffsetX=_v.textShadowOffsetX;ctx.shadowOffsetY=_v.textShadowOffsetY;ctx.fillStyle=_v.fillStyle;ctx.textBaseline=_v.textBaseline;for(;i<words.length;++i){testLine=!line?words[i]:line+' '+words[i];metrics=ctx.measureText(testLine);lastMetrics=lastMetrics||metrics;testWidth=metrics.width;if(testWidth>width&&i>0){xStart=x+(width-lastMetrics.width)/2;lines.push({"line":line,"xStart":xStart});line=words[i];lastMetrics=ctx.measureText(line);}else{lastMetrics=metrics;line=testLine;}
if(i==words.length-1){lastMetrics=ctx.measureText(line);xStart=x+(width-lastMetrics.width)/2;lines.push({"line":line,"xStart":xStart});}}
yStart=y+(height-lineHeight*lines.length)/2;ctx.font=_v.font;lines.forEach(function(l){ctx.fillText(l.line,l.xStart,yStart);yStart+=lineHeight;});}},"init":function(){this._.vars=CT.merge(this._.vars,{"padding":7,"lineHeight":12,"fillStyle":"black","textBaseline":"top","textShadowColor":"none","textShadowBlur":0,"textShadowOffsetX":0,"textShadowOffsetY":0,"font":"Bold 8pt Sans-Serif"});this._.vars.label=this._.vars.label.replace(/(?:\r\n|\r|\n)/g,' ');}},CT.canvas.Node);;;window.CT.chat=window.CT.chat||{};Date.prototype.stdTimezoneOffset=function(){var jan=new Date(this.getFullYear(),0,1);var jul=new Date(this.getFullYear(),6,1);return Math.max(jan.getTimezoneOffset(),jul.getTimezoneOffset());};Date.prototype.dst=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset();};CT.chat={"currentRoom":null,"windowIsActive":null,"chatBoxStyle":null,"lastHash":null,"flashBackTimeout":null,"flashTabTimeout":null,"orig_background":null,"orig_title":document.title,"groups":{},"rooms":{},"roomData":{},"settings":{"CHAT_TITLE_STYLE":'chatname',"NO_INFO_MSG":" is a mystery!","defaults":{},"require":[],"timezone_offset":0,"location":{"host":location.hostname,"port":8888},"data":{"path":"/_db","prop":"key","props":"keys","params":{"action":"get"}},"classes":{"presence":"bold bottompadded"},"on":{"roomSelect":function(room){}}},_:{cbs:{}},"focusChatInput":function(){var chatinput=CT.dom.id("chatin"+CT.chat.currentRoom);if(chatinput)
chatinput.focus();else
setTimeout(CT.chat.focusChatInput,500);},"flashBack":function(flashColor){if(!CT.chat.chatBoxStyle){CT.chat.chatBoxStyle=CT.dom.id("chatbox").style;CT.chat.orig_background=CT.chat.chatBoxStyle.background;}
if(CT.chat.windowIsActive){CT.chat.chatBoxStyle.background=CT.chat.orig_background;document.location.hash="ux";}
else{CT.chat.chatBoxStyle.background=(CT.chat.chatBoxStyle.background!=CT.chat.orig_background)?CT.chat.orig_background:flashColor;CT.chat.flashBackTimeout=setTimeout(CT.chat.flashBack,1000,flashColor);}},"clearTab":function(){clearTimeout(CT.chat.flashTabTimeout);document.title=CT.chat.orig_title;},"flashTab":function(message){if(CT.chat.windowIsActive){document.title=CT.chat.orig_title;CT.chat.lastHash=null;var ifr=CT.dom.id("canchatiframe");if(ifr)CT.dom.getLoc(ifr).hash="ux";}
else{document.title=(document.title!=CT.chat.orig_title)?CT.chat.orig_title:message;CT.chat.flashTabTimeout=setTimeout(CT.chat.flashTab,1000,message);}},"chatWidgetOpened":function(){if(CT.chat.chatBoxStyle){clearTimeout(CT.chat.flashBackTimeout);CT.chat.chatBoxStyle.background=CT.chat.orig_background;}
CT.chat.focusChatInput();},"guestCheck":function(key,uid){if(CT.data.get(key))
return;if(key.indexOf("guest")!=-1){CT.data.add(CT.merge({"key":key,"firstName":key.replace("[guest]",""),"lastName":"(guest)"},CT.chat.settings.defaults));}
else if(key==uid){CT.data.add(CT.merge({"key":uid},CT.chat.settings.defaults));}},"udata":function(key,cb){var s=CT.chat.settings;CT.data.require(key,cb,s.require,s.data.path,s.data.params,s.data.prop);},"userSpotlight":function(key,uspot,isWidget,noFocus){CT.chat.udata(key,function(u){var content=[CT.dom.div(u.firstName+" "+u.lastName,"bold")];if(u.img)
content.unshift(CT.dom.img(u.img,"right hm1 wm1-2"));if(u.blurb)
content.push(CT.parse.shortened(u.blurb,100,15,true));CT.dom.setContent(uspot,content);!noFocus&&CT.chat.focusChatInput();});},"privateChatName":function(key1,key2){return[key1,key2].sort().join('').replace(/ /g,"");},"scrollOutie":function(){var outie=CT.chat.rooms[CT.chat.currentRoom].outie;outie.scrollTop=outie.scrollHeight;setTimeout(function(){outie.scrollTop=outie.scrollHeight;},1000);},"selectRoomCb":function(room,isWidget,userKey){return function(){var rd=CT.chat.roomData[room];rd.pending=0;if(userKey){var sameNames=document.getElementsByClassName("presence"+userKey);for(var i=0;i<sameNames.length;i++)
sameNames[i].firstChild.innerHTML=rd.name;}else
CT.dom.id(rd.key).firstChild.innerHTML=rd.name;CT.chat.currentRoom=room;var pbutt=CT.chat._.pbutt;(pbutt||isWidget)?(pbutt||CT.dom.id("peopleButton")).onclick():CT.chat.settings.on.roomSelect(room);CT.chat.scrollOutie();CT.chat.focusChatInput();};},"addUser":function(key,channel_name,uspot,isWidget,uid){if(key==uid&&channel_name.indexOf(key)!=-1)
return;var u=CT.data.get(key);if(!u.fullName){u.fullName=u.firstName+" "+u.lastName;CT.chat.loadChatRoom(uid,u.fullName,CT.chat._.presence||CT.dom.id(isWidget?"presence":"chsides"),uspot,isWidget,key);}
var cp=CT.chat.rooms[channel_name].presence;var userLinkId="presence"+channel_name+key;if(cp&&!CT.dom.id(userLinkId)){var chatkey=CT.chat.privateChatName(uid,key);var privateChatCallback=CT.chat.selectRoomCb(chatkey,isWidget,key);cp.appendChild(CT.dom.node(CT.dom.link(u.fullName,function(){CT.chat.userSpotlight(u.key,uspot,isWidget,true);if(key!=uid){CT.panel.swap(chatkey,true,"ch",true);privateChatCallback();}}),"div","presence"+key,userLinkId));}
CT.chat.roomData[channel_name].presence[key]=true;},"say":function(key,payload,datetime,outie){payload=CT.parse.process(payload);var u=CT.data.get(key);var ts=CT.dom.node(" ["+CT.parse.timeStamp(datetime)
+"]","i","small gray");outie.appendChild(CT.dom.node([CT.dom.node(u.fullName,"b"),ts,CT.dom.node(": "+payload,"span")]));CT.chat.scrollOutie();setInterval(function(){ts.innerHTML=" ["+CT.parse.timeStamp(datetime)+"]";},60000);},"loadChatWidget":function(uid,roomname,outie,innie,presence,uspot,isWidget){CT.chat.rooms[roomname]={"outie":outie,"innie":innie,"presence":presence};if(!CT.pubsub.isInitialized()){var setz=CT.chat.settings;var onMessage=function(frame){if(frame.channel!=CT.chat.currentRoom&&frame.user!=uid){var rd=CT.chat.roomData[frame.channel];rd.pending+=1;var newStr="<b>"+rd.name+" ("+rd.pending+")</b>";;if(frame.channel==CT.chat.privateChatName(uid,frame.user)){var sameNames=document.getElementsByClassName("presence"+frame.user);for(var i=0;i<sameNames.length;i++)
sameNames[i].firstChild.innerHTML=newStr;}
else
CT.dom.id(rd.key).firstChild.innerHTML=newStr;}
CT.chat.udata(frame.user,function(frameUser){var flasher=frameUser.firstName+" says...";if(!CT.chat.windowIsActive&&frame.user!=uid){if(isWidget){location.hash='u'+flasher;CT.chat.flashBack("lightgray");}
else
CT.chat.flashTab(flasher);}
CT.chat.userSpotlight(frame.user,uspot,isWidget,true);CT.chat.say(frame.user,frame.message,frame.datetime,CT.chat.rooms[frame.channel].outie);});};CT.pubsub.connect(location.hostname=="localhost"?"localhost":setz.location.host,setz.location.port,uid);CT.pubsub.set_cb("open",function(){for(var r in CT.chat.rooms)
CT.chat.rooms[r].outie.appendChild(CT.dom.node("connected"));});CT.pubsub.set_cb("close",function(){for(var r in CT.chat.rooms)
CT.chat.rooms[r].outie.appendChild(CT.dom.node("connection closed"));});CT.pubsub.set_cb("error",function(){for(var r in CT.chat.rooms)
CT.chat.rooms[r].outie.appendChild(CT.dom.node("error :-\\"));});CT.pubsub.set_cb("subscribe",function(s){var channel_name=s.channel;var needed=s.presence;for(var i=0;i<s.history.length;i++)
CT.data.append(needed,s.history[i].user);CT.data.requireAll(needed,function(){for(var i=0;i<s.presence.length;i++)
CT.chat.addUser(s.presence[i],channel_name,uspot,isWidget,uid);CT.chat.userSpotlight((channel_name.indexOf(uid)!=-1)?channel_name.replace(uid,""):s.presence[0],uspot,isWidget,true);s.history.forEach(onMessage);},uid,setz.require,setz.data.path,setz.data.params,setz.data.props);});CT.pubsub.set_cb("join",function(channel,uname){CT.chat.udata(uname,function(){if(!CT.chat.roomData[channel].presence[uname])
CT.chat.addUser(uname,channel,uspot,isWidget,uid);});});CT.pubsub.set_cb("leave",function(channel,uname){var pnode=CT.chat.rooms[channel].presence;pnode&&pnode.removeChild(CT.dom.id("presence"+channel+uname));delete CT.chat.roomData[channel].presence[uname];});CT.pubsub.set_cb("message",onMessage);}
CT.pubsub.subscribe(roomname);innie.onkeydown=function(e){if(innie.value=="")
return;e=e||window.event;var code=e.keyCode||e.which;if(code==13||code==3){CT.pubsub.publish(roomname,CT.parse.sanitize(innie.value));innie.value="";}};},"loadChatRoom":function(uid,cname,chsides,uspot,isWidget,userKey){var cappedname=CT.parse.words2title(cname);var nospace=userKey?CT.chat.privateChatName(uid,userKey):cappedname.replace(/ /g,"");if(userKey)
cname=nospace;CT.chat.roomData[cname]={"key":"chitem"+nospace,"name":cappedname,"pending":0,"presence":{}};var thispanel=CT.dom.node("","div","chpanel hidden","chpanel"+nospace);var titler=CT.chat._.titler;thispanel.appendChild(CT.dom.node(titler?titler(cappedname,userKey):cappedname,"div","bigger bold bottompadded nowrap "+CT.chat.settings.CHAT_TITLE_STYLE));var cout=CT.dom.node("","div","chatout","chatout"+cname);var cin=CT.dom.field("chatin"+cname,"","chatin");thispanel.appendChild(cout);thispanel.appendChild(cin);CT.chat._.main.appendChild(thispanel);var thisside=CT.dom.node("","div","chpanel hidden","chpanel"+nospace+"Side");if(userKey)
thisside.appendChild(CT.dom.node(CT.parse.process(CT.data.map[userKey].blurb,true)||(cappedname+CT.chat.settings.NO_INFO_MSG),"div","small gray scrollsmall"));else{thisside.appendChild(CT.dom.div("Chatting Users",CT.chat.settings.classes.presence));var cpresence=CT.dom.node("","div","small");thisside.appendChild(cpresence);}
chsides.appendChild(thisside);CT.chat.loadChatWidget(uid,cname,cout,cin,cpresence,uspot,isWidget);return cappedname;},"loadChatGroup":function(uid,rooms,pnode,noclear,chsides,uspot,isWidget){var _=CT.chat._;var cappedrooms=[];var cbs=[];for(var i=0;i<rooms.length;i++){var cr=CT.chat.loadChatRoom(uid,rooms[i],chsides,uspot,isWidget);CT.chat.groups[rooms[i]]=cr;cappedrooms.push(cr);var cb=CT.chat.selectRoomCb(rooms[i],isWidget);_.cbs[rooms[i]]=cb;cbs.push(cb);}
CT.chat.currentRoom=rooms[0];CT.panel.load(cappedrooms,true,"ch",pnode,_.main,null,null,noclear,null,cbs);},"setNode":function(n,which){CT.chat._[which||"main"]=n;return n;},"expander":function(widget){var exp=CT.dom.link("expand chat",function(){exp._expanded=!exp._expanded;CT.dom.setContent(exp,(exp._expanded?"shrink":"expand")+" chat");widget.classList[exp._expanded?"add":"remove"]("expanded");},null,"abs r0 b0 big bold abover");CT.dom.addContent("ctmain",exp);},"widget":function(uid,rooms,channels_name,title_cb){var peeps=CT.chat.setNode(CT.dom.button("People"),"pbutt"),places=CT.dom.button(channels_name||"Places"),buttons=CT.dom.div([peeps,places],"ct_chat_buttons"),channels=CT.dom.div(null,"ct_chat_channels"),presence=CT.chat.setNode(CT.dom.div(null,"ct_chat_presence"),"presence"),spot=CT.dom.div(null,"ct_chat_spot"),people=CT.dom.div([presence,spot],"ct_chat_people hidden"),side=CT.dom.div([buttons,people,channels],"ct_chat_side"),main=CT.chat.setNode(CT.dom.div(null,"ct_chat_main")),full=CT.dom.div([side,main],"ct_chat_widget");CT.chat._.titler=title_cb;CT.chat.init();CT.chat.loadChatGroup(uid,rooms,channels,true,presence,spot);peeps.onclick=function(){CT.dom.show(people);CT.dom.hide(channels);CT.chat.focusChatInput();};places.onclick=function(){CT.dom.hide(people);CT.dom.show(channels);CT.chat.focusChatInput();};setTimeout(function(){CT.panel.swap(rooms[0],true,"ch");CT.chat._.cbs[rooms[0]]();});CT.chat.expander(full);return full;},init:function(){var cfg=core&&core.config&&core.config.chat;if(cfg&&cfg.port)
CT.chat.settings.location.port=cfg.port;CT.data.requirePrep=CT.chat.guestCheck;window.onfocus=function(){CT.chat.windowIsActive=true;};window.onblur=function(){CT.chat.windowIsActive=false;};}};;window.CT.data=window.CT.data||{};CT.data={map:{},"sameList":function(list1,list2){if(list1.length!=list2.length)
return false;for(var i=0;i<list1.length;i++){if(list1[i]!=list2[i])
return false;}
return true;},"copyList":function(oldlist){var newlist=[];for(var i=0;i<oldlist.length;i++)
newlist.push(oldlist[i]);return newlist;},"diff":function(dold,dnew,required,compdicts,submap,complists){var ddiff=required||{};compdicts=compdicts||[];complists=complists||[];submap=submap||{};for(var k in dnew){if(compdicts.indexOf(k)!=-1){for(var j in dnew[k]){if(dnew[k][j]!=dold[k][j]){ddiff[k]=dnew[k];break;}}}
else if(complists.indexOf(k)!=-1){if(!CT.data.sameList(dnew[k],dold[k]))
ddiff[k]=dnew[k];}
else if(k in submap){if(dnew[k]!=dold[k][submap[k]])
ddiff[k]=dnew[k];}
else if(dnew[k]!=dold[k])
ddiff[k]=dnew[k];}
return ddiff;},"append":function(arr,el){if(arr.indexOf(el)==-1)
arr.push(el);},"remove":function(arr,el){var elindex=arr.indexOf(el);if(elindex!=-1)
return arr.splice(elindex,1);},"sum":function(arr){return arr.length?arr.reduce(function(a,b){if(Array.isArray(a)){return a.map(function(v,i){return v+b[i];});}
return a+b;}):arr;},"alpha":function(arr,prop){return arr.sort(function(a,b){if(prop){a=a[prop];b=b[prop];}
return(a<b)?-1:(a>b)?1:0;});},"has":function(key){return!!CT.data.map[key];},"get":function(key){return CT.data.map[key];},"add":function(d){if(CT.data.map[d.key]){for(var k in d)
CT.data.map[d.key][k]=d[k];}
else
CT.data.map[d.key]=d;},"addSet":function(dlist){for(var i=0;i<dlist.length;i++)
CT.data.add(dlist[i]);},"getSet":function(klist){return klist.map(CT.data.get);},"uniquify":function(items,exceptions){exceptions=exceptions||[];items=CT.data.copyList(items);items.sort();var newitems=[];var latestitem="";for(var i=0;i<items.length;i++){if(items[i]!=latestitem&&exceptions.indexOf(items[i])==-1){latestitem=items[i];newitems.push(latestitem);}}
return newitems;},"copy":function(str){var f=CT.dom.field(null,str,"transparent");document.body.appendChild(f);f.select();if(document.execCommand('copy')){alert("Link saved to clipboard. Great!");f.remove();}else{f.className="";CT.modal.modal(CT.dom.div(["Ctr-C to Copy URL",f],"centered"));setTimeout(function(){f.select();});}},"numstr":function(len){var s="",chunk;while(len){chunk=Math.min(len,16);s+=""+CT.data.random(Math.pow(10,chunk));len-=chunk;}
return s;},"random":function(max){return Math.floor(Math.random()*max);},"choice":function(arr){return arr[CT.data.random(arr.length)];},"checkAndDo":function(keys,cb,nlcb,eb,req,getpath,getparams){var needed=[];keys=CT.data.uniquify(keys);for(var i=0;i<keys.length;i++){if(CT.data.map[keys[i]]==null||req&&CT.data.map[keys[i]][req]==null)
needed.push(keys[i]);}
if(needed.length==0)
return cb();getparams=getparams||{"gtype":"data"};getparams.keys=needed;CT.net.post(getpath||"/get",getparams,"error retrieving data",function(rawdata){CT.data.addSet(rawdata);if(nlcb)nlcb(needed);cb();},eb);},"requirePrep":function(){},"itemReady":function(key,plist){var isready=key in CT.data.map;plist&&plist.forEach(function(p){isready=isready&&p in CT.data.map[key];});return isready;},"require":function(key,cb,plist,getpath,getparams,getprop){CT.data.requirePrep(key);if(CT.data.itemReady(key,plist))
cb(CT.data.get(key));else{getparams=getparams||{"gtype":"user","chat":1};getparams[getprop||"uid"]=key;CT.net.post(getpath||"/get",getparams,"error retrieving data",function(rawdata){CT.data.add(rawdata);cb(CT.data.get(key));});}},"requireAll":function(keys,cb,uid,plist,getpath,getparams,getprop){keys.forEach(CT.data.requirePrep);var needed=[];for(var i=0;i<keys.length;i++){if(!CT.data.itemReady(keys[i],plist))
needed.push(keys[i]);}
if(needed.length==0)
cb(keys);else{getparams=getparams||{"gtype":"user","chat":1};getparams[getprop||"uids"]=needed;CT.net.post(getpath||"/get",getparams,"error retrieving data",function(rawdata){CT.data.addSet(rawdata);cb(keys);});}}};;window.CT.db=window.CT.db||{};CT.db={_schema:{},_limit:20,_pagerLimit:20,key2model:function(key){if(key.slice(-3,-1)=="CT"){var i,num=parseInt(key.slice(-1));key=key.slice(0,-3);for(i=0;i<num;i++)
key+="=";}
return JSON.parse(atob(key)).model;},key2label:function(key){var d=CT.data.get(key);return d.label;},isKey:function(modelName,property){return!!CT.db._schema[modelName]._kinds[property];},getSchema:function(modelName){return modelName?CT.db._schema[modelName]:CT.db._schema;},setSchema:function(schema){CT.db._schema=schema;var s,p,ref,rmap=CT.db._rmap={};for(s in schema){for(p in schema[s]._kinds){ref=s+"."+p;schema[s]._kinds[p].forEach(function(k){if(!(k in rmap))
rmap[k]=[];rmap[k].push(ref);});}}},setLimit:function(limit){CT.db._limit=limit;},setPagerLimit:function(limit){CT.db._pagerLimit=limit;},eachProp:function(modname,cb){return Object.keys(CT.db._schema[modname]).filter(function(p){return["index","key","modelName","label","_label","_kinds"].indexOf(p)==-1;}).map(function(k){return cb(k);});},reference2label:function(modelName,property){var t=CT.db._schema[modelName]._kinds[property][0];return{modelName:t,property:CT.db._schema[t]._label};},put:function(data,cb,action,pname){var params={action:action||"edit",pw:core.config.keys.storage};params[pname||"data"]=data;CT.net.post({path:"/_db",params:params,cb:function(d){CT.data.add(d);cb&&cb(d);}});},get:function(modelName,cb,limit,offset,order,filters,sync,count,exporter){var f,v,qdata={"action":"get","modelName":modelName,"limit":limit||CT.db._limit,"offset":offset||0,"count":count};if(order)
qdata.order=order;if(exporter)
qdata.exporter=exporter;if(filters){for(f in filters){v=filters[f];if(!v.comparator){filters[f]={value:v,comparator:"=="};}}
qdata.filters=filters;}
if(sync){var dz=CT.net._ctresponse(CT.net.post({path:"/_db",params:qdata,sync:true}),"/_db").data;CT.data.addSet(dz);return dz;}
CT.net.post("/_db",qdata,null,function(d){CT.data.addSet(d);cb&&cb(d);});},index:function(index,modelName,cb,nothingcb){CT.db.get(modelName,function(dz){dz[0]?cb(dz[0]):nothingcb();},1,0,null,{index:index});},multi:function(keys,cb,exporter,cacheflag){var needed=keys.filter(function(k){var d=CT.data.get(k);return!(d&&(!cacheflag||d[cacheflag]));});if(!needed.length){return cb(keys.map(function(k){return CT.data.get(k);}));}
CT.net.post("/_db",{action:"get",keys:needed,exporter:exporter||"export"},null,function(dlist){CT.data.addSet(dlist);cb&&cb(keys.map(function(k){return CT.data.get(k);}));});},one:function(key,cb,exporter,nocache){if(CT.data.has(key)&&!nocache)
return cb&&cb(CT.data.get(key));CT.net.post("/_db",{action:"get",key:key,exporter:exporter||"export"},null,function(d){CT.data.add(d);cb&&cb(d);});},blobs:function(variety,cb){CT.net.post({path:"/_db",params:{action:"blobs",variety:variety,pw:core.config.keys.storage},cb:cb});},withSchema:function(cb){if(Object.keys(CT.db._schema).length)
cb&&cb(CT.db._schema);else
CT.net.post("/_db",{"action":"schema"},null,function(schema){CT.db.setSchema(schema);cb&&cb(schema);});},init:function(opts){CT.db._opts=opts=CT.merge(opts,{panel_key:"db",});CT.db.withSchema(opts.cb);},query:function(opts,transition){(new CT.modal.Modal({"node":(new CT.db.Query(opts)).node,"transition":transition||"none"})).show();},_refill:function(modelName,order,filters){return function(obj,cb){CT.db.get(modelName,cb,obj.limit,obj.offset,order,filters);};},pager:function(modelName,order,filters,k,cnode){var o=CT.db._opts,key=k||modelName,cnode=cnode||CT.dom.id(o.panel_key+"content"+key);cnode.appendChild(CT.panel.pager(o.builder(modelName),CT.db._refill(modelName,order,filters),CT.db._pagerLimit,"rcol","data",key));o.post_pager&&o.post_pager(key,modelName);}};CT.db.Blob=CT.Class({CLASSNAME:"CT.db.Blob",uploadPrompt:function(){(new CT.modal.Prompt({noClose:true,style:"file",transition:"slide",cb:this.upload})).show();},upload:function(ctfile){ctfile.upload("/_db",this._update,{action:"blob",value:this.index,key:this.opts.key,property:this.opts.property});},deletePrompt:function(){if(confirm("really delete?")&&confirm("are you sure?")){CT.net.post({path:"/_db",params:{delBlob:true,action:"blob",key:this.opts.key,property:this.opts.property},cb:this._update});}},_update:function(val){this.opts.value=val;this.opts.cb&&this.opts.cb(val);this._setup();},_setup:function(){var className=this.opts.className||"nodecoration blue";if(this.opts.value){this.index=this.opts.value.slice(6);var content=[CT.dom.link("download",null,"/_db?action=blob&value="+this.index,className,this.opts.id,null,true),CT.dom.pad(),CT.dom.link("upload",this.uploadPrompt,null,className)];if(this.opts.delNode){content.push(CT.dom.pad());content.push(CT.dom.link("delete",this.deletePrompt,null,className));}
CT.dom.setContent(this.node,content);}else if(this.opts.key)
CT.dom.setContent(this.node,CT.dom.link(this.opts.firstUp||"upload",this.uploadPrompt,null,className,this.opts.id));else if(!this.opts.noNothing)
CT.dom.setContent(this.node,"(nothing yet)");},value:function(){return this.index;},keyUp:function(key){this.opts.key=key;this._setup();},init:function(opts){this.opts=opts;this.node=CT.dom.node();this.node.blob=this;this._setup();}});CT.db.edit={_d:{"string":"","text":"","json":"","integer":0,"float":0.0,"boolean":false,"datetime":null,"key":null,"blob":null,"list":[],"keylist":[]},_no_ent:{"key":null,"label":"(tap to select)"},_options:{},_unsupported:["label","_label","created","modified"],unsupport:function(properties){CT.db.edit._unsupported=CT.db.edit._unsupported.concat(properties);},option:function(key,vals){CT.db.edit._options[key]=vals;},propertyDefault:function(ptype){return CT.db.edit._d[ptype];},isSupported:function(ptype,key){if(CT.db.edit._unsupported.indexOf(key)!=-1)
return false;return ptype in CT.db.edit._d;},getDefaults:function(modelName,extras,fixed){var k,d=extras||{},schema=CT.db._schema[modelName];for(k in schema)
d[k]=CT.db.edit._d[schema[k]];if(fixed)
for(k in fixed)
d[k]=fixed[k];return d;},_val:function(f,ptype){return function(){if(ptype=="boolean")
return f.isChecked?f.isChecked():f.checked;if(ptype=="integer"){var val=parseInt(f.value);return(typeof val=="number")?val:null;}
if(ptype=="float")
return parseFloat(f.value)||null;if(ptype=="key")
return f.data.key;if(["datetime","list","keylist"].indexOf(ptype)!=-1)
return typeof f.value=="string"?f.value:f.value();if(ptype=="json")
return f.value?JSON.parse(f.value):null;return f.value;};},input:function(k,ptype,val,modelName,opts){var valcell,lstyle={marginLeft:"180px",minHeight:"18px"};opts=opts||{};if(ptype=="string"){if(CT.db.edit._options[k])
valcell=CT.dom.select(CT.db.edit._options[k],null,null,val);else
valcell=CT.dom.field(null,val);}else if(ptype=="text")
valcell=CT.dom.textArea(null,val);else if(ptype=="json")
valcell=CT.dom.textArea(null,val&&JSON.stringify(val));else if(ptype=="boolean"){if(opts.label)
valcell=CT.dom.checkboxAndLabel(k,val);else{valcell=CT.dom.checkbox(null,val,{"display":"inline-block","width":"160px"});}}else if(ptype=="float")
valcell=CT.parse.numOnly(CT.dom.field(null,val),true);else if(ptype=="integer")
valcell=CT.parse.numOnly(CT.dom.field(null,val));else if(ptype=="key")
valcell=(new CT.db.edit.EntityRow({property:k,key:val,modelName:modelName})).node;else if(ptype=="datetime")
valcell=CT.dom.dateSelectors(null,null,opts.startYear,null,true,null,val);else if(ptype=="blob"){var bopts={key:opts.key,property:k,value:val};if(opts.label)
bopts.firstUp="upload "+k;valcell=(new CT.db.Blob(bopts)).node;}
else if(ptype=="list"){if(val)
valcell=CT.dom.fieldList(val,null,lstyle);else
valcell=CT.dom.field();}else if(ptype=="keylist"){if(val)
valcell=CT.dom.fieldList(val,function(v){return(new CT.db.edit.EntityRow({property:k,key:v,modelName:modelName})).node;},lstyle);else
valcell=(new CT.db.edit.EntityRow({property:k,modelName:modelName})).node;}
if(opts.label&&(ptype=="string"||ptype=="text"))
CT.dom.blurField(valcell,[k]);valcell.getValue=CT.db.edit._val(valcell,ptype);valcell.rowKey=k;return valcell;},media:function(opts){opts=CT.merge(opts,{className:"w1",parentClass:"w1",mediaType:"img"});opts.property=opts.property||opts.mediaType;var n=CT.dom.div(null,opts.parentClass),val=opts.data[opts.property],uptype=opts.mediaType=="img"?"image":"video",media=CT.dom[opts.mediaType](val,opts.className),blob=new CT.db.Blob({noNothing:true,id:opts.id,key:opts.data.key,property:opts.property,value:val,delNode:opts.delNode,firstUp:"upload "+uptype,className:"round hoverglow",cb:function(newVal){media.src=newVal+"?ts="+Date.now();opts.data[opts.property]=newVal;opts.cb&&opts.cb();}});CT.dom.setContent(n,[media,blob.node]);return n;},img:function(opts){CT.log("[DEPRECATION WARNING] CT.db.edit.img() is deprecated. Use CT.db.edit.media() instead.");return CT.db.edit.media(opts);}};CT.db.edit.EntityRow=CT.Class({CLASSNAME:"CT.db.edit.EntityRow",mtable:function(){var k,s=CT.dom.node("","div","h9-10 scroller"),n=CT.dom.node(s,"div","h1");for(k in this.node.data)
s.appendChild(CT.dom.node([CT.dom.node(k+":","div","keycell"),CT.dom.node(this.node.data[k]||"(none)","span")],"div","lister"));n.appendChild(CT.dom.button("change",this.change));CT.admin&&n.appendChild(CT.dom.button("edit",this.edit));return n;},edit:function(){CT.admin.db.starLink(this.node.data).onclick();this._modal.hide();},modal:function(){this._change&&this._change.hide();this._modal=this._modal||new CT.modal.Modal({transition:"fade",className:"basicpopup h3-5",node:this.mtable()});this._modal.show();},change:function(){this._modal&&this._modal.hide();this._change=this._change||new CT.modal.Prompt({transition:"slide",prompt:"enter name of new "+this.opts.property,cb:this.node.fill,autocomplete:CT.db.reference2label(this.opts.modelName,this.opts.property)});this._change.show();},_change_or_modal:function(){if(this.opts.key)
this.modal();else
this.change();},init:function(opts){this.opts=opts;var vdata=CT.data.get(opts.key),n=this.node=CT.dom.node(CT.dom.link(null,this._change_or_modal),"span");n.fill=function(d){d=n.data=d||CT.db.edit._no_ent;n.value=d.key;opts.key=d.key;CT.dom.setContent(n.firstChild,d.label);};if(vdata||!opts.key)
n.fill(vdata);else
CT.db.one(opts.key,function(d){CT.data.add(d);n.fill(d);});}});CT.db.Query=CT.Class({CLASSNAME:"CT.db.Query",_filter:function(){var valcell=CT.dom.span(),that=this,compcell=CT.dom.span(),selector=function(argarr){var mod,property;[mod,property]=argarr;var val=CT.db._schema[mod][property];CT.dom.setContent(compcell,val.slice(-4)=="list"?CT.dom.select(["contains","lacks"]):CT.dom.select(["==",">","<",">=","<=","!=","like"]))
CT.dom.setContent(valcell,CT.db.edit.input(property,val,null,mod,that.opts));},selectcell=CT.dom.select(this.filterables,null,null,null,null,function(){var scv=selectcell.value;if(scv.indexOf(".")==-1)
selector([that.modelName,scv]);else
selector(scv.split("."));}),rmcell=CT.dom.button("remove",function(){CT.dom.remove(selectcell.parentNode);});selectcell.onchange();this.filters.appendChild(CT.dom.node([selectcell,compcell,valcell,rmcell]));},_suborders:function(){var mod=this.modelName,subs=[],submap;if(!CT.db._rmap[mod])return[];CT.db._rmap[mod].forEach(function(sub){submap=CT.db._rmap[sub.split(".")[0]];submap&&submap.forEach(function(subsub){subs.push(subsub+"."+mod);});});return subs;},_order:function(){var selectcell=this._orderSelect=CT.dom.select(["None"].concat(this.filterables).concat(this._suborders())),dircell=CT.dom.select(["ascending","descending"]);dircell.className="hidden";selectcell.onchange=function(){if(selectcell.value=="None")
dircell.classList.add("hidden");else
dircell.classList.remove("hidden");};return CT.dom.node([selectcell,dircell]);},_submit:function(){var order=null,filters=CT.merge(this.opts.filter),osel=this.order.firstChild;if(osel.value!="None")
order=osel.nextSibling.value=="descending"?"-"+osel.value:osel.value;CT.dom.each(this.filters,function(fnode){var propcell=fnode.firstChild,compcell=propcell.nextSibling,valcell=compcell.nextSibling;filters[propcell.value]={comparator:compcell.firstChild.value,value:valcell.firstChild.getValue()};});this.opts.submit({modelName:this.modelName,order:order,filters:filters});this.node.parentNode.parentNode.modal.hide();},_submitCb:function(opts){var key=this.modelName+"query"+this.id;CT.panel.add(this.modelName+" ("+this.id+")",false,"db",CT.dom.id(this.opts.pagerPanelId),null,key);CT.db.pager(this.modelName,opts.order,opts.filters,key);CT.panel.swap(key,false,"db");},_build:function(){var oz=this.opts,fk,fv;if(oz.filter){fk=Object.keys(oz.filter)[0];fv=Object.values(oz.filter)[0].value;}
this.filters=CT.dom.node();this.order=this._order();this.node=CT.dom.div([CT.dom.div("Query: "+this.modelName,"bigger bold"),CT.dom.div("Order","big bold"),this.order,CT.dom.node([CT.dom.span("Filters","big bold"),CT.dom.button("add",this._filter)]),CT.dom.div("Select 'like' comparator for values such as 'MO%' (meaning 'starts with MO')",oz.showHelp&&"italic"||"hidden"),oz.filter&&("fixed filter: "+fk+" = "+fv),this.filters,CT.dom.button("submit",this._submit)],"centered");},_filterables:function(){var filts=this.filterables=[],addProps=function(label,nodot){var schema=CT.db.getSchema(label);for(var j in schema)
if(CT.db.edit.isSupported(schema[j],j))
filts.push(nodot&&j||(label+"."+j));},schema=this.schema;addProps(this.modelName,true);filts.sort();["created","modified"].forEach(function(prop){if(prop in schema)
filts.push(prop);});for(var k in this.schema._kinds)
this.schema._kinds[k].forEach(addProps);for(var k in CT.db._schema)
if(this.modelName in CT.db._schema[k]._kinds)
addProps(k);},init:function(opts){this.opts=opts=CT.merge(opts,{submit:this._submitCb,pagerPanelId:"dbqueries"});this.id=CT.db.Query._id;CT.db.Query._id+=1;this.modelName=opts.modelName;this.schema=CT.db.getSchema(opts.modelName);this._filterables();this._build();}});CT.db.Query._id=0;;window.CT.drag=window.CT.drag||{};CT.drag={_:{direction2orientation:{up:"vertical",down:"vertical",left:"horizontal",right:"horizontal"},orientation2axis:{vertical:"y",horizontal:"x"},dir2abs:{right:"backward",left:"forward",up:"forward",down:"backward"},},log:CT.log.getLogger("drag"),nativeScroll:function(n,opts){CT.gesture.listen("up",n,function(){if(opts.up)
opts.up();return true;},true,false);CT.gesture.listen("down",n,function(){if(opts.down)
opts.down();return true;},true,false);var dirs={up:"down",down:"up",right:"left",left:"right"},lastDirection,dragTimeout,delayedDrag=function(){if(dragTimeout){clearTimeout(dragTimeout);dragTimeout=null;}
dragTimeout=setTimeout(function(){opts.drag(dirs[lastDirection],0,0,0);},100);};CT.gesture.listen("drag",n,function(direction,distance,dx,dy){if(n.noDrag)return;var atBottom=(n.parentNode.scrollHeight-n.parentNode.scrollTop===n.parentNode.clientHeight),atTop=(n.parentNode.scrollTop===0),atLeft=(n.parentNode.scrollLeft===0),atRight=(n.parentNode.clientWidth
+n.parentNode.scrollLeft===n.parentNode.scrollWidth);lastDirection=direction;if(opts.drag)
opts.drag(direction,distance,dx,dy);if((atTop&&direction=="down")||(atBottom&&direction=="up"))
return false;return opts.constraint!=CT.drag._.direction2orientation[direction];},true,false);CT.gesture.listen("swipe",n,function(direction,distance,dx,dy,pixelsPerSecond){if(direction=="up"&&(n.parentNode.scrollTop>=(n.parentNode.scrollHeight-(n.parentNode.clientHeight+800)))&&opts.swipe)
{opts.swipe();}},true,false);n.parentNode.addEventListener('scroll',function(event){if(opts.scroll)
opts.scroll(event);if(opts.drag)
delayedDrag();return true;},false);},makeDraggable:function(node,opts){opts=opts||{};if(!opts.interval&&!opts.force&&!CT.info.isStockAndroid)
return CT.drag.nativeScroll(node.firstChild,opts);var _=CT.drag._;node.xDrag=0;node.yDrag=0;node.classList.add('hardware-acceleration');node.style['-webkit-transform']="translate3d(0,0,0)";node.parentNode.addEventListener('scroll',function(event){return false;},false);var getInterval=function(){return opts.interval=="auto"?(CT.align[opts.constraint=="horizontal"?"height":"width"](node)/node.childNodes.length):opts.interval;};var downCallback=function(){if(node.animating)return;node.dragging=false;node.touchedDown=true;node.animating=false;node.xDragStart=node.xDrag;node.yDragStart=node.yDrag;if(opts.down)
opts.down();};var upCallback=function(direction){var xMod=0,yMod=0,boundaryReached=false,interval=getInterval();node.touchedDown=node.dragging=false;if(node.animating==false){if(interval){if(opts.constraint!="vertical"){yMod=node.yDrag%interval;if(yMod!=0){if(Math.abs(yMod)<=(interval/2))
node.yDrag-=yMod;else
node.yDrag-=(interval+yMod);if(node.yDrag<node.yDragStart)
direction="up";else if(node.yDrag>node.yDragStart)
direction="down";else
direction="hold";}}
if(opts.constraint!="horizontal"){xMod=node.xDrag%interval;if(xMod!=0){if(Math.abs(xMod)<=(interval/2))
node.xDrag-=xMod;else
node.xDrag-=(interval+xMod);if(node.xDrag<node.xDragStart)
direction="left";else if(node.xDrag>node.xDragStart)
direction="right";else
direction="hold";}}
if(direction){node.animating=true;CT.trans.translate(node,{x:node.xDrag,y:node.yDrag,cb:function(){node.animating=false;}});}}
else{if(opts.constraint!="horizontal"){if(node.xDrag>0){node.xDrag=0;boundaryReached=true;direction="right";}
else if(Math.abs(node.xDrag)>(node.scrollWidth-node.parentNode.clientWidth)){node.xDrag=-(node.scrollWidth-node.parentNode.clientWidth);boundaryReached=true;direction="left";}}
if(opts.constraint!="vertical"){if(node.yDrag>0){node.yDrag=0;boundaryReached=true;direction="up";}
else if(node.yDrag<-(node.scrollHeight-node.parentNode.clientHeight)){node.yDrag=-(node.scrollHeight-node.parentNode.clientHeight);boundaryReached=true;direction="down";}}
if(boundaryReached){node.animating=true;CT.trans.translate(node,{x:node.xDrag,y:node.yDrag,cb:function(){node.animating=false;if(opts.drag)
opts.drag(direction,0,0,0);if(opts.scroll)
opts.scroll();}});}}
if(opts.up)
opts.up(direction);}};var dragCallback=function(direction,distance,dx,dy){if(node.touchedDown&&!node.noDrag){node.dragging=true;if(opts.constraint!="vertical"){if(node.yDrag>-(node.scrollHeight-
(2*node.parentNode.clientHeight/3)))
node.yDrag+=dy;}
if(opts.constraint!="horizontal"){if(Math.abs(node.xDrag)<(node.scrollWidth-
(2*node.parentNode.clientWidth/3)))
node.xDrag+=dx;}
CT.trans.setVenderPrefixed(node,"transform","translate3d("+node.xDrag+"px,"+
node.yDrag+"px,0)");if(opts.drag)
opts.drag(direction,distance,dx,dy);if(opts.scroll)
opts.scroll();}};var minVal=function(orientation){if(orientation=="horizontal")
return node.parentNode.clientWidth-node.scrollWidth;else if(orientation=="vertical")
return node.parentNode.clientHeight-node.scrollHeight;};var swipeCallback=function(direction,distance,dx,dy,pixelsPerSecond){var orientation,absdir,axis,dval,minval,mod,interval=getInterval();if(node.animating)
return;if(_.direction2orientation[direction]==opts.constraint)
return opts.up&&opts.up(direction);for(orientation in _.orientation2axis){absdir=_.dir2abs[direction];axis=_.orientation2axis[orientation];dval=node[axis+"Drag"];minval=minVal(orientation);mod=interval?(dval%interval):(orientation=="vertical"?-dy:-dx);if(opts.constraint!=orientation&&dval<=0&&dval>minval){if(absdir=="backward")
node[axis+"Drag"]-=mod;else if(absdir=="forward")
node[axis+"Drag"]+=(interval?-(interval+mod):mod);else
return CT.drag.log("swipeCallback",direction,"has no abs dir!");}}
node.animating=true;CT.trans.translate(node,{x:node.xDrag,y:node.yDrag,cb:function(){node.animating=false;upCallback(direction);}});};if(node.isDraggable)
CT.gesture.unlisten(node);node.isDraggable=true;CT.gesture.listen("drag",node,dragCallback);CT.gesture.listen("down",node,downCallback);CT.gesture.listen("swipe",node,swipeCallback);CT.gesture.listen("up",node,upCallback);}};;window.CT.dom=window.CT.dom||{};CT.dom={"_autoparse":false,"setAutoparse":function(bool){CT.dom._autoparse=bool;},"_nodes":{},"_obj2node":function(attrs){var args=[];if(attrs.builder){attrs.content=attrs.items.map(function(item){return attrs.builder(item);});delete attrs.builder;delete attrs.items;}
["content","type","classname","id"].forEach(function(a){args.push(attrs[a]);delete attrs[a];});args.push(attrs);if(attrs.style){args.push(attrs.style);delete attrs.style;}
return CT.dom.node.apply(null,args);},"node":function(content,type,classname,id,attrs,style){var d=document.createElement(type||"div");if(content!=null){if(Array.isArray(content))
content.forEach(function(item){d.appendChild(item instanceof Node?item:CT.dom.node(item));});else if(content instanceof Node)
d.appendChild(content);else if(typeof content=="function")
d.appendChild(content());else if(typeof content=="object")
return CT.dom._obj2node(content);else if((typeof content=="string"&&content.length)||typeof content=="number"){if(type=="table")
alert("illegal innerHTML set on table! content: "+content);else if(type=="style"){d.type='text/css';if(d.styleSheet){d.styleSheet.cssText=content;}else{d.appendChild(document.createTextNode(content));}}
else{if(CT.dom._autoparse)
content=CT.parse.process(content.toString());d.innerHTML=content;}}}
if(classname)
d.className=classname;if(id){d.id=id;CT.dom._nodes[id]=d;}
d.on=function(e,func){if(!func){for(var k in e)
d.addEventListener(k,e[k]);}
else if(e=="visible"){var io=new IntersectionObserver(function(entz){if(entz[0].intersectionRatio)
func();});io.observe(d);}else
d.addEventListener(e,func);};if(attrs){for(var attr in attrs){if(attrs[attr]==null)
continue;if(["value","onclick","srcObject"].indexOf(attr)!=-1)
d[attr]=attrs[attr];else if(attr.slice(0,2)=="on")
d.on(attr.slice(2),attrs[attr]);else
d.setAttribute(attr,attrs[attr]);}}
if(style)
for(var rule in style)
d.style[rule]=style[rule];return d;},"table":function(rows,classname,id,attrs,style){return CT.dom.node(CT.dom.tableRows(rows),"table",classname,id,attrs,style);},"tableRows":function(rows){return rows.map(function(row){return CT.dom.node(row.map(function(cell){return CT.dom.node(cell,"td");}),"tr");});},"addRows":function(ptable,rows){for(var row of CT.dom.tableRows(rows))
ptable.appendChild(row);},"div":function(content,classname,id,attrs,style){return CT.dom.node(content,"div",classname,id,attrs,style);},"flex":function(content,classname,id,attrs,style){return CT.dom.div(content,"flex "+classname,id,attrs,style);},"span":function(content,classname,id,attrs,style){return CT.dom.node(content,"span",classname,id,attrs,style);},"script":function(src,content,delay,onload){if(delay)
content="setTimeout(function() { "+content+" }, "+delay+");";return CT.dom.node(content,"script",null,null,{"src":src,"onload":onload});},"link":function(content,onclick,href,classname,id,attrs,newtab){if(attrs==null)
attrs={};if(onclick)
attrs.onclick=onclick;if(href)
attrs.href=href;if(newtab)
attrs.target="_blank";return CT.dom.node(content,"a",classname,id,attrs);},"button":function(content,onclick,classname,id,disabled){return CT.dom.node(content,"button",classname,id,{"onclick":onclick,"disabled":disabled});},"field":function(id,value,classname,type,attrs,style,placeholder){attrs=attrs||{};if(value||(typeof value=="number"))
attrs.value=value;if(type)
attrs.type=type;if(placeholder)
attrs.placeholder=placeholder;return CT.dom.node("","input",classname,id,attrs,style);},"file":function(cb,id,classname,multiple){return CT.dom.field(id,null,classname,"file",{onchange:cb,multiple:multiple});},"fieldList":function(vals,maker,style,onadd,onremove,onchange,bottomadd){if(arguments.length==1&&vals&&!Array.isArray(vals)){var obj=vals;vals=obj.vals;maker=obj.maker;style=obj.style;onadd=obj.onadd;onremove=obj.onremove;onchange=obj.onchange;bottomadd=obj.bottomadd;}
var input=function(v,i){return maker?maker(v,i):CT.dom.field(null,v);},row=function(v,i){var butt=CT.dom.button("remove",function(){CT.dom.remove(butt.parentNode);onremove&&onremove(v);onchange&&onchange(n.value());});return CT.dom.node([butt,input(v,i)]);},n=CT.dom.node(vals&&vals.map(row),null,null,null,null,style);n.empty=input();n.addButton=CT.dom.button("add",function(){if(n.empty.value){var newRow=row(n.empty.value);bottomadd?n.appendChild(newRow):n.insertBefore(newRow,n.firstChild);onadd&&onadd(newRow.lastElementChild);onchange&&onchange(n.value());if(n.empty.fill)
n.empty.fill()
else
n.empty.value="";}});n.addButton.style.width="57px";n.value=function(){return CT.dom.map(n,function(wrapper){return wrapper.lastChild.value;});};return n;},"textArea":function(id,value,classname){return CT.dom.node("","textarea",classname,id,value&&{"value":value}||null);},"img":function(src,imgclass,onclick,href,target,title,linkid,wrapperclass,imgid,noanchor,style){if(arguments.length==1&&typeof arguments[0]!="string"){var obj=arguments[0];src=obj.src;imgclass=obj.imgclass||obj.className;onclick=obj.onclick;href=obj.href;target=obj.target;title=obj.title;linkid=obj.linkid;wrapperclass=obj.wrapperclass;imgid=obj.imgid;noanchor=obj.noanchor;style=obj.style;}
var n=CT.dom.node("","img",imgclass,imgid,{"src":src},style);if(noanchor)
n.onclick=onclick;else if(onclick||href){var l=CT.dom.link("",onclick,href);if(target)
l.target=target;if(title)
l.title=l.alt=title;if(linkid)
l.id=linkid;if(wrapperclass)
n=CT.dom.div(n,wrapperclass);l.appendChild(n);return l;}
return n;},"panImg":function(opts){opts=CT.merge(opts,{pan:true,panDuration:5000,className:"abs all0 noflow below"});var img=CT.dom.div(CT.dom.img(opts.img,"abs"),opts.className);if(opts.pan){img.controller=CT.trans.pan(img.firstChild,{duration:opts.panDuration},true);if(opts.controllerHook){opts.controllerHook.hide=img.controller.pause;opts.controllerHook.show=img.controller.resume;}}
return img;},"select":function(onames,ovalues,id,curvalue,defaultvalue,onchange,other,noto){if(arguments.length==1&&!Array.isArray(onames)){var obj=onames;onames=obj.names;ovalues=obj.values;id=obj.id;curvalue=obj.curvalue;defaultvalue=obj.defaultvalue;onchange=obj.onchange;other=obj.other;noto=noto in obj?obj.noto:true;}
ovalues=ovalues||onames;var s=CT.dom.node("","select","",id);if(other){defaultvalue=defaultvalue||"other";if(ovalues.indexOf("other")==-1){ovalues.push("other");if(ovalues!=onames)
onames.push("other");}
s.other=CT.dom.field(null,(ovalues.indexOf(curvalue)==-1)&&curvalue,"hidden");s.container=CT.dom.node([s,s.other]);s.container.value=function(){if(s.value=="other")
return s.other.value.trim();return s.value;};}
for(var i=0;i<onames.length;i++){s.appendChild(CT.dom.node(onames[i],"option","","",{"value":ovalues[i]}));}
if(curvalue)
s.value=ovalues.indexOf(curvalue)!=-1&&curvalue||defaultvalue;s.onchange=function(){if(other){if(s.value=="other")
s.other.style.display="block";else
s.other.style.display="none";}
onchange&&onchange(s.value);};noto||setTimeout(s.onchange);return s.container||s;},"range":function(oninput,min,max,value,step,classname,id,onchange){var r=CT.dom.node("","input",classname,id,{"type":"range","oninput":oninput&&function(){oninput(r.value);},"onchange":onchange&&function(){onchange(r.value);},"min":min,"max":max,"value":value,"step":step});return r;},"checkbox":function(id,ischecked,style){var cbdata={"type":"checkbox"};if(ischecked)
cbdata.checked=ischecked;return CT.dom.node("","input","",id,cbdata,style);},"wrapped":function(nodes,type,className,id,attrs){CT.log("[DEPRECATION WARNING] CT.dom.wrapped() is deprecated. Use CT.dom.node().");var wrapper=CT.dom.node("",type,className,id,attrs);if(!Array.isArray(nodes))
nodes=[nodes];for(var i=0;i<nodes.length;i++)
wrapper.appendChild(nodes[i]);return wrapper;},"audio":function(src,controls,autoplay,preload,onplay,onended,className,id,attrs,oncanplay,onpause){if(arguments.length==1&&typeof arguments[0]!="string"){var obj=arguments[0];src=obj.src;controls=obj.controls;autoplay=obj.autoplay;preload=obj.preload;onplay=obj.onplay;onended=obj.onended;className=obj.className;id=obj.id;attrs=obj.attrs;oncanplay=obj.oncanplay;onpause=obj.onpause;}
attrs=attrs||{};attrs.src=src;if(controls)
attrs.controls="true";if(autoplay)
attrs.autoplay="true";if(onplay)
attrs.onplay=onplay;if(onpause)
attrs.onpause=onpause;if(onended)
attrs.onended=onended;if(oncanplay)
attrs.oncanplay=oncanplay;attrs.preload=attrs.preload||preload||"none";return CT.dom.node("","audio",className,id,attrs);},"video":function(src,className,id,attrs,style,oncanplay,onended,onplay,onpause,poster,controls,autoplay){if(arguments.length==1&&typeof arguments[0]!="string"){var obj=arguments[0];src=obj.src;className=obj.className;id=obj.id;attrs=obj.attrs;style=obj.style;oncanplay=obj.oncanplay;onended=obj.onended;onplay=obj.onplay;onpause=obj.onpause;poster=obj.poster;controls=obj.controls;autoplay=obj.autoplay;}
attrs=attrs||{};var multisrc=false;if(Array.isArray(src))
multisrc=true;else if(typeof src=="object")
attrs.srcObject=src;else
attrs.src=src;if(controls)
attrs.controls="true";if(autoplay)
attrs.autoplay="true";if(onplay)
attrs.onplay=onplay;if(onpause)
attrs.onpause=onpause;if(onended)
attrs.onended=onended;if(oncanplay)
attrs.oncanplay=oncanplay;if(poster)
attrs.poster=poster;var n=CT.dom.node(multisrc&&src.map(function(s){return CT.dom.node(null,"source",null,null,{src:s});}),"video",className,id,attrs,style);n.stream=function(stream){n.srcObject=stream;n.play();};return n;},"iframe":function(src,className,id,attrs,style){if(arguments.length==1&&typeof arguments[0]!="string"){var obj=arguments[0];src=obj.src;className=obj.className;id=obj.id;attrs=obj.attrs;style=obj.style;}
var iframe=CT.dom.node("","iframe",className,id,CT.merge({"src":src},attrs),style);iframe.setHash=function(txt){CT.dom.getLoc(iframe).hash=txt;};return iframe;},"pad":function(psize){psize=psize||1;var ptxt="";for(var i=0;i<psize;i++)
ptxt+="&ensp;";return CT.dom.node(ptxt,"span");},"br":function(bsize){bsize=bsize||1;var bs=[];for(var i=0;i<bsize;i++)
bs.push(CT.dom.node(null,"br"));return CT.dom.node(bs);},"marquee":function(content,className,direction,noresize){var n=CT.dom.node(content,"marquee",className,null,{direction:direction||"left",behavior:"alternate"});!noresize&&setTimeout(function(){CT.dom.each(n,function(sub){sub.style.height=n.clientHeight+"px";});});return n;},"label":function(content,htmlFor,className,click){var n=CT.dom.node(content,"label",className,null,{"for":htmlFor,"htmlFor":htmlFor});if(click){n.onclick=function(){var tnode=CT.dom.id(htmlFor);tnode&&tnode.onclick&&tnode.onclick();};}
return n;},"getDoc":function(iframe){return iframe.documentWindow||iframe.contentWindow||iframe.contentDocument;},"getLoc":function(iframe){return CT.dom.getDoc(iframe).location;},"checkboxAndLabel":function(cbid,ischecked,lname,lclass,cclass,onclick){if(!lname&&cbid.indexOf(" ")!=-1){lname=cbid;cbid=cbid.replace(/ /g,"");}
var n=CT.dom.node("","div",cclass);var cbname=cbid+"checkbox";var cb=CT.dom.checkbox(cbname,ischecked);n.appendChild(cb);if(onclick){cb.onclick=function(){onclick(cb);};}
n.appendChild(CT.dom.label(lname||cbid,cbname,lclass));n.isChecked=function(){return cb.checked;};return n;},"resizeTextArea":function(cbody){if(navigator.appName.indexOf("Microsoft Internet Explorer")==0)
cbody.style.overflow='visible';else{while(cbody.rows>1&&cbody.scrollHeight<cbody.offsetHeight)
cbody.rows--;while(cbody.scrollHeight>cbody.offsetHeight)
cbody.rows++;}},"labelAndField":function(lname,fid,fclass,lclass,fval,ista,isresize){fid=fid||lname.replace(/ /g,"");var n=CT.dom.node();var finput=CT.dom[(ista&&"textArea"||"field")](fid,fval,"right "+(fclass||""),(lname.indexOf("Password")!=-1)&&"password"||null);if(ista&&isresize){finput.onkeyup=function(){CT.dom.resizeTextArea(finput);return true;};}
n.appendChild(finput);n.appendChild(CT.dom.node(lname,"label",lclass,null,{"for":fid,"htmlFor":fid}));n.appendChild(CT.dom.node("","div","clearnode"));return n;},"_radioStripStep":function(radios,labels,lname,cb,stripname,stripnum,ison){var fname=(stripname||"radiostrip")+(stripnum||"")+lname;var f=CT.dom.field(fname,null,null,"radio");f.name=(stripname||"")+(stripnum||"");f.onclick=function(){cb(lname);};if(ison)
f.checked=true;radios.insertCell(-1).appendChild(f);labels.insertCell(-1).appendChild(CT.dom.node(lname,"label",null,null,{"htmlFor":fname,"for":fname}));},"radioStrip":function(pnode,lnames,cb,stripname,stripnum,stripval){var rtable=CT.dom.node("","table");rtable.style.textAlign="center";var radios=rtable.insertRow(0);var labels=rtable.insertRow(1);for(var i=0;i<lnames.length;i++)
CT.dom._radioStripStep(radios,labels,lnames[i],cb,stripname,stripnum,lnames[i]==stripval);pnode.appendChild(rtable);},"options":function(data,cb,selected){var fid,dname,n=CT.dom.div(data.map(function(d,i){dname=d.name||d,fid="rs"+i+dname,fopts={onclick:function(){cb(d);}};if(selected&&((selected==d)||(selected==d.key)))
fopts.checked=true;return[CT.dom.field(fid,null,null,"radio",fopts),CT.dom.label(dname,fid)];}));return n;},"linkWithIcon":function(icon,lname,laddr,lonclick){var n=CT.dom.node("","span");n.appendChild(CT.dom.img(icon,"vmiddle rpaddedsmall nodecoration",lonclick,laddr));n.appendChild(CT.dom.link(lname,lonclick,laddr));return n;},"labeledImage":function(img,href,label,_alt,_icl,_wcl,_lcl,reverseNodes,onclick,sametarget,_id){var nlink=CT.dom.link();var imageNode=CT.dom.img(img,_icl);var labelNode=CT.dom.node(label,"div",_lcl);if(reverseNodes){nlink.appendChild(labelNode);nlink.appendChild(imageNode);}else{nlink.appendChild(imageNode);nlink.appendChild(labelNode);}
nlink.title=nlink.alt=_alt||label;var w=CT.dom.node(nlink,"div",_wcl,_id);if(href){nlink.href=href;if(!sametarget)
nlink.target="_blank";}else if(onclick)
w.onclick=onclick;return w;},"buildForm":function(section,fields){var table=document.getElementById(section+"Table");for(var i=0;i<fields.length;i++){var field=fields[i];var id=section+field.replace(/ /g,"");var row=table.insertRow(-1);row.insertCell(0).appendChild(CT.dom.node(field,"label","","",{"htmlFor":id,"for":id}));var inputTag=CT.dom.field(id);if(field.indexOf("Password")!=-1)
inputTag.type="password";row.insertCell(1).appendChild(inputTag);}
return table;},"timer":function(start,cb,classname,id,attrs){var n=CT.dom.node(start,"div",classname,id,attrs);n._sec=start;n._check=function(){n._sec-=1;n.innerHTML=n._sec;if(n._sec==0){n.stop();cb&&cb();}};n.set=function(val){n.innerHTML=n._sec=val;};n.start=function(){n.stop();n._interval=setInterval(n._check,1000);};n.stop=function(){if(n._interval){clearInterval(n._interval);n._interval=null;}};n.start();return n;},"choices":function(nodes,multi,cellClass,selectedClass,onchange){selectedClass=selectedClass||"grayback";var n=CT.dom.node();n._sel=null;n.value=multi?[]:-1;nodes.forEach(function(node,i){node.onclick=function(){if(!multi&&n._sel)
n._sel.classList.remove(selectedClass);n._sel=node;if(node.classList.contains(selectedClass)){node.classList.remove(selectedClass);if(multi)
CT.data.remove(n.value,i);else
n.value=[];}else{node.classList.add(selectedClass);if(multi)
CT.data.append(n.value,i);else
n.value=i;}
onchange&&onchange(i);};node.classList.add(cellClass||"choice_cell");n.appendChild(node);});return n;},"updown":function(){var up=CT.dom.link("up",function(){var pnode=n.parentNode,psib=pnode.previousSibling;pnode.parentNode.insertBefore(pnode,psib);n.update();psib.firstChild.update();},null,"block"),down=CT.dom.link("down",function(){var pnode=n.parentNode,nsib=pnode.nextSibling,nnsib=nsib.nextSibling;if(nnsib)
pnode.parentNode.insertBefore(pnode,nnsib);else
pnode.parentNode.appendChild(pnode);nsib.firstChild.update();n.update();},null,"block"),n=CT.dom.div([up,down],"right small");n.update=function(){CT.dom[n.parentNode.previousSibling?"show":"hide"](up);CT.dom[n.parentNode.nextSibling?"show":"hide"](down);};setTimeout(n.update);return n;},"shuffler":function(data,rower){rower=rower||function(d){return d.label||d.name||d.title||d;};var n=CT.dom.div();data.forEach(function(d,i){var row=CT.dom.div([CT.dom.updown(),rower(d)],"choice_cell");row.data=d;n.appendChild(row);});n.value=function(){return CT.dom.map(n,r=>r.data);};return n;},"dragListing":function(d,rower){var nid="dli_"+(d.key||d.name||d||CT.data.random(1000)),n=rower?rower(d):CT.dom.div(d.name||d,"bordered padded margined round");n.id=nid;n.draggable=true;n.ondragstart=function(ev){ev.dataTransfer.setData("text/plain",nid);};return n;},"dragList":function(data,rower,onchange,colattrs,colstyle){var pnode=CT.dom.div(data.map(d=>CT.dom.dragListing(d,rower)),"bordered",null,CT.merge({ondrop:function(ev){var nodeId=ev.dataTransfer.getData("text/plain"),tar=ev.target,dnode=CT.dom.id(nodeId);while(pnode.contains(tar)&&tar.parentNode!=pnode)
tar=tar.parentNode;if(!((tar.parentNode==pnode)&&dnode.parentNode==pnode))
return CT.log("missed drop");pnode.insertBefore(dnode,tar);pnode.data=CT.dom.map(pnode,d=>d.id.slice(4));ev.preventDefault();onchange&&onchange(pnode.data);},ondragover:function(ev){ev.dataTransfer.dropEffect="move";ev.preventDefault();}},colattrs),colstyle);pnode.data=data.map(d=>d.key||d);return pnode;},"dragListList":function(data,rower,colattrs,colstyle,dataer,onchange){var pnode=CT.dom.flex(data.map(d=>CT.dom.dragList(d,rower,onchange,colattrs,colstyle)),"row");pnode.value=function(){return CT.dom.map(pnode,dataer||(n=>n.data));};return pnode;},"form":function(content,action,method,classname,id){return CT.dom.node(content,"form",classname,id,{method:method||"post",action:action});},"spinner":function(){return CT.dom.node(CT.dom.node([CT.dom.node("loading...","strong"),CT.dom.node("","span")],"div","ctspinner"),"div","ctswrap");},"_monthnames":["January","February","March","April","May","June","July","August","September","October","November","December"],"currentyear":Math.max((new Date()).getFullYear(),2014),"timeSelector":function(etimes,curvalue,onchange){etimes=etimes||[];for(var i=0;i<24;i++){var istr=i<10?"0"+i:i;etimes.push(istr+":"+"00");etimes.push(istr+":"+"30");}
return CT.dom.select(etimes,null,null,curvalue,null,onchange,null,true);},"dateSelectors":function(node,d,startdate,enddate,withtime,noday,val){if(arguments.length==1&&!(arguments[0]instanceof Node)){var obj=arguments[0];node=obj.node;d=obj.d;startdate=obj.startdate;enddate=obj.enddate;withtime=obj.withtime;noday=obj.noday;val=obj.val;}
var eyears=["Year"];startdate=startdate||CT.dom.currentyear;enddate=enddate||CT.dom.currentyear;for(var i=startdate;i<=enddate;i++)
eyears.push(i);node=node||CT.dom.node(null,"span");d=d||node;d.year=CT.dom.select(eyears);d.month=CT.dom.select(["Month"].concat(CT.dom._monthnames),["Month","01","02","03","04","05","06","07","08","09","10","11","12"]);node.appendChild(d.year);node.appendChild(d.month);if(!noday){d.day=CT.dom.select(["Day","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31"]);node.appendChild(d.day);}
if(withtime){d.time=CT.dom.timeSelector(["Time"]);node.appendChild(d.time);}
if(val){var vsplit=val.split(" "),dsplit=vsplit[0].split("-");d.year.value=dsplit[0];d.month.value=dsplit[1];if(!noday)
d.day.value=dsplit[2];if(withtime){var t=vsplit[1].slice(0,-3);d.time.value=t;if(t&&d.time.value!=t){d.time.insertBefore(CT.dom.node(t,"option"),d.time.firstChild.nextSibling);d.time.value=t;}}}
d.value=function(){if(d.year.value=="Year"||d.month.value=="Month"||(!noday&&d.day.value=="Day"))
return null;var val=d.year.value+"-"+d.month.value;if(!noday)
val+="-"+d.day.value;if(withtime)
val+=" "+(d.time.value||"00:00")+":00";else
val+=" 00:00:00";return val;};return node;},"_pwpcb":null,"passwordPrompt":function(cb){CT.log("[DEPRECATION WARNING] CT.dom.passwordPrompt() is deprecated. Use CT.Prompt instead.");CT.dom._pwpcb=cb;var pwprompt=document.getElementById("passwordprompt");var pwpfield=document.getElementById("pwpfield");if(pwprompt==null){pwprompt=CT.dom.node("","div","hidden basicpopup centered","passwordprompt");document.body.appendChild(pwprompt);pwprompt.appendChild(CT.dom.node("For your own security, please enter your password.","div","bottompadded"));pwpfield=CT.dom.field("pwpfield",null,null,"password");pwprompt.appendChild(pwpfield);var entercb=function(){if(!CT.parse.validPassword(pwpfield.value))
return alert("invalid password!");pwprompt.style.display="none";CT.dom._pwpcb(pwpfield.value);};CT.dom.inputEnterCallback(pwpfield,entercb);pwprompt.appendChild(CT.dom.button("Continue",entercb));pwprompt.appendChild(CT.dom.button("Cancel",function(){pwprompt.style.display="none";}));}
pwpfield.value="";pwprompt.style.display="block";pwpfield.focus();CT.align.centered(pwprompt);},"_blurs":{},"setBlur":function(fieldId,values){CT.dom._blurs[fieldId]=values;},"getFieldValue":function(fieldId,fieldPath,rules){var field=CT.dom.id(fieldId)||fieldId;if(!field)
return null;if(fieldPath){for(var i=0;i<fieldPath.length;i++)
field=field[fieldPath[i]];}
var s=field.container?field.container.value():field.value,blurs=CT.dom._blurs[fieldId]||field._blurs;if(!s||(blurs&&blurs.indexOf(s)!=-1))
return"";if(rules){if(rules.requires){for(var i=0;i<rules.requires.length;i++){if(s.indexOf(rules.requires[i])==-1){s="";break;}}}
if((s&&s.length||0)<(rules.length||0))
s="";}
return s;},"blurField":function(field,useblurs){useblurs=CT.dom._blurs[field.id]=field._blurs=useblurs||CT.dom._blurs[field.id]||field._blurs;var pw=field.type=="password";if(useblurs){field.onblur=function(){if(field.value==""){if(pw)
field.type="";field.classList.add("gray");field.value=useblurs[Math.floor(Math.random()*useblurs.length)];}
else
field.classList.remove("gray");};field.onfocus=function(){if(useblurs.indexOf(field.value)!=-1){field.value="";if(pw)
field.type="password";field.classList.remove("gray");}};field.onblur();}},"setFieldValue":function(value,fieldId,fieldPath){var field=document.getElementById(fieldId);if(!field)
return setTimeout(CT.dom.setFieldValue,500,value,fieldId,fieldPath);if(fieldPath){for(var i=0;i<fieldPath.length;i++)
field=field[fieldPath[i]];}
field.value=value||"";CT.dom.blurField(field);},"genfield":function(ftype,n,d,u,val,node2){var f=CT.dom.field("up"+ftype,val||u[ftype],"right w280",(ftype.indexOf("password")!=-1)&&"password"||null);d[ftype]=f;n.appendChild(f);n.appendChild(CT.dom.node(CT.parse.key2title(ftype),"label","bold",null,{"for":"up"+ftype,"htmlFor":"up"+ftype}));if(node2){n.appendChild(CT.dom.node("&nbsp;&nbsp;","span"));n.appendChild(node2);}
n.appendChild(CT.dom.node("","div","clearnode"));},"inputEnterCallback":function(n,cb,fid,noBreak,keyup){n.onenter=function(e){if(noBreak)
n.value=n.value.replace("\n","").replace("\r","");if(fid)
document.getElementById(fid).focus();if(cb&&(cb(n.value,e)=="clear"))
n.value="";};n.addEventListener("keyup",function(e){e=e||window.event;var code=e.keyCode||e.which;keyup&&keyup(n.value);if(code==13||code==3)
n.onenter(e);});return n;},"smartField":function(cb,classname,id,value,type,blurs,isTA,noBreak,wyz,keyup){if(arguments.length==1&&typeof arguments[0]!="function"){var obj=arguments[0];cb=obj.cb;classname=obj.classname;id=obj.id;value=obj.value;type=obj.type;blurs=obj.blurs;isTA=obj.isTA;noBreak=obj.noBreak;wyz=obj.wyz;keyup=obj.keyup;}
var nonbsp,restricted,tables,spellcheck,fullscreen,charmap;if(wyz&&wyz.includes){nonbsp=wyz.includes("nonbsp");restricted=wyz.includes("restricted");tables=wyz.includes("tables");spellcheck=wyz.includes("spellcheck");fullscreen=wyz.includes("fullscreen");charmap=wyz.includes("charmap");}
id=id||("sf"+Math.floor((Math.random()*100000)));var f=CT.dom.inputEnterCallback(CT.dom[isTA?"textArea":"field"](id,value,classname,type),cb,id,noBreak,keyup);f.fieldValue=function(){return wyz?f.get(nonbsp):CT.dom.getFieldValue(f);};wyz&&CT.rte.qwiz(id,value,!restricted,tables,spellcheck,fullscreen,charmap);if(blurs)
CT.dom.blurField(f,blurs);return f;},"numberSelector":function(o){var initial=o.initial||1,shower=CT.dom.div(initial),r=CT.dom.range(function(val){CT.dom.setContent(shower,val);},o.min||0.25,o.max||5,initial,o.step||0.25,o.classname,o.id,o.onchange),n=CT.dom.div([shower,r]);n.value=function(){return window["parse"+((o.step==1)?"Int":"Float")](r.value);};return n;},"iconSelector":function(items,selectFirst){var cur,n=CT.dom.div(items.map(function(i){var img=CT.dom.img(i.img||i.url||i.item||i,"padded margined round",function(){if(cur)
cur.firstChild.classList.remove("bordered");cur=img;cur.firstChild.classList.add("bordered");});img._icon=i;return img;}));n.value=function(){return cur&&cur._icon;};selectFirst&&n.firstChild.onclick();return n;},"soundSelector":function(items,selectFirst){var cur,n=CT.dom.div(items.map(function(aud){var src=aud.src||aud.item,wrap=CT.dom.div([aud.label||aud.name,CT.dom.audio({src:src,controls:true,className:"w1"})],"pointer padded margined round",null,{onclick:function(){if(cur)
cur.classList.remove("bordered");cur=wrap;cur.classList.add("bordered");}});wrap._data=aud;return wrap;}));n.value=function(){return cur&&cur._data;};selectFirst&&n.firstChild.onclick();return n;},"_isVerticalOrientation":function(node){if(node.clientHeight==0||node.clientWidth==0)
return undefined;return node.clientWidth/node.parentNode.clientWidth<node.clientHeight/node.parentNode.clientHeight;},"cover":function(node){var v=CT.dom._isVerticalOrientation(node);if(v==undefined)
return v;node.classList.add(v?"w1":"h1");node.classList.remove(v?"h1":"w1");return v;},"contain":function(node){var v=CT.dom._isVerticalOrientation(node);if(v==undefined)
return v;node.classList.add(v?"h1":"w1");node.classList.remove(v?"w1":"h1");return v;},"fit":function(node){node.fit=function(){if(node.scrollHeight!=node.clientHeight){var size=parseInt(getComputedStyle(node).fontSize);node.style.fontSize=(size-1)+"px";setTimeout(node.fit);}};CT.onresize(node.fit);},"_ricounter":0,"_get_ta_id":function(){var taid="richinput"+CT.dom._ricounter;CT.dom._ricounter+=1;return taid;},"richInput":function(inputnode,taid,submitbutton,content,charlimit,blurs,noclear,taclass){taid=taid||CT.dom._get_ta_id();charlimit=charlimit||500;var cbody=CT.dom.textArea(taid,content,taclass||"fullwidth");CT.dom.blurField(cbody,blurs);inputnode.appendChild(CT.dom.node(cbody));var charcount=CT.dom.node("("+charlimit
+" chars left)","div","right",taid+"cc");cbody.onkeyup=function(e){e=e||window.event;var c=CT.dom.getFieldValue(taid).length;if(c>charlimit){cbody.value=cbody.value.slice(0,charlimit);charcount.className="right bold";if(e.preventDefault)
e.preventDefault();return false;}
else
charcount.className="right";charcount.innerHTML="("+(charlimit-c)+" chars left)";CT.dom.resizeTextArea(cbody);return true;};inputnode.appendChild(charcount);if(submitbutton)
inputnode.appendChild(submitbutton);else if(!noclear)
inputnode.appendChild(CT.dom.node("","div","clearnode"));return cbody;},"showHideT":function(n){n=n||document.body;n.style.opacity=n.style.opacity=="1"&&"0"||"1";},"showHideV":function(n,juston,justoff){n=n||document.body;if(juston)
n.style.visibility="visible";else if(justoff)
n.style.visibility="hidden";else
n.style.visibility=n.style.visibility=="visible"&&"hidden"||"visible";},"showHide":function(n,juston,justoff,dstyle){n=n||document.body;if(typeof n=="string")
n=CT.dom.id(n);dstyle=dstyle||"block";if(juston||justoff)
n.style.display=juston&&dstyle||"none";else if(n.style.display==""&&n.className.indexOf("hidden")==-1)
n.style.display="none";else
n.style.display=(n.style.display==dstyle)&&"none"||dstyle;},"showHideSet":function(nodes,juston,justoff,dstyle){for(var i=0;i<nodes.length;i++)
CT.dom.showHide(nodes[i],juston,justoff,dstyle);},"show":function(n,dstyle){CT.dom.showHide(n,true,false,dstyle);},"hide":function(n){CT.dom.showHide(n,false,true);},"showV":function(n){CT.dom.showHideV(n,true);},"hideV":function(n){CT.dom.showHideV(n,false,true);},"remove":function(n){if(!n)return;if(typeof n=="string")n=CT.dom.id(n);n&&n.parentNode&&n.parentNode.removeChild(n);},"replace":function(target,replacement){if(typeof target=="string")
target=CT.dom.id(target);if(typeof replacement=="string")
replacement=CT.dom.div(replacement);if(target.parentNode){target.parentNode.insertBefore(replacement,target);target.parentNode.removeChild(target);}},"clear":function(n){if(typeof n=="string")
n=CT.dom.id(n);(n||document.body).innerHTML="";},"addContent":function(targetNode,content,withClass){if(typeof content=="function")
content=content();if(Array.isArray(content))
content=CT.dom.div(content,withClass);if(typeof targetNode=="string")
targetNode=CT.dom.id(targetNode,true);if(typeof content=="string"||typeof content=="number")
targetNode.innerHTML+=content;else if(content)
targetNode.appendChild(content);},"setContent":function(targetNode,content,withClass){CT.dom.clear(targetNode);CT.dom.addContent(targetNode,content,withClass);},"setMain":function(content){CT.dom.setContent("ctmain",content);},"setBody":function(content){CT.dom.setContent(document.body,content);},"addEach":function(parent,subs){subs.forEach(function(node){parent.appendChild(node);});},"ALLNODE":null,"loadAllNode":function(fallBackToBody){if(!CT.dom.ALLNODE){CT.dom.ALLNODE=document.getElementById("all")||(fallBackToBody&&document.body);CT.dom.ALLNODE._mobile=CT.align.width()<=720;window.onresize=function(){CT.dom.ALLNODE.resize&&CT.dom.ALLNODE.resize();CT.align.resize();};}},"getAllNode":function(fallBackToBody){CT.dom.loadAllNode(fallBackToBody);return CT.dom.ALLNODE;},"showAllNode":function(){var _a=CT.dom.ALLNODE;_a.style.opacity=_a.style["-moz-opacity"]=_a.style["-khtml-opacity"]="1";_a.style.filter="alpha(opacity = 100)";_a.style["-ms-filter"]="progid:DXImageTransform.Microsoft.Alpha(Opacity=100)";},"addStyle":function(text,href,obj){if(obj){text=[];for(var key in obj){text.push(key+" {");var pobj=obj[key];for(var prop in pobj)
text.push(prop+": "+pobj[prop]+";");text.push("}");}
text=text.join("\n");}
var node=href?CT.dom.node(null,"link",null,null,{"href":href,"rel":"stylesheet"}):CT.dom.node(text,"style");CT.dom.head(node);},"doWhenNodeExists":function(id,cb){var n=CT.dom.id(id);if(n)
return cb(n);setTimeout(CT.dom.doWhenNodeExists,500,id,cb);},"id":function(id,all){return document.getElementById(id)||all&&CT.dom._nodes[id];},"_narr2arr":function(nodeArray){var arr=[];for(var i=0;i<nodeArray.length;i++)
arr.push(nodeArray[i]);return arr;},"className":function(cname,n){return CT.dom._narr2arr((n||document).getElementsByClassName(cname));},"tag":function(tag,n){return CT.dom._narr2arr((n||document).getElementsByTagName(tag));},"attr":function(key,val,first){var r=CT.dom.Q("["+(val?(key+'="'+val+'"'):key)+"]");return first?r[0]:r;},"Q":function(q,n){return CT.dom._narr2arr((n||document.body).querySelectorAll(q));},"head":function(node){var head=CT.dom.tag("head")[0];if(node)
head.appendChild(node);return head;},"meta":function(name,content){var meta=CT.dom.node(null,"meta");meta.name=name;meta.content=content;CT.dom.head(meta);},"each":function(p,f){for(var i=0;i<p.childNodes.length;i++)
f(p.childNodes[i],i);},"map":function(p,f){var vals=[],i;f=f||function(i){return i;};for(i=0;i<p.childNodes.length;i++)
vals.push(f(p.childNodes[i]));return vals;},"childNum":function(n){return CT.dom.map(n.parentNode).indexOf(n);},"mod":function(opts){var targets=opts.targets?opts.targets:(opts.target?[opts.target]:(opts.className?CT.dom.className(opts.className):(opts.id?[CT.dom.id(opts.id)]:[]))),property=opts.property||"display",value=opts.value||(opts.show?"block":opts.hide?"none":""),modz=opts.modz;if(!modz){modz={};modz[property]=value;}
Object.keys(modz).forEach(function(property){for(var i=0;i<targets.length;i++)
targets[i].style[property]=modz[property];});}};;window.CT.file=window.CT.file||{};CT.file={dragdrop:function(cb,classname,label,id,multi){id=id||("dd"+Math.floor(Math.random()*1000));return CT.dom.div([CT.dom.label(label||"drag file here",id),CT.file.getter(cb,multi,"transparent",id)],classname||"w1 h80p dropper");},getter:function(cb,multi,classname,id){var f=CT.dom.file(function(e){if(multi){var files=[];for(var i=0;i<f.files.length;i++)
files.push(new CT.file.File({input:f,path:f.files[i].name,file:f.files[i]}));cb(files);}else{cb(new CT.file.File({input:f,path:f.value,file:f.files[0]}));}},id,classname,multi);return f;},make:function(data){if(!Array.isArray(data))
data=[data];return new CT.file.File({file:new Blob(data)});}};CT.file.File=CT.Class({CLASSNAME:"CT.file.File",download:function(dname,lname,dclass){lname=lname||"download";var l=CT.dom.link(lname,null,this.url,dclass,null,null,true);l.download=dname||this.name()||lname;return l;},name:function(){return this.opts.path&&this.opts.path.split("\\").pop();},upload:function(path,cb,params){var data=this.opts.file,headers={};if(params){headers["Content-Type"]="multipart/form-data";data=CT.net.formData(this.opts.file,params);}
CT.net.put(path,data,cb,headers,true,null,null,true);},init:function(opts){this.opts=opts;if(opts.input)
opts.input.ctfile=this;this.url=window.URL.createObjectURL(opts.file);}});;window.CT.gesture=window.CT.gesture||{};CT.gesture={gid:0,preventDefault:true,thresholds:{swipe:{minDistance:35,maxTime:400,minDP:600,maxDP:1000},drag:{minDP:0,maxDP:1000},tap:{maxDistance:10,maxTime:700,waitTime:300,maxCount:2},hold:{maxDistance:null,interval:1000},up:{androidDelay:600},pinch:{},zoom:{min:0.25,max:8,slow:2,wheel:{enabled:!CT.info.mobile&&!CT.info.isMac,jump:0.2}}},_vars:{active:false,startTime:null,dragTime:null,startPos:null,lastPos:null,tapCount:0,holdCount:0,zoomLevel:1,tapTimeout:null,holdInterval:null,stopTimeout:null,firstPinch:null,stopPropagation:false,preventDefault:false,iosPinch:false,iosPinching:false},gevents:{GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend"},events:(CT.info.mobile||CT.info.android||CT.info.iOs)&&{Start:"touchstart",Stop:"touchend",Move:"touchmove",Cancel:"touchcancel"}||{Start:"mousedown",Stop:"mouseup",Move:"mousemove"},handlers:{drag:{},swipe:{},tap:{},up:{},down:{},hold:{},pinch:{},hover:{},wheel:{}},tuneThresholds:function(){if(!CT.info.iOs)
for(var gest in CT.gesture.thresholds)
for(var constraint in CT.gesture.thresholds[gest]){var suffix=constraint.slice(3);if(suffix=="Distance")
CT.gesture.thresholds[gest][constraint]/=2;else if(suffix=="DP")
CT.gesture.thresholds[gest][constraint]*=2;}},getPos:function(e){if(e.x==undefined){e.x=e.pageX||e.changedTouches[0].pageX;e.y=e.pageY||e.changedTouches[0].pageY;}
return{x:e.x,y:e.y};},getDiff:function(p1,p2,mp){var d={};d.x=p2.x-p1.x;d.y=p2.y-p1.y;d.distance=Math.sqrt((d.x*d.x)+(d.y*d.y));if(mp)d.midpoint=CT.gesture.getMidpoint([p1,p2]);if(Math.abs(d.x)>Math.abs(d.y))
d.direction=d.x>0?'right':'left';else
d.direction=d.y>0?'down':'up';return d;},pinchDiff:function(e){return CT.info.iOs?{x:e['pageX'],y:e['pageY']}:CT.gesture.getDiff(CT.gesture.getPos(e.touches[0]),CT.gesture.getPos(e.touches[1]),true);},getMidpoint:function(points){var midpoint=function(coord){return(points[0][coord]+points[1][coord])/2;};return{x:midpoint('x'),y:midpoint('y')};},pixelsPerSecond:function(distance,timeDiff,gest){var t=CT.gesture.thresholds[gest];return Math.min(t.maxDP,Math.max(t.minDP,distance/timeDiff))*(CT.info.iOs?1:0.5);},isMulti:function(e){return CT.info.mobile&&e.touches.length>1;},onGestureStart:function(e,node){},onGestureChange:function(e,node){CT.gesture.triggerPinch(node,Math.pow(e.scale,(1/8)),CT.gesture.pinchDiff(e));},onGestureEnd:function(e,node){CT.gesture.triggerPinch(node,Math.pow(e.scale,(1/8)),CT.gesture.pinchDiff(e));node.gvars.iosPinching=false;},onStart:function(e,node){var t=CT.gesture.thresholds;var v=node.gvars;v.active=true;v.holdCount=0;v.startTime=v.dragTime=Date.now();v.startPos=v.lastPos=CT.gesture.getPos(e);if(v.tapTimeout){clearTimeout(v.tapTimeout);v.tapTimeout=null;}
if(CT.gesture.isMulti(e)){if(CT.info.android)
v.firstPinch=CT.gesture.pinchDiff(e);else
v.iosPinching=true;}else{v.holdInterval=setInterval(function(){if(!v.active||(t.hold.maxDistance&&(t.hold.maxDistance<CT.gesture.getDiff(v.startPos,v.lastPos).distance))){clearInterval(v.holdInterval);v.holdInterval=null;return;}
v.holdCount+=1;CT.gesture.triggerHold(node,t.hold.interval*v.holdCount);},t.hold.interval);}
return CT.gesture.triggerDown(node,CT.gesture.getPos(e));},onStop:function(e,node,delayed){var v=node.gvars;if(!delayed&&v.holdInterval){clearInterval(v.holdInterval);v.holdInterval=null;}
if(!v.active)return;var t=CT.gesture.thresholds;var pos=CT.gesture.getPos(e);var diff=CT.gesture.getDiff(v.startPos,pos);var timeDiff=Date.now()-v.startTime;v.active=!!(e.touches&&e.touches.length);if(!v.active&&!v.iosPinching){if((timeDiff<t.swipe.maxTime)&&(diff.distance>t.swipe.minDistance))
CT.gesture.triggerSwipe(node,diff.direction,diff.distance,diff.x,diff.y,CT.gesture.pixelsPerSecond(diff.distance,timeDiff,"swipe"));else if((timeDiff<t.tap.maxTime)&&(diff.distance<t.tap.maxDistance)){v.tapCount+=1;if(v.tapCount==t.tap.maxCount)
CT.gesture.triggerTap(node);else
v.tapTimeout=setTimeout(CT.gesture.triggerTap,t.tap.waitTime,node);}}
return CT.gesture.triggerUp(node,delayed);},onMove:function(e,node){var v=node.gvars,pos=CT.gesture.getPos(e);if(v.active){var pdiff,diff=CT.gesture.getDiff(v.lastPos,pos),now=Date.now(),tdiff=now-v.dragTime;v.lastPos=pos;v.dragTime=now;if(!CT.gesture.isMulti(e)){var rval=CT.info.mobile&&CT.gesture.triggerHover(node,pos);return CT.gesture.triggerDrag(node,diff.direction,diff.distance,diff.x,diff.y,CT.gesture.pixelsPerSecond(diff.distance,tdiff,"drag"))||rval;}
if(CT.info.android){pdiff=CT.gesture.pinchDiff(e);CT.gesture.triggerPinch(node,pdiff.distance/v.firstPinch.distance,pdiff.midpoint);}}else
return CT.gesture.triggerHover(node,pos);},onWheel:function(e,node){CT.gesture.triggerWheel(node,CT.gesture.getPos(e),e.deltaY);},gWrap:function(node){var e={};['GestureStart','GestureChange','GestureEnd'].forEach(function(eName){e[eName]=function(_e){_e.preventDefault();_e.stopPropagation();return CT.gesture['on'+eName](_e,node)||false;};});return e;},eWrap:function(node){var e={};['Start','Stop','Move'].forEach(function(eName){e[eName]=function(_e){node.gvars.preventDefault&&_e.preventDefault();node.gvars.stopPropagation&&_e.stopPropagation();return CT.gesture['on'+eName](_e,node)||(CT.gesture.preventDefault&&_e.preventDefault())||_e.stopPropagation()||false;};});if(CT.gesture.events.Cancel)
e.Cancel=e.Stop;return e;},zoom:function(node,normalizedDistance,midpoint){var t=CT.gesture.thresholds.zoom,v=node.gvars;v.zoomLevel=node.style.zoom=Math.max(t.min,Math.min(t.max,Math.pow(normalizedDistance*v.zoomLevel,1/t.slow)));},pinch2zoom:function(node){var w=CT.gesture.thresholds.zoom.wheel,v=node.gvars;CT.gesture.listen('pinch',node,function(normalizedDistance,midpoint){CT.gesture.zoom(node,normalizedDistance,midpoint);},true,true);w.enabled&&CT.gesture.listen("wheel",node,function(pos,delta){CT.gesture.zoom(node,v.zoomLevel*(1+
(delta>0?-w.jump:w.jump)),pos);});},listen:function(eventName,node,cb,stopPropagation,preventDefault){if(!node.gid){node.gid=++CT.gesture.gid;var e=node.listeners=CT.gesture.eWrap(node);for(var evName in CT.gesture.events)
node.addEventListener(CT.gesture.events[evName],e[evName]);node.gvars=CT.merge(CT.gesture._vars);}
if(eventName=="pinch"&&CT.info.iOs){var _e=CT.gesture.gWrap(node);for(var evName in CT.gesture.gevents)
node.addEventListener(CT.gesture.gevents[evName],_e[evName]);for(var k in _e)
node.listeners[k]=_e[k];node.gvars.iosPinch=true;}
else if(eventName=="wheel"&&!node.listeners.wheel){node.listeners.wheel=function(e){CT.gesture.onWheel(e,node);};node.addEventListener("wheel",node.listeners.wheel);}
node.gvars.stopPropagation=stopPropagation;node.gvars.preventDefault=preventDefault;if(!CT.gesture.handlers[eventName][node.gid])
CT.gesture.handlers[eventName][node.gid]=[];CT.gesture.handlers[eventName][node.gid].push(cb);},unlisten:function(node){if(node.gid){var e=node.listeners;for(var evName in CT.gesture.events)
node.removeEventListener(CT.gesture.events[evName],e[evName]);if(node.gvars.iosPinch){for(var evName in CT.gesture.gevents)
node.removeEventListener(CT.gesture.gevents[evName],e[evName]);}
if(e.wheel)
node.removeEventListener("wheel",e.wheel);for(var eventName in CT.gesture.handlers)
if(node.gid in CT.gesture.handlers[eventName])
delete CT.gesture.handlers[eventName][node.gid];delete node.gid;}},triggerPinch:function(node,normalizedDistance,midpoint){var handlers=CT.gesture.handlers.pinch[node.gid];if(handlers)for(var i=0;i<handlers.length;i++)
handlers[i](normalizedDistance,midpoint);},triggerSwipe:function(node,direction,distance,dx,dy,pixelsPerSecond){var handlers=CT.gesture.handlers.swipe[node.gid];hasSwiped=true;if(handlers)for(var i=0;i<handlers.length;i++)
handlers[i](direction,distance,dx,dy,pixelsPerSecond);},triggerTap:function(node){var v=node.gvars;var handlers=CT.gesture.handlers.tap[node.gid];if(handlers)for(var i=0;i<handlers.length;i++)
handlers[i](v.tapCount);v.tapCount=0;v.tapTimeout=null;},triggerDrag:function(node,direction,distance,dx,dy,pixelsPerSecond){var returnVal=false;var handlers=CT.gesture.handlers.drag[node.gid];if(handlers)for(var i=0;i<handlers.length;i++)
returnVal=handlers[i](direction,distance,dx,dy,pixelsPerSecond)||returnVal;return returnVal;},triggerHover:function(node,pos){var returnVal=false;var handlers=CT.gesture.handlers.hover[node.gid];if(handlers)for(var i=0;i<handlers.length;i++)
returnVal=handlers[i](pos)||returnVal;return returnVal;},triggerWheel:function(node,pos,delta){var handlers=CT.gesture.handlers.wheel[node.gid];if(handlers)for(var i=0;i<handlers.length;i++)
handlers[i](pos,delta);},triggerHold:function(node,duration){var handlers=CT.gesture.handlers.hold[node.gid];if(handlers)for(var i=0;i<handlers.length;i++)
handlers[i](duration);},triggerUp:function(node,delayed){var returnVal=false;var handlers=CT.gesture.handlers.up[node.gid];if(handlers)for(var i=0;i<handlers.length;i++)
returnVal=handlers[i](delayed)||returnVal;return returnVal;},triggerDown:function(node,pos){var returnVal=false;var handlers=CT.gesture.handlers.down[node.gid];if(handlers)for(var i=0;i<handlers.length;i++)
returnVal=handlers[i](pos)||returnVal;return returnVal;}};CT.gesture.tuneThresholds();;window.CT.hover=window.CT.hover||{};CT.hover={_:{},_pos:function(n,recursive,auto){if(auto){var rect=n.getBoundingClientRect();return[rect.left,rect.top];}
if(recursive){var left=0,top=0;while(!isNaN(n.offsetLeft)&&n!=CT.dom.ALLNODE){left+=n.offsetLeft;top+=n.offsetTop;n=n.parentNode;}
return[left,top];}
return[n.offsetLeft,n.offsetTop];},_hide:function(){var _=CT.hover._;setTimeout(function(){!_.nodeOn&&!_.hoverOn&&CT.dom.hide(_.infoBubble);},1000);},unset:function(node){if(typeof node=="string")
node=CT.dom.id(node,true);node.onmouseover=null;},set:function(node,content,poptop,stayopen,recursive,auto){if(arguments.length==1&&!(node instanceof Node)){var obj=arguments[0];node=obj.node;content=obj.content;poptop=obj.poptop;stayopen=obj.stayopen;recursive=obj.recursive;auto=obj.auto;}
var _=CT.hover._;if(!_.infoBubble){_.infoBubble=CT.dom.div("","small hidden infobubble");CT.dom.getAllNode(true).appendChild(_.infoBubble);_.bubbleBounds={'left':0,'top':0};}
if(typeof node=="string")
node=CT.dom.id(node,true);node.onmouseover=function(e){_.nodeOn=true;var npos=CT.hover._pos(node,recursive,auto);CT.dom.ALLNODE.appendChild(_.infoBubble);CT.dom.setContent(_.infoBubble,content);CT.dom.show(_.infoBubble);var voffset=poptop?-(_.infoBubble.clientHeight+10):((node.clientHeight||node.offsetHeight)+10);_.bubbleBounds.right=CT.dom.ALLNODE.clientWidth-_.infoBubble.clientWidth;_.bubbleBounds.bottom=CT.dom.ALLNODE.clientHeight-_.infoBubble.clientHeight;_.infoBubble.style.left=Math.min(_.bubbleBounds.right-10,Math.max(10,npos[0]-(_.infoBubble.clientWidth-(node.clientWidth||node.offsetWidth))/2))+"px";_.infoBubble.style.top=(npos[1]+voffset)+"px";auto&&e.stopPropagation();};node.onmouseout=function(){_.nodeOn=false;CT.hover._hide();};if(stayopen){content.onmouseover=function(e){_.hoverOn=true;};content.onmouseout=function(e){_.hoverOn=false;CT.hover._hide();};}
return node;}};;window.CT.key=window.CT.key||{};CT.key={_codes:[null,null,null,null,null,null,null,null,"BACKSPACE","TAB",null,null,null,"ENTER",null,null,"SHIFT","CTRL","ALT",null,"CAPS",null,null,null,null,null,null,"ESCAPE",null,null,null,null,"SPACE","PAGE_UP","PAGE_DOWN","END","HOME","LEFT","UP","RIGHT","DOWN",null,"PRINT",null,null,"INSERT","DELETE",null,"0","1","2","3","4","5","6","7","8","9",null,null,null,null,null,null,null,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","META_LEFT","META_RIGHT","SELECT",null,null,"NUMPAD_0","NUMPAD_1","NUMPAD_2","NUMPAD_3","NUMPAD_4","NUMPAD_5","NUMPAD_6","NUMPAD_7","NUMPAD_8","NUMPAD_9","MULTIPLY","ADD",null,"SUBTRACT","DECIMAL_POINT","DIVIDE","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"NUM_LOCK","SCROLL_LOCK",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"SEMICOLON","EQUALS","COMMA","DASH","PERIOD","FORWARD_SLASH","GRAVE_ACCENT",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"OPEN_BRACKET","BACK_SLASH","CLOSE_BRACKET","QUOTE"],_cbs:{},_downcbs:{},_downs:[],_init:function(){if(!CT.key._initialized){CT.key._initialized=true;window.onkeyup=CT.key._onUp;window.onkeydown=CT.key._onDown;}},_onDown:function(e){e=e||window.event;var code=e.keyCode||e.which,character=CT.key._codes[code];CT.data.append(CT.key._downs,character);CT.key._downcbs[character]&&CT.key._downcbs[character]();},_onUp:function(e){e=e||window.event;var code=e.keyCode||e.which,character=CT.key._codes[code];CT.data.remove(CT.key._downs,character);CT.key._cbs[character]&&CT.key._cbs[character]();},clear:function(character){if(character){delete CT.key._cbs[character];delete CT.key._downcbs[character];}else{CT.key._cbs={};CT.key._downcbs={};}},downs:function(chars){return chars.filter(function(c){return CT.key._downs.includes(c)});},down:function(character){CT.key._init();return CT.key._downs.indexOf(character)!=-1;},on:function(character,onup,ondown){CT.key._init();CT.key._cbs[character]=onup;if(ondown)
CT.key._downcbs[character]=ondown;}};;window.CT.layout=window.CT.layout||{};CT.layout={header:function(opts){opts=CT.merge(opts,{logo:"Placeholder Logo",right:[],rightPadding:"30px",centerLogo:true});var content=[];if(opts.img)
content.push(CT.dom.panImg(opts));if(opts.right instanceof Node||opts.right.length){if(opts.centerLogo)
content.push(CT.dom.node(opts.right,"div","right padded"));else
content.push(CT.dom.node(CT.dom.node(opts.right,"div","right h1",null,null,{padding:opts.rightPadding}),"div","abs top0 bottom0 right0 w1-2"));}
if(opts.centerLogo)
content.push(CT.dom.node(CT.dom.link(opts.logo,null,"/"),"center","biggerester"));else
content.push(CT.dom.link(opts.logo,null,"/","w1-2 biggest bold block nodecoration abs top0 bottom0 left0"));if(opts.marquee){var m=opts.marquee;content.push(CT.dom.marquee(m.content,m.className||"abs ctl mosthigh",m.direction,m.noresize));}
CT.dom.setContent(CT.dom.id("ctheader"),CT.dom.node(content,"div","h1 w1"));if(opts.title)
document.title=opts.title;},footer:function(opts){opts=CT.merge(opts,{logoClass:"left nodecoration",linksClass:"right p20",bottomClass:"small bline centered",logo:"Placeholder Logo",links:[],contact:{}});var rights=[],content=[];if(opts.img)
content.push(CT.dom.panImg(opts));content.push(CT.dom.link(opts.logo,null,"/",opts.logoClass));if(opts.links.length)
rights.push(opts.links.map(function(link){return CT.dom.link(link.content,link.cb,link.href,link.className||"padded");}));if(opts.contact.email||opts.contact.phone){var contacts=[];if(opts.contact.email_prefix)
contacts.push(CT.dom.div(opts.contact.email_prefix,"padded inline-block"));if(opts.contact.email)
contacts.push(CT.dom.div(opts.contact.email,"padded inline-block"));if(opts.contact.phone)
contacts.push(CT.dom.div(opts.contact.phone,"padded inline-block"));rights.push(contacts);}
if(rights.length)
content.push(CT.dom.node(rights,"div",opts.linksClass));if(opts.bottom)
content.push(CT.dom.node(opts.bottom,"div",opts.bottomClass));if(opts.extra)
content.push(opts.extra);document.body.classList.add("footered");document.body.appendChild(CT.dom.node(content,"div",null,"ctfooter"));},grid:function(data,columns,rows,hardheight){var className="w1-"+(columns||3)+" h1-"+(rows||4)
+" noflow inline-block hoverglow pointer",data2cell=function(d){var nstyle={backgroundImage:'url("'+d.img+'")',backgroundPosition:"center",backgroundSize:"cover"};if(hardheight)
nstyle.height=hardheight+"px";return CT.dom.div(CT.dom.div(d.label,"biggest centered p20p overlay",d.id,null,{paddingTop:"20%"}),className,null,{onclick:d.onclick||function(){location=d.link;}},nstyle);},gnode=CT.dom.div(data.map(data2cell),"full");gnode.addCell=function(d){gnode.appendChild(data2cell(d));};return gnode;},profile:function(opts){opts=CT.merge(opts,{className:"w2-3 h1 noflow abs",buttons:[]});var img=CT.dom.panImg(opts),buttons=CT.dom.div(null,"probutts");if(!opts.name&&opts.firstName&&opts.lastName)
opts.name=opts.firstName+" "+opts.lastName;for(var b in opts.buttons)
buttons.appendChild(CT.dom.button(b,opts.buttons[b],"round padded margined","ctb_"+(opts.key||opts.name)+"_"+b.replace(/ /g,"_")));var content=[CT.dom.div(opts.name,"biggest"),CT.dom.div(opts.description||opts.blurb),buttons];return opts.img?[CT.dom.div(content,"right w1-3 ctprofile"),img]:content;},listView:function(opts){opts=CT.merge(opts,{content:null,listNode:null,listContent:null,activeClass:null,fallback:null,hashcheck:null,parent:"ctmain",listClass:"ctlist big",contentClass:"ctcontent",titleClass:"biggerest bold bottompadded"});var content=CT.dom.div(null,opts.contentClass),clist=CT.dom.div(null,opts.listClass),builder=function(data){CT.dom.setContent(content,opts.content?opts.content(data):[CT.dom.div(data.name,opts.titleClass),data.content]);},tl=CT.panel.triggerList(opts.data,builder,opts.listNode,opts.activeClass,opts.listContent);clist.appendChild(tl);CT.dom.setContent(opts.parent,[content,clist]);var hcnode,tlitem=CT.dom.id("tl"+location.hash.slice(1));if(tlitem)
tlitem.trigger();else{if(opts.hashcheck)
hcnode=opts.hashcheck();if(hcnode)
CT.dom.setContent(content,hcnode);else{var titems=CT.dom.className("tlitem");if(titems.length)
titems[0].trigger();else if(opts.fallback)
CT.dom.setContent(content,opts.fallback());}}
return tl;},tree:function(opts){opts=CT.merge(opts,{path:"",nameCb:null,branches:{},cb:function(){},name:opts.title||"root",className:"m5 p5 vtop centered pointer inline-block"});var onclick=function(n){return function(e){opts.cb(n);e.stopPropagation();};};opts.path=!opts.path?opts.name:(opts.path+"_"+opts.name);opts.id="ctl_"+opts.path;var node=CT.dom.div([opts.nameCb?opts.nameCb(opts):opts.name,Object.keys(opts.branches).map(function(branch){return CT.layout.tree(CT.merge({name:branch,branches:opts.branches[branch].branches||{}},opts));})],opts.className,opts.id);node.onclick=onclick(node);return node;},form:function(opts){opts=CT.merge(opts,{className:"ctform",items:[],numbers:[]});var f,fields=[],nums=[],node=CT.dom.div(opts.items.map(function(item){if(opts.values&&opts.values[item.name]&&!item.value)
item=CT.merge(item,{value:opts.values[item.name]});f=CT.dom.smartField(item);fields.push(f);if(opts.labels){var cont=[CT.dom.label(item.name,f.id),f];if(opts.extra&&opts.extra[item.name])
cont.unshift(opts.extra[item.name](f));return cont;}
return f;}).concat(opts.numbers.map(function(nitem){f=CT.dom.numberSelector(nitem);nums.push(f);return[CT.dom.div(nitem.name,"right"),f];})),opts.className),i,val,name,vals={};node.value=function(){for(i=0;i<fields.length;i++){f=fields[i];val=f.fieldValue();name=opts.items[i].name;if(!val)
return alert("please provide a "+name);vals[name]=val;}
for(i=0;i<nums.length;i++)
vals[opts.numbers[i].name]=nums[i].value();opts.cb&&opts.cb(vals);return vals;};if(opts.button)
node.appendChild(CT.dom.button(opts.bname||"continue",node.value));return node;}};;window.CT.memcache=window.CT.memcache||{};CT.memcache={_local:{},_rq:function(action,cb,key,val,params,netargs){params=CT.merge(params,{action:action,key:key});if(val){if(params.mode=="blob")
return CT.net.formUp(val,CT.merge(netargs,{cb:cb,params:params,path:"/_memcache"}),"value");params.value=val;}
CT.net.post(CT.merge(netargs,{cb:cb,params:params,path:"/_memcache"}));},get:function(key,cb,localCache){var local=localCache&&CT.memcache._local[key];if(local)
cb(local);else
CT.memcache._rq("get",cb,key);},set:function(key,val,cb,localCache){if(localCache)
CT.memcache._local[key]=val;CT.memcache._rq("set",cb,key,val);},forget:function(key,cb,localCache){if(localCache&&CT.memcache._local[key])
delete CT.memcache._local[key];CT.memcache._rq("forget",cb,key);}};CT.memcache.blob={get:function(key,cb,btype){CT.memcache._rq("get",function(data){cb(new Blob([data],{type:btype}));},key,null,{mode:"blob"},{basic:true,responseType:"blob"});},set:function(key,blob,cb,transcode){var opts={mode:"blob"};if(transcode)
opts.transcode=true;CT.memcache._rq("set",cb,key,blob,opts);}};CT.memcache.countdown={get:function(key,cb){CT.memcache._rq("get",cb,key,null,{mode:"countdown"});},set:function(key,seconds,cb,meta){var params={mode:"countdown"};if(meta)
params.meta=meta;CT.memcache._rq("set",cb,key,seconds,params);},list:function(cb){CT.memcache._rq("get",cb,"_countdown_list",null,{mode:"countdown"});}};;window.CT.mobile=window.CT.mobile||{};CT.mobile={"options":{"mobile":["mobile","stretched"],"normal":["normal","stretched"],"tablet":["stretched","mobile"]},_dur:0,"fitNode":function(n,t,o,cb){var tline,w=CT.align.width()-10,toff=n&&CT.align.offset(n),ready;CT.dom.ALLNODE.mobileNode=n;if(CT.dom.ALLNODE._mode=="mobile")
tline="scale("+(w/n.clientWidth)+") translate(-"
+toff.left+"px,-"+toff.top+"px)";else
tline="scale("+(w/CT.dom.ALLNODE.clientWidth)+")";CT.trans.setVenderPrefixed(CT.dom.ALLNODE,"transform-origin",o?o:(w<CT.dom.ALLNODE.clientWidth?"0% 0%":"50% 0%"));CT.trans.trans({node:CT.dom.ALLNODE,property:"transform",value:t&&t||tline,duration:CT.mobile._dur,prefix:true,cb:function(){ready&&n&&n.scrollIntoView({block:"nearest",behavior:"smooth"});ready=true;cb&&cb();}});if(!CT.mobile._dur){CT.mobile._dur=1000;n&&n.scrollIntoView({block:"start",behavior:"auto"});}},"fitAndSnap":function(n,cb){if(CT.dom.ALLNODE.mobileNode)
CT.dom.ALLNODE.mobileNode.scrollIntoView({block:"nearest",behavior:"smooth"});CT.mobile.fitNode(n,null,null,cb);},"mobileSnap":function(cb){if(CT.dom.ALLNODE&&CT.dom.ALLNODE._mode=="mobile")
CT.mobile.fitAndSnap(CT.dom.ALLNODE._mobileDefault,cb);},"getMobileNode":function(bdata){if(bdata.id)
return document.getElementById(bdata.id);else{var cname=(CT.mobile.page&&CT.mobile.page[bdata.name])?CT.mobile.page[bdata.name]:bdata.firstClass;return document.getElementsByClassName(cname)[0];}},"mobileMenuLink":function(bdata){var pref="/img/"+(bdata.section?(bdata.page||bdata.section):"icons")+"/",name=bdata.name||(bdata.section&&bdata.icon)||bdata.page||bdata.icon,url=!(bdata.click||bdata.clickChild)&&bdata.page&&(bdata.page+".html"),cname="round bordered padded";if(url&&bdata.section)
url+="#!"+bdata.section;if(bdata.className)
cname+=" "+bdata.className;return CT.dom.labeledImage(pref+bdata.icon+".png",url,name,name,"centeredimg",cname,"centered nowrap small",false,(bdata.id||bdata.firstClass||bdata.click||bdata.clickChild)&&function(){CT.dom.ALLNODE.toggleMobileMenu();if(bdata.click)
CT.dom.id(bdata.click).onclick();else if(bdata.clickChild)
CT.dom.id(bdata.clickChild).firstElementChild.onclick();else
CT.mobile.fitAndSnap(CT.mobile.getMobileNode(bdata));},true,"mm"+name);},"initMobileMenus":function(mmbtn,loggedin,searchcb){mmbtn.tops=CT.dom.node(null,null,"button_row top_out","top_buttons");mmbtn.bottoms=CT.dom.node(null,null,"button_row bottom_out","bottom_buttons");var mobile_search=CT.dom.field("mobile_search");mmbtn.tops.appendChild(CT.dom.node(CT.dom.node([CT.dom.node("CAN Smart Search"),mobile_search],"div","round bordered padded","mobile_search_node"),"label",null,null,{"for":"mobile_search","htmlFor":"mobile_search"}));(CT.mobile.page&&CT.mobile.page.top||CT.mobile.menus.top).forEach(function(bdata){mmbtn.tops.appendChild(CT.mobile.mobileMenuLink(bdata));});CT.mobile.menus.bottom.forEach(function(bdata){mmbtn.bottoms.appendChild(CT.mobile.mobileMenuLink(bdata));});mmbtn.bottoms.appendChild(CT.mobile.mobileMenuLink(CT.mobile.menus.alternatives[loggedin?"participate":"login"]));CT.dom.inputEnterCallback(mobile_search,searchcb);CT.dom.blurField(mobile_search);document.body.appendChild(mmbtn.tops);document.body.appendChild(mmbtn.bottoms);var lefts=CT.mobile.page&&CT.mobile.page.left||CT.mobile.menus.left;if(lefts){mmbtn.lefts=CT.dom.node(null,null,"button_row_side left_out","left_buttons");lefts.forEach(function(bdata){mmbtn.lefts.appendChild(CT.mobile.mobileMenuLink(bdata));});document.body.appendChild(mmbtn.lefts);}
var rights=CT.mobile.page&&CT.mobile.page.right||CT.mobile.menus.right;if(rights){mmbtn.rights=CT.dom.node(null,null,"button_row_side right_out","right_buttons");rights.forEach(function(bdata){mmbtn.rights.appendChild(CT.mobile.mobileMenuLink(bdata));});document.body.appendChild(mmbtn.rights);}},"_mset":function(){var _a=CT.dom.ALLNODE,i,m,modes=["mobile","tablet"];for(i=0;i<modes.length;i++){m=modes[i];if(_a["_"+m])
return CT.mobile.options[m];}
return CT.mobile.options.normal;},"isMobile":function(){return CT.dom.ALLNODE._mobile;},"initResizer":function(loggedin,resdata,menus,page,searchcb){CT.mobile.menus=menus;CT.mobile.page=page;var curd,btn,mmbtn,_a=CT.dom.ALLNODE,zMode=function(){return CT.mobile._mset()[_a._mindex];};var setScroll=function(){var _doscroll=function(e){var n=_a.mobileNode||_a;if(n.getBoundingClientRect().bottom<CT.align.height())
n.scrollIntoView({block:"nearest",behavior:"smooth"});};window.onscroll=function(e){setTimeout(_doscroll,500);};window.addEventListener('touchmove',function(e){window.onscroll&&window.onscroll();});};_a._mobileDefault=_a.mobileNode=CT.mobile.getMobileNode((page&&page.top||menus.top)[1]);_a._mode=zMode();_a._mindex=0;_a._otherMode=function(){return CT.mobile._mset()[(_a._mindex+1)%2];};_a._swapMode=function(){_a._mindex=_a._mindex?0:1;setTimeout(function(){var vp=document.getElementsByTagName("meta");for(var i=0;i<vp.length;i++){if(vp[i].name=="viewport"){vp[i].content="width=device-width, initial-scale=1.0"
+((_a._mode=="mobile")?", min-scale=1.0, max-scale=1.0, user-scalable=no":"");break;}}},200);_a.resize();};_a.toggleMobileMenu=function(){if(mmbtn._on){mmbtn.tops.className="button_row top_out";mmbtn.bottoms.className="button_row bottom_out";if(mmbtn.lefts)
mmbtn.lefts.className="button_row_side left_out";if(mmbtn.rights)
mmbtn.rights.className="button_row_side right_out";}else{mmbtn.tops.className="button_row";mmbtn.bottoms.className="button_row";if(mmbtn.lefts)
mmbtn.lefts.className="button_row_side";if(mmbtn.rights)
mmbtn.rights.className="button_row_side";}
mmbtn._on=!mmbtn._on;};curd=resdata[_a._otherMode()];btn=CT.dom.img(curd.img,null,_a._swapMode,null,null,curd.alt,"resize_btn","round bordered padded");mmbtn=CT.dom.img("/img/mobile-menu.png",null,_a.toggleMobileMenu,null,null,"Mobile Menu","mobile_menu_btn","round bordered padded");_a.resize=function(){_a._mobile=CT.info.mobile||CT.align.width()<=720;_a._tablet=CT.info.tablet||CT.align.width()<=980;_a._mode=zMode();if(_a._mode=="normal")
CT.mobile.fitNode(null,"scale(1)","50% 0%");else if(_a._mode=="stretched")
CT.mobile.fitAndSnap(_a);else
CT.mobile.fitAndSnap(_a._mobileDefault);if(_a._mode=="mobile"){mmbtn.style.display="block";_a.chatBlock&&_a.chatBlock();}else{mmbtn.style.display="none";if(mmbtn._on)
mmbtn.onclick();}
var toggleMode=_a._otherMode();btn.title=btn.alt=resdata[toggleMode].alt;btn.firstChild.firstChild.src=resdata[toggleMode].img;};document.body.appendChild(btn);document.body.appendChild(mmbtn);CT.mobile.initMobileMenus(mmbtn,loggedin,searchcb);_a.resize();setScroll();}};;window.CT.modal=window.CT.modal||{};CT.modal={_defs:{transition:"slide"},defaults:function(opts){CT.modal._defs=CT.merge(opts,CT.modal._defs);},prompt:function(opts){var oz=CT.merge(opts,CT.modal._defs);if(oz.recycle)
oz.id=oz.id||oz.prompt;(new CT.modal.Prompt(oz)).show();},choice:function(opts){CT.modal.prompt(CT.merge(opts,{noClose:true,defaultIndex:0,style:"single-choice"}));},modal:function(content,onhide,opts,closeOnClick){var mod=new CT.modal.Modal(CT.merge(opts,{content:content,onclick:closeOnClick&&function(){mod.hide();}},CT.modal._defs));if(onhide)mod.on.hide=onhide;mod.show();return mod;},img:function(src,onhide){return CT.modal.modal(CT.dom.img(src,"wm200p hm200p"),onhide);},close:function(){if(CT.modal.latest){CT.modal.latest.hide();delete CT.modal.latest;}}};CT.modal._defaults={Modal:{className:"basicpopup",innerClass:"h1 w1 scroller",transition:"none",center:true,noClose:false,onclick:null,slide:{origin:"top"}},LightBox:{className:"backdrop",innerClass:"lightbox",transition:"fade",caption:"",noClose:true,outerClose:true},Prompt:{className:"basicpopup mosthigh",style:"string",prompt:"",clear:false,data:[]}};CT.modal.Modal=CT.Class({CLASSNAME:"CT.modal.Modal",visible:false,setup:{_centerv:function(parent){var val=parent.clientHeight||CT.align.height();val-=this.node.clientHeight;return val/2;},_centerh:function(parent){var val=parent.clientWidth||CT.align.width();val-=this.node.clientWidth;return val/2;},_fallbacks:function(parent,force){var n=this.node;if(force||(!n.style.top&&!n.style.bottom))
n.style.top=this.setup._centerv(parent)+"px";if(force||(!n.style.left&&!n.style.right))
n.style.left=this.setup._centerh(parent)+"px";},_add:function(parent,nocenter){var n=this.node;parent=(parent instanceof Node)?parent:document.body;CT.dom.addContent(parent,n);this.opts.center&&!nocenter&&this.setup._fallbacks(parent);},none:function(){var n=this.node;n.show=this.setup._add;n.hide=function(){CT.dom.remove(n);};},fade:function(){var n=this.node,add=this.setup._add;n.show=function(parent){n.style.opacity=0;add(parent);setTimeout(function(){CT.trans.trans({node:n,property:"opacity",value:1});},100);};n.hide=function(){CT.trans.trans({node:n,property:"opacity",value:0,cb:function(){CT.dom.remove(n);}});};},slide:function(){var n=this.node,add=this.setup._add,origin=this.opts.slide.origin,center=this.opts.center,centerv=this.setup._centerv,centerh=this.setup._centerh,fallbacks=this.setup._fallbacks,ver=false,hor=false;var _refresh=function(parent,force){parent=(parent instanceof Node)?parent:document.body;["top","bottom"].forEach(function(side,sideIndex){if(origin.startsWith(side)){n.style[side]=-n.clientHeight+"px";n._vout={node:n,property:side,value:n.style[side]};n._vin={node:n,property:side,value:(center?centerv(parent):0)+"px"};ver=true;}});["left","right"].forEach(function(side,sideIndex){if(origin.endsWith(side)){n.style[side]=-n.clientWidth+"px";n._hout={node:n,property:side,value:n.style[side]};n._hin={node:n,property:side,value:(center?centerh(parent):0)+"px"};hor=true;}});fallbacks(parent,force);};n.show=function(parent){add(parent,true);n.recenter(parent,true);};n.hide=function(){ver&&CT.trans.trans(n._vout);hor&&CT.trans.trans(n._hout);CT.trans.trans({cb:function(){CT.dom.remove(n);}});};n.recenter=function(parent,noforce){_refresh(parent,!noforce);setTimeout(function(){ver&&CT.trans.trans(n._vin);hor&&CT.trans.trans(n._hin);},100);};}},on:{show:function(){},hide:function(){}},hide:function(){this.node.hide();this.visible=false;this.on.hide();},_show:function(n){this.node.show(n);this.visible=true;this.on.show();},show:function(n,cb){if(typeof n=="string")
n=CT.dom.id(n);setTimeout(this._show,0,n);cb&&setTimeout(cb,200);},showHide:function(n){this.visible?this.hide():this.show(n);},addClose:function(){this.node.insertBefore(CT.dom.div(CT.dom.link("X",this.hide),"abs ctr above"),this.node.firstChild);},build:function(){},clear:function(){this.node.lastChild.innerHTML="";},isClear:function(){return!this.node.lastChild.childElementCount;},add:function(content){CT.dom.addContent(this.node.lastChild,content);},set:function(node){this.clear();this.add(node);},_buildContent:function(){var opts=this.opts,nodeStyle={},sub=CT.dom.div(null,opts.innerClass);["top","bottom","right","left"].forEach(function(side){if(side in opts.slide)
nodeStyle[side]=opts.slide[side];});this.node=opts.id&&CT.dom.id(opts.id)||CT.dom.div(null,opts.className,opts.id,{onclick:opts.onclick},nodeStyle);CT.dom.setContent(this.node,sub);if(!opts.noClose)
this.addClose();this.node.modal=this;this.setup[opts.transition]();this.build();if(opts.content||opts.node)
this.add(opts.content||opts.node);this.opts.recenter&&setTimeout(this.node.recenter,500);this.opts.resizeRecenter&&window.addEventListener("resize",this.node.recenter);},init:function(opts){this.opts=CT.merge(opts,CT.modal._defaults.Modal);setTimeout(this._buildContent);CT.modal.latest=this;}});CT.modal.LightBox=CT.Class({init:function(opts){var thiz=this;this.opts=opts=CT.merge(opts,{onclick:function(e){if(opts.outerClose&&(e.currentTarget==e.target))thiz.hide();},content:CT.dom.div(CT.dom.div(this.opts.caption,"biggest bold padded round translucent full-center white grayback pointer hoverglow"),"backdrop-img filler","",null,{backgroundImage:"url("+this.opts.img+")"})},CT.modal._defaults.LightBox,CT.modal._defaults.Modal);}},CT.modal.Modal);CT.modal.Prompt=CT.Class({CLASSNAME:"CT.modal.Prompt",_input:{string:function(){if(this.opts.autocomplete)
return CT.autocomplete.DBGuesser({rows:true,input:CT.dom.field(),tapCb:this.submitAC,property:this.opts.autocomplete.property,modelName:this.opts.autocomplete.modelName}).input;else{return CT.dom.smartField({cb:this.submit,isTA:this.opts.isTA,blurs:this.opts.blurs,classname:this.opts.inputClass});}},"multiple-string":function(){var fl=CT.dom.fieldList();this.node.appendChild(fl.empty);this.node.appendChild(fl.addButton);return fl;},password:function(){return CT.dom.smartField(this.submit,null,null,null,"password");},phone:function(){return CT.parse.numOnly(CT.dom.smartField(this.submit),false,true);},email:function(){return CT.dom.smartField(this.submit);},"single-choice":function(data){var cz=CT.dom.choices(this._nodify(data));if("defaultIndex"in this.opts)
cz.childNodes[this.opts.defaultIndex].onclick();return cz;},"multiple-choice":function(data){var selz=this.opts.selections,lnkz=this.opts.linkages,cz=CT.dom.choices(this._nodify(data),true,null,null,lnkz&&function(i){var val=data[i],trig;if(cz.value.includes(i)&&(val in lnkz)){for(trig of lnkz[val]){ti=data.indexOf(trig);cz.value.includes(ti)||cz.childNodes[ti].onclick();}}});selz&&CT.dom.each(cz,function(sel){if(selz.includes(sel.innerHTML))
sel.onclick();});return cz;},"reorder":function(data){return CT.dom.shuffler(data,this.opts.rower);},"draggers":function(data){var oz=this.opts;return CT.dom.dragListList(data,oz.rower,oz.colattrs,oz.colstyle,oz.dataer);},"file":function(){this.continueButton.disabled=true;return CT.file.getter(function(ctf){if(ctf.opts.path)
this.continueButton.disabled=false;}.bind(this));},"number":function(){return CT.dom.numberSelector(this.opts);},"time":function(){return CT.dom.timeSelector();},"date":function(data){var oz={update:true};if(data)oz.now=data;return(new CT.cal.Cal(oz)).node;},"form":function(data){return CT.layout.form({items:data||[],labels:this.opts.labels,numbers:this.opts.numbers||[]});},"icon":function(data){return CT.dom.iconSelector(data,true);},"sound":function(data){return CT.dom.soundSelector(data,true);}},on:{show:function(){this.input&&!this.opts.blurs&&this.input.focus();if(this.opts.clear)
this.input.value="";},hide:function(){}},submitAC:function(d){this.opts.cb(d);this.hide();},submit:function(){if(this.opts.style=="multiple-choice"){var that=this;this.opts.cb(this.input.value.map(function(val){return that.opts.data[val];}));}else{if(this.opts.style=="phone"&&this.input.value.length!=10)
return alert("please use a 10-digit phone number");else if(this.opts.style=="email"&&!CT.parse.validEmail(this.input.value))
return alert("please enter a valid email address");this.opts.cb(this.input&&(this.input.ctfile||((typeof this.input.value=="function")&&this.input.value())||this.opts.data[this.input.value]||this.input.value));}
this.hide();},_nodify:function(data){return data.map(function(d){if(typeof d=="string")
return CT.dom.node(d);else if(!(d instanceof Node))
return CT.dom.node(d.name||d.title||d.label);return d;});},build:function(){this.continueButton=CT.dom.button("Continue",this.submit);this.node.appendChild(CT.dom.node(this.opts.prompt));if(this.opts.style!="confirm"){this.input=this._input[this.opts.style](this.opts.data);this.node.appendChild(this.input);}
this.node.appendChild(this.continueButton);this.node.appendChild(CT.dom.button("Cancel",this.hide));},init:function(opts){this.opts=CT.merge(opts,CT.modal._defaults.Prompt,this.opts);}},CT.modal.Modal);;window.CT.panel=window.CT.panel||{};CT.panel={"view1":{},"lastClicked":{},"accordion":function(data,triggerCb,activeClass,content,condition,notick,rmbutton,ricon,noactive){var n=CT.dom.node(null,null,"tabbed","ac"+data.name);n.add=function(tdata,makeFirst,addAlpha){var i,inserted,t=CT.panel.trigger(tdata,triggerCb,activeClass,content,condition,rmbutton,ricon,noactive);if(makeFirst)
n.insertBefore(t,n.firstChild);else if(addAlpha){for(i=0;i<n.childNodes.length;i++){if(n.childNodes[i].data.name>t.data.name){n.insertBefore(t,n.childNodes[i]);inserted=true;break;}}
if(!inserted)
n.appendChild(t);}else
n.appendChild(t);return t;};n._drops=[];n.expand=function(){n._drops.forEach(function(d){d.expand();});};n.retract=function(){n._drops.forEach(function(d){d.retract();});};data.forEach(function(d){if(d.children){var tick=CT.dom.node(">","div","inline-block"+(notick&&" hidden"||"")),t=CT.dom.node(),tline=[tick,CT.dom.link(content?content(d):d.name,null,null,"inline-block pointer acheader")];if(ricon)
tline.unshift(CT.dom.node(ricon(d),"div","right rpaddedsmall"));CT.dom.setContent(t,tline);t.content=CT.panel.accordion(d.children,triggerCb,activeClass,content,condition,notick,rmbutton,ricon,noactive);n.appendChild(t);n._drops.push(new CT.Drop({anchor:t,parent:n,relative:true,constrained:false,setNodeClick:false,content:t.content,onShow:function(){CT.trans.rotate(tick,{duration:100,degrees:90});},onHide:function(){CT.trans.rotate(tick,{duration:100,degrees:0});}}));}else
n.add(d);});return n;},"trigger":function(data,cb,activeClass,content,condition,rmbutton,ricon,noactive,hovs){var label=data.label||data.title||data.name||data.topic||data,key=data.key||label,hovcon=hovs&&hovs[label],n=CT.dom.node(null,"div","tlitem",key&&("tl"+key.replace(/ /g,"")));hovcon&&CT.hover.set({node:n,content:hovcon,auto:true});activeClass=activeClass||"activetab";n.data=data;data.node=n;n.select=function(){!noactive&&CT.dom.each(n.parentNode,function(c){if(c==n)
c.classList.add(activeClass);else
c.classList.remove(activeClass);c.className=(c==n)?activeClass:"";});};n.trigger=function(){if(condition&&!condition())return;n.select();cb(data);};n.remove=function(){CT.dom.remove(n);n.onRemove&&n.onRemove();};n.nameNode=CT.dom.link(content?content(data):label,n.trigger);n.rename=function(name){data.label=name;n.id="tl"+name.replace(/ /g,"");CT.dom.setContent(n.nameNode,name);};if(ricon)
n.appendChild(CT.dom.node(ricon(data),"div","right rpaddedsmall"));if(rmbutton)
n.appendChild(CT.dom.link("X",n.remove,null,"right"));n.appendChild(n.nameNode);return n;},"triggerList":function(data,cb,node,activeClass,content,condition,rmbutton,ricon,noactive,hovs){node=node||CT.dom.node();node.postAdd=function(d,trigger){var t=CT.panel.trigger(d,cb,activeClass,content,condition,rmbutton,ricon,noactive,hovs);node.appendChild(t);(trigger===true)&&t.trigger();};node.preAdd=function(d,trigger){var t=CT.panel.trigger(d,cb,activeClass,content,condition,rmbutton,ricon,noactive,hovs);if(node.childNodes.length)
node.insertBefore(t,node.firstChild);else
node.appendChild(t);trigger&&t.trigger();};data.forEach(node.postAdd);return node;},"slider":function(data,triggerNode,parentNode,ricon,activeClass,content,resize,hovs,clearz,ngen,tfirst){var node=CT.dom.div(null,"abs w1 hmin1 t0 l0 r0");if(typeof triggerNode=="string")
triggerNode=CT.dom.id(triggerNode);if(typeof parentNode=="string")
parentNode=CT.dom.id(parentNode);if(clearz){CT.dom.clear(parentNode);CT.dom.clear(triggerNode);}
(parentNode||document.body).appendChild(node);node._subs=[];node.slide=function(d){node._cur=d;CT.trans.translate(node,{y:-node.clientHeight*node._subs.indexOf(d)});};node.add=function(d,trigger){var n=CT.dom.div(null,"abs full l0 r0 scrolly"),t=CT.panel.trigger(d,node.slide,activeClass,content,null,null,ricon,null,hovs);n.style.top=(node.clientHeight*node._subs.length)+"px";if(ricon)
t.appendChild(CT.dom.div(null,"clearnode"));node._subs.push(d);node.appendChild(n);ngen&&CT.dom.setContent(n,ngen(d));triggerNode.appendChild(t);if((trigger===true)||(tfirst&&(trigger==0)))
t.trigger();return n;};data.forEach(node.add);resize&&CT.on("resize",function(){CT.dom.each(node,function(n,i){n.style.top=(node.clientHeight*i)+"px";});node._cur&&node.slide(node._cur);});return node;},"swap":function(key,trysidepanel,keystring,noitem){keystring=keystring||"sb";key=key.replace(/ /g,"");var items=CT.dom.className(keystring+"panel");for(var i=0;i<items.length;i++)
items[i].className=keystring+"panel hidden";CT.dom.id(keystring+"panel"+key,true).className=keystring+"panel";if(trysidepanel){var n=CT.dom.id(keystring+"panel"+key+"Side");if(n)n.className=keystring+"panel";var n2=CT.dom.id(keystring+"panel"+key+"Side2");if(n2)n2.className=keystring+"panel";}
if(!noitem)
CT.panel.select(key,keystring);var ksk=keystring+key;if(CT.panel.view1[ksk]){CT.panel.view1[ksk](key);delete CT.panel.view1[ksk];}},"drill":function(keymap){for(var k in keymap)
CT.panel.swap(keymap[k],false,k);},"select":function(key,keystring){keystring=keystring||"sb";var items=CT.dom.className(keystring+"item");for(var i=0;i<items.length;i++)
items[i].className=items[i].className.replace(" activetab","");if(key){CT.dom.id(keystring+"item"+key,true).className+=" activetab";CT.panel.lastClicked[keystring]=key;}
CT.mobile&&CT.mobile.mobileSnap();},"selectLister":function(newkey,oldkey,newhtml){if(oldkey)
CT.dom.id("ll"+oldkey).className="pointer";var newnode=CT.dom.id("ll"+newkey);newnode.className="pointer activetab";if(newhtml)
newnode.firstChild.innerHTML=newhtml;CT.mobile&&CT.mobile.mobileSnap();},"add":function(key,trysidepanel,keystring,itemnode,panelnode,nospace,icon,cb,condition,view1,clearcontent){nospace=nospace||key.replace(/ /g,"");keystring=keystring||"sb";if(!CT.dom.id(keystring+"panel"+nospace)){var n=CT.dom.node("","div",keystring+"panel hidden",keystring+"panel"+nospace);n.appendChild(CT.dom.node(key,"div","bigger blue bold bottompadded"));n.appendChild(CT.dom.node("","div","",keystring+"content"+nospace));(panelnode||CT.dom.id(keystring+"panels")).appendChild(n);}else if(clearcontent)
CT.dom.clear(keystring+"content"+nospace);var i=CT.dom.id(keystring+"item"+nospace);if(i)
i.style.display="block";else{itemnode=itemnode||CT.dom.id(keystring+"items");var clickfunc=function(){if(condition&&!condition())return;CT.panel.swap(nospace,trysidepanel,keystring);cb&&cb();};if(icon)
itemnode.appendChild(CT.dom.node(CT.dom.img(icon,null,clickfunc),"div","lfloat shiftleft"));itemnode.appendChild(CT.dom.node(CT.dom.link(key,clickfunc),"div",keystring+"item pointer",keystring+"item"+nospace));if(icon)
itemnode.appendChild(CT.dom.node("","div","clearnode"));}
if(view1)
CT.panel.view1[keystring+key]=view1;},"rename":function(oldkey,newkey,keystring,item2keystring){keystring=keystring||"sb";var nsold=oldkey.replace(/ /g,""),nsnew=newkey.replace(/ /g,""),item=CT.dom.id(keystring+"item"+nsold),panel=CT.dom.id(keystring+"panel"+nsold),content=CT.dom.id(keystring+"content"+nsold);item.id=keystring+"item"+nsnew;panel.id=keystring+"panel"+nsnew;if(content)content.id=keystring+"content"+nsnew;item.firstChild.innerHTML=panel.firstChild.innerHTML=newkey;var item2=item2keystring&&CT.dom.id(item2keystring+"item"+nsold);if(item2){item2.id=nsnew;item2.firstChild.innerHTML=newkey;}},"remove":function(key,keystring){var nospace=key.replace(/ /g,"");var p=CT.dom.id(keystring+"panel"+nospace);if(p)p.style.display="none";var l=CT.dom.id(keystring+"item"+nospace);if(l)l.style.display="none";},"load":function(pnames,trysidepanel,keystring,itemnode,panelnode,nospaces,icons,noclear,stillswap,cbs,condition,view1,clearcontent){keystring=keystring||"sb";if(!noclear)
(itemnode||CT.dom.id(keystring+"items")).innerHTML="";for(var i=0;i<pnames.length;i++)
CT.panel.add(pnames[i],trysidepanel,keystring,itemnode,panelnode,nospaces&&nospaces[i]||null,icons&&icons[i]||null,cbs&&cbs[i]||null,condition,view1,clearcontent);if(pnames.length&&(stillswap||(!itemnode&&!noclear)))
CT.panel.swap(pnames[0],trysidepanel,keystring);},"simple":function(pnames,keystring,itemnode,panelnode,cbs,condition,trysidepanel,nospaces,icons,noclear,stillswap,view1,clearcontent){if(arguments.length==1&&typeof arguments[0]!="string"){var obj=arguments[0];pnames=obj.pnames;keystring=obj.keystring;itemnode=obj.itemnode;panelnode=obj.panelnode;cbs=obj.cbs;condition=obj.condition;trysidepanel=obj.trysidepanel;nospaces=obj.nospaces;icons=obj.icons;noclear=obj.noclear;stillswap=obj.stillswap;view1=obj.view1;clearcontent=obj.clearcontent;}
CT.panel.load(pnames,trysidepanel,keystring,itemnode,panelnode,nospaces,icons,noclear,stillswap!=false,cbs,condition,view1,clearcontent);},"pager":function(getContent,request,limit,colClass,dataClass,ks){var keystring=ks||("p"+CT.Pager._id),content=CT.dom.node(null,null,dataClass,keystring+"panels"),sideBar=CT.dom.node(),pager=new CT.Pager(function(data){var dnames=data.map(function(d){return d.label;});CT.panel.simple(dnames,keystring,sideBar,content);data.forEach(function(d){CT.dom.setContent(CT.dom.id(keystring+"content"
+d.label.replace(/ /g,""),true),getContent(d));});return sideBar;},request,limit,colClass,keystring+"items"),n=CT.dom.node([pager.node,content]);n.pager=pager;return n;},"alternatebg":function(n,watchforicons,resetonbreak){n=n||document.getElementById("sbitems");if(watchforicons){var switcher=1;for(var i=0;i<n.childNodes.length;i++){var c=n.childNodes[i];if(c.className.indexOf("lfloat")==-1&&c.className.indexOf("clearnode")==-1){if(resetonbreak&&c.nodeName=="BR"){switcher=1;continue;}
if(switcher==1)
c.style.background="#899fb0";switcher*=-1;}}}
else{for(var i=0;i<n.childNodes.length;i+=2)
n.childNodes[i].style.background="#899fb0";}}};;window.CT.parse=window.CT.parse||{};CT.parse={"_linkProcessor":null,"_NUMS":'0123456789',"imgTypes":[".png",".PNG",".jpg",".JPG",".gif",".GIF",".img",".IMG",".bmp",".BMP","jpeg","JPEG"],"setLinkProcessor":function(cb){CT.parse._linkProcessor=cb;},"breakurl":function(url){return url.replace(/&/g,"&&#8203;").replace(/\//g,"/&#8203;").replace(/_/g,"_&#8203;");},"url2link":function(rurl,rname){var furl=rurl;if(furl.slice(0,7)=="http://")
rurl=rurl.slice(7);else if(furl.slice(0,8)=="https://")
rurl=rurl.slice(8);else
furl="http://"+furl;return'<a target="_blank" href='+furl+'>'+(rname||CT.parse.breakurl(rurl))+"</a>";},"processLink":function(url,customArg){var itz=CT.parse.imgTypes,ext=url.slice(-4);if(itz.indexOf(ext)!=-1)
return'<img src='+url+'>';for(var i=0;i<itz.length;i++){if(url.indexOf(itz[i]+"?")!=-1)
return'<img src='+url+'>';}
return CT.parse._linkProcessor&&CT.parse._linkProcessor(url,customArg)||CT.parse.url2link(url);},"validEmail":function(s){var atChar=s.indexOf('@',1);var dotChar=s.indexOf('.',atChar);if(atChar==-1||dotChar==-1||dotChar==s.length-1||atChar+2>dotChar)
return false;return true;},"validPassword":function(s){return s&&s.length>5;},"numOnly":function(n,allowDot,noNeg){n.onkeyup=function(){var i,c,v="",hasdot=false;for(i=0;i<n.value.length;i++){c=n.value.charAt(i);if(allowDot&&!hasdot&&c==".")
hasdot=true;else if(!(!noNeg&&!i&&c=="-")&&(CT.parse._NUMS.indexOf(c)==-1))
continue;v+=c;}
n.value=v;};return n;},"capitalize":function(word){return word.slice(0,1).toUpperCase()+word.slice(1);},"toCaps":function(lowers){var uppers=[];for(var i=0;i<lowers.length;i++)
uppers.push(CT.parse.capitalize(lowers[i]));return uppers;},"key2title":function(k){return CT.parse.toCaps(k.split("_")).join(" ");},"words2title":function(k){return CT.parse.toCaps(k.split(" ")).join(" ");},"keys2titles":function(lowers){var uppers=[];for(var i=0;i<lowers.length;i++)
uppers.push(CT.parse.key2title(lowers[i]));return uppers;},"month2num":function(month){return CT.dom._monthnames.indexOf(month)+1;},"extractImage":function(s){var i,j,token,ytparts,itz=CT.parse.imgTypes,tokens=s.replace(/\n/g," ").replace(/</g," <").replace(/>/g,"> ").replace(/&amp;/g,"&").split(" ");for(i=0;i<tokens.length;i++){token=tokens[i];if(token.startsWith("http")){if(itz.indexOf(token.slice(-4))!=-1)
return token;for(j=0;j<itz.length;j++){if(token.indexOf(itz[j]+"?")!=-1)
return token;}
ytparts=token.split("?v=");if(ytparts.length==2)
return'https://img.youtube.com/vi/'+ytparts[1]+'/0.jpg';}}},"stripLast":function(w){var lcs="",lc=w.charAt(w.length-1);while(['.',',',':',';',')',']','!'].indexOf(lc)!=-1){w=w.slice(0,w.length-1);lcs=lc+lcs;lc=w.charAt(w.length-1);}
return[lcs,w];},"stripToNums":function(s){s=s||"";var newStr='';for(var i=0;i<s.length;i++){if(CT.parse._NUMS.indexOf(s.charAt(i))!=-1)
newStr+=s.charAt(i);}
return newStr;},"stripToZip":function(s){var newStr=CT.parse.stripToNums(s);if(newStr.length<5)
return"";return newStr.slice(0,5);},"stripToPhone":function(s){var newStr=CT.parse.stripToNums(s);if(newStr.length<10)
return"";return newStr.slice(0,10);},"formatPhone":function(s){var pn=CT.parse.stripToPhone(s);return pn.slice(0,3)+"-"+pn.slice(3,6)+"-"+pn.slice(6);},"formatPhoneLink":function(s){var pn=CT.parse.formatPhone(s);return"<a href='tel:+1"+pn+"'>"+pn+"</a>";},"shortened":function(txt,len,wlen,nolink){if(nolink)
txt=txt.replace(/\n/g," ").split(" http")[0];var orig=txt;len=len||500;if(wlen)
txt=txt.split(" ").slice(0,wlen).join(" ");if(txt.length>len)
txt=txt.slice(0,len);if(txt!=orig)
txt+=" ...";return txt;},"sanitize":function(b){var sstart="<scr"+"ipt";var send="</sc"+"ript>";var ssi=b.indexOf(sstart);while(ssi!=-1){var sei=b.indexOf(send,ssi);if(sei==-1)
sei=b.length;b=b.slice(0,ssi)+b.slice(sei+9,b.length);ssi=b.indexOf(sstart);}
return b.replace(/^\s+|\s+$/g,"");},"niceNum":function(n){if(n<999)return n;var str=n.toString(),pos=str.length-3;while(pos>0){str=str.slice(0,pos)+","+str.slice(pos);pos-=3;}
return str;},"_countdown":function(secs){var mins,hours,days,parts=[];mins=~~(secs/60);secs-=mins*60;hours=~~(mins/60);mins-=hours*60;days=~~(hours/24);hours-=days*24;if(days)
parts.push(days+" days");if(hours)
parts.push(hours+" hours");if(mins)
parts.push(mins+" minutes");if(secs)
parts.push(~~secs+" seconds");return parts.join(", ");},"countdown":function(secs,cb){var n=CT.dom.span(CT.parse._countdown(secs));setInterval(function(){secs-=1;CT.dom.setContent(n,CT.parse._countdown(secs));!secs&&cb&&cb();},1000);return n;},"date2string":function(d,noletters){d=d||new Date();var month=d.getMonth()+1,date=d.getDate();if(month<10)
month='0'+month;if(date<10)
date='0'+date;return d.getFullYear()+'-'+month+'-'+date+(noletters?' ':'T')+d.getHours()
+':'+d.getMinutes()+':'+d.getSeconds()+(noletters?'':'Z');},"string2date":function(s){var year,month,rest,day,hour,minute,second;[year,month,rest]=s.split("-");day=rest.slice(0,2);if(rest.indexOf(":")!=-1){[hour,minute,second]=rest.slice(3).split(":");second=parseInt(second);}
return new Date(year,parseInt(month)-1,day,hour,minute,second);},"_stampString":function(diff,name){if(!diff)return false;return diff+" "+name+(diff==1?"":"s");},"_ts_server_offset":0,"set_ts_server_offset":function(offset){CT.log("[DEPRECATION WARNING] CT.parse.set_ts_server_offset() is deprecated. Just stop using it!");CT.parse._ts_server_offset=offset;},"timeStamp":function(datetime){var now=new Date(),then=new Date(datetime.replace('T',' ').replace(/-/g,'/')+"Z"),secs=(now-then)/1000,mins=~~(secs/60),hours=~~(mins/60),days=~~(hours/24);return(CT.parse._stampString(days,"day")||CT.parse._stampString(hours,"hour")||CT.parse._stampString(mins,"min")||"moments")+" ago";},"process":function(c,simple,customArg){if(!c)return"";var cmodded=c.replace(new RegExp(String.fromCharCode(10),'g'),' ').replace(new RegExp(String.fromCharCode(13),'g'),' ').replace(/</g," <").replace(/>/g,"> ").replace(/&nbsp;/g," ").replace(/  /g,' ');var phoneMatches=cmodded.match(/\d{3}-\d{3}-\d{4}/g);if(phoneMatches)phoneMatches.forEach(function(matchstr){var i=cmodded.indexOf(matchstr);var prev=cmodded.charAt(i-1);if(prev!=">"&&prev!=":"&&prev!="0"&&cmodded.slice(i-2,i)!="+1")
cmodded=cmodded.replace(matchstr,CT.parse.formatPhoneLink(matchstr));});var clist=cmodded.trim().split(" ");for(var i=0;i<clist.length;i++){var w=clist[i];if(w.indexOf(":")==-1&&CT.parse.validEmail(w)){clist[i]="<a href='mailto:"+w+"'>"+w+"</a>";continue;}
var fci=w.indexOf("https://");if(fci==-1)
fci=w.indexOf("http://");if(fci!=-1&&w[fci-1]!='"'){var frontCap=w.slice(0,fci);w=w.slice(fci);var endCap="";var eci=w.indexOf('<');if(eci!=-1){endCap=w.slice(eci);w=w.slice(0,eci);}
var sl=CT.parse.stripLast(w),lc=sl[0],w=sl[1];clist[i]=frontCap+(simple?CT.parse.url2link:CT.parse.processLink)(w,customArg)+lc+endCap;}}
return clist.join(" ").replace(/ <\//g,"</");}};;window.CT.pubsub=window.CT.pubsub||{};CT.pubsub={"_":{"ws":null,"b64":false,"args":null,"open":false,"initialized":false,"autohistory":false,"autohistory_exemptions":[],"reconnect":true,"reconnect_interval":250,"protocol":location.protocol=="http:"&&"ws"||"wss","log":CT.log.getLogger("CT.pubsub"),"queue":[],"channels":{},"cb":{"snapshot":CT.log.getLogger("CT.pubsub|snapshot"),"pm":CT.log.getLogger("CT.pubsub|pm"),"meta":CT.log.getLogger("CT.pubsub|meta"),"chmeta":CT.log.getLogger("CT.pubsub|chmeta"),"message":CT.log.getLogger("CT.pubsub|message"),"subscribe":CT.log.getLogger("CT.pubsub|subscribe"),"join":CT.log.getLogger("CT.pubsub|join"),"leave":CT.log.getLogger("CT.pubsub|leave"),"presence":CT.log.getLogger("CT.pubsub|presence"),"open":CT.log.getLogger("CT.pubsub|open"),"close":CT.log.getLogger("CT.pubsub|close"),"wserror":CT.log.getLogger("CT.pubsub|wserror"),"error":CT.log.getLogger("CT.pubsub|error")},"process":{"channel":function(data){var _=CT.pubsub._;if(data.meta){data.metamap={};data.presence.forEach(function(u,i){data.metamap[u]=data.meta.users[i];});}
_.channels[data.channel]=data;_.cb.subscribe(data);if(_.autohistory&&(_.autohistory_exemptions.indexOf(data.channel)==-1))
data.history.forEach(CT.pubsub._.process.publish);CT.pubsub._.cb.presence(data.presence.length,data.channel);},"meta":function(data){CT.pubsub._.channels[data.channel].metamap[data.user]=data.meta;CT.pubsub._.cb.meta(data);},"chmeta":function(data){CT.diffmerge(CT.pubsub._.channels[data.channel].meta.channel,data.meta);CT.pubsub._.cb.chmeta(data);},"publish":function(data){CT.pubsub._.cb.message(data);},"subscribe":function(data){CT.pubsub._.cb.join(data.channel,data.user,data.meta);var chan=CT.pubsub._.channels[data.channel];if(chan){if(chan.metamap)
chan.metamap[data.user]=data.meta;CT.data.append(chan.presence,data.user);CT.pubsub._.cb.presence(chan.presence.length,data.channel);}},"unsubscribe":function(data){CT.pubsub._.cb.leave(data.channel,data.user);var chan=CT.pubsub._.channels[data.channel];if(chan){if(chan.metamap)
delete chan.metamap[data.user];CT.data.remove(chan.presence,data.user);CT.pubsub._.cb.presence(chan.presence.length,data.channel);}},"pm":function(data){CT.pubsub._.cb.pm(data.message,data.user);},"error":function(data){CT.pubsub._.cb.error(data.message);},"snapshot":function(data){CT.pubsub._.cb.snapshot(data);data.channels.forEach(function(c){var cdata=CT.pubsub._.channels[c.name]={channel:c.name,presence:c.users};CT.pubsub._.cb.subscribe(cdata);});}},"on":{"open":function(){CT.pubsub._.open=true;CT.pubsub._.reconnect_interval=250;CT.pubsub._.write({"action":"register","data":CT.pubsub._.args[2],"meta":CT.pubsub._.args[4]});for(var channel in CT.pubsub._.channels)
CT.pubsub.subscribe(channel);CT.pubsub._.queue.forEach(CT.pubsub._.write);CT.pubsub._.queue.length=0;CT.pubsub._.cb.open();},"close":function(){CT.pubsub._.open=false;CT.pubsub._.cb.close();if(CT.pubsub._.reconnect)
CT.pubsub._.try_reconnect()},"error":function(){CT.pubsub._.cb.wserror();},"message":function(msg){var _=CT.pubsub._,d=JSON.parse(_.b64?atob(msg.data):msg.data);_.process[d.action](d.data);}},"write":function(data){var _=CT.pubsub._;if(_.open){var dstring=JSON.stringify(data);_.ws.send(_.b64?btoa(dstring):dstring);}else
_.queue.push(data);},"try_reconnect":function(){var r_int=CT.pubsub._.reconnect_interval;CT.pubsub._.log("RECONNECT",r_int);setTimeout(function(){CT.pubsub.connect.apply(null,CT.pubsub._.args)},r_int);CT.pubsub._.reconnect_interval=Math.min(2*r_int,30000);}},"isInitialized":function(){return CT.pubsub._.initialized;},"set_b64":function(bool){CT.pubsub._.b64=bool;},"set_protocol":function(protocol){CT.pubsub._.protocol=protocol;},"set_reconnect":function(bool){CT.pubsub._.reconnect=bool;},"set_autohistory":function(bool,exemptions,mergeExemptions){CT.pubsub._.autohistory=bool;if(exemptions){if(mergeExemptions){exemptions.forEach(function(e){CT.pubsub._.autohistory_exemptions.push(e);});}else
CT.pubsub._.autohistory_exemptions=exemptions;}},"set_cb":function(action,cb){CT.pubsub._.cb[action]=cb;},"presence":function(channel){return CT.pubsub._.channels[channel].presence;},"pm":function(user,message){CT.pubsub._.write({"action":"pm","data":{"user":user,"message":message}});},"meta":function(channel,meta){CT.pubsub._.write({"action":"meta","data":{"channel":channel,"meta":meta}});},"chmeta":function(channel,meta,nomerge){var _=CT.pubsub._,cmeta=_.channels[channel].meta;if(nomerge)
cmeta.channel=meta;else
CT.diffmerge(cmeta.channel,meta);_.write({"action":"chmeta","data":{"channel":channel,"meta":meta}});},"publish":function(channel,message){CT.pubsub._.write({"action":"publish","data":{"channel":channel,"message":message}});},"subscribe":function(channel){CT.pubsub._.write({"action":"subscribe","data":channel});},"unsubscribe":function(channel){CT.pubsub._.write({"action":"unsubscribe","data":channel});},"connect":function(host,port,uname,onbeforeunload,meta){CT.pubsub._.args=arguments;CT.pubsub._.initialized=true;CT.pubsub._.ws=new WebSocket(CT.pubsub._.protocol+"://"+host+":"+port);for(var action in CT.pubsub._.on)
CT.pubsub._.ws["on"+action]=CT.pubsub._.on[action];window.addEventListener("beforeunload",function(){onbeforeunload&&onbeforeunload();CT.pubsub._.write({"action":"close"});});}};;window.CT.recaptcha=window.CT.recaptcha||{};CT.recaptcha={build:function(key,rnode,eb,iecb,response_field_id){try{var cbname="_"+Math.round(Math.random()*100000);window[cbname]=function(){grecaptcha.render(rnode,{sitekey:key});if(iecb){var n=document.getElementById(response_field_id||"recaptcha_response_field");n&&CT.dom.inputEnterCallback(n,iecb);}},CT.scriptImport("https://www.google.com/recaptcha/api.js?onload="+cbname+"&render=explicit");}catch(e){eb&&eb(e)||alert(e);}},submit:function(respOnSuccess,respOnAttempt,respPath,respArgs){var resp=grecaptcha.getResponse();if(resp.length<3)
alert("don't forget to fill in the CAPTCHA! you are human, right?");else{respArgs=respArgs||{};respArgs.cresponse=resp;CT.net.post(respPath||"/recaptcha",respArgs,null,respOnSuccess,function(e){if(e.indexOf("false")!=-1){CT.log(e);e="That's not quite right! Please try again.";}
alert(e);grecaptcha.reset();});respOnAttempt&&respOnAttempt();}}};;window.CT.slider=window.CT.slider||{};CT.slider={other_dim:{height:"width",width:"height"},other_orientation:{vertical:"horizontal",horizontal:"vertical"},orientation2dim:{vertical:"height",horizontal:"width"},orientation2abs:{vertical:{forward:"up",backward:"down"},horizontal:{forward:"left",backward:"right"}}};CT.slider.Slider=CT.Class({CLASSNAME:"CT.slider.Slider",init:function(opts){this.opts=opts=CT.merge(opts,{frames:[],keys:true,noEnter:false,translateDuration:300,autoSlideInterval:5000,autoSlide:true,visible:true,navButtons:true,startFrame:null,circular:false,pan:true,noStyle:false,translucentTeaser:true,arrow:null,parent:document.body,frameCb:null,mode:"peekaboo",subMode:"peekaboo",orientation:"horizontal",arrowPosition:"middle",bubblePosition:"bottom"});if(typeof opts.parent=="string")
opts.parent=CT.dom.id(opts.parent);if(opts.frameCb)
opts.mode='custom';this.jumpers={};this.dimension=CT.slider.orientation2dim[opts.orientation];this.circlesContainer=CT.dom.node("","div","carousel-order-indicator "+opts.bubblePosition);var bclass="slider-btn hoverglow pointer sb-"
+this.opts.arrowPosition+" sb-"+opts.orientation;if(!opts.navButtons){bclass+=" hider";this.circlesContainer.classList.add("hider");}
var pointerNode=function(forward){if(opts.arrow){var img=CT.dom.img(opts.arrow);return forward?img:CT.trans.invert(img);}
return CT.dom.span(forward?">":"<");};this.prevButton=CT.dom.div(CT.dom.div(pointerNode()),bclass+" prv hidden");this.nextButton=CT.dom.div(CT.dom.div(pointerNode(true)),bclass+" nxt"+(opts.frames.length<2?" hidden":""));this.index=this.pos=0;this.container=CT.dom.div("","carousel-container full"+CT.slider.other_dim[this.dimension]);var content=[this.container,this.circlesContainer,this.prevButton,this.nextButton];if(opts.img){var imgBack=CT.dom.div(CT.dom.img(opts.img,"abs"),"abs all0 noflow");if(opts.pan){this.imgBackController=CT.trans.pan(imgBack.firstChild,{duration:opts.panDuration||opts.autoSlideInterval},true);}else{CT.onload(function(){CT.dom.cover(imgBack.firstChild);},imgBack.firstChild);}
content.unshift(imgBack);}
this.node=CT.dom.div(content,"carousel fullwidth fullheight"
+(opts.visible?"":" hider")+(opts.noStyle?" carousel-nostyle":""));this.opts.parent.appendChild(this.node);this.opts.frames.forEach(this.addFrame);CT.gesture.listen("tap",this.prevButton,this.prevButtonCallback);CT.gesture.listen("tap",this.nextButton,this.nextButtonCallback);if(opts.keys){CT.key.on(opts.orientation=="horizontal"?"LEFT":"UP",this.prevButtonCallback);CT.key.on(opts.orientation=="horizontal"?"RIGHT":"DOWN",this.nextButtonCallback);}
if(opts.orientation=="vertical")
CT.gesture.listen("wheel",this.container,this.onWheel);this.dragOpts={constraint:CT.slider.other_orientation[opts.orientation],up:this.updatePosition,interval:"auto"};CT.drag.makeDraggable(this.container,this.dragOpts);if(opts.autoSlideInterval&&opts.autoSlide&&!opts.startFrame)
this.resume();CT.gesture.listen("down",this.container,this.pause);CT.onresize(this.trans);this._reflow();if(opts.startFrame in this.jumpers)
setTimeout(this.jumpers[opts.startFrame]);},on:{hide:function(){this.imgBackController&&this.imgBackController.pause();this.container.childNodes[this.index].frame.on.hide();},show:function(){this.imgBackController&&this.imgBackController.resume();this.container.childNodes[this.index].frame.on.show();}},onWheel:function(pos,delta){if(delta>0)
this.nextButtonCallback();else
this.prevButtonCallback();},showNav:function(){if(this.opts.navButtons){CT.trans.translate(this.prevButton,{x:0});CT.trans.translate(this.nextButton,{x:0});CT.trans.translate(this.circlesContainer,{y:0});}
if(this.opts.parent.slider)
this.opts.parent.slider.showNav();},hideNav:function(){if(this.opts.navButtons){CT.trans.translate(this.prevButton,{x:-200});CT.trans.translate(this.nextButton,{x:200});CT.trans.translate(this.circlesContainer,{y:(this.opts.bubblePosition=="top")&&-100||100});}
if(this.opts.parent.slider)
this.opts.parent.slider.hideNav();},show:function(){this.node.classList.remove("hider");this.on.show();},hide:function(){this.node.classList.add("hider");this.on.hide();},_reflow:function(){CT.dom.mod({targets:this.container.childNodes,property:this.dimension,value:(100/this.container.childNodes.length)+"%"});this.container.style[this.dimension]=(this.opts.frames.length*100)+"%";},resume:function(){if(!this._autoSlide)
this._autoSlide=setInterval(this.autoSlideCallback,this.opts.autoSlideInterval);},pause:function(){if(this._autoSlide){clearInterval(this._autoSlide);this._autoSlide=null;}
this.opts.parent.slider&&this.opts.parent.slider.pause();},addFrame:function(frame,index){if(typeof frame=="string")
frame={img:frame};var circle=CT.dom.node(frame.label,"div","hoverglow pointer indicator-circle "+
(frame.label?"labeled":"unlabeled")+"-circle"),jumper=this.jumpers[frame.label||index]=this.circleJump(index);CT.gesture.listen("tap",circle,jumper);this.circlesContainer.appendChild(circle);this.container.appendChild((new CT.slider.Frame(frame,this)).node);if(index==0){circle.className+=" active-circle";this.activeCircle=circle;if(!this.opts.parent.slider)
setTimeout(this.container.firstChild.frame.on.show,500);}
if(index==undefined)
this._reflow();},circleJump:function(index){var f=function(){this.pause();this.updateIndicator(index);this.trans();}.bind(this);return f;},updateIndicator:function(index){this.container.childNodes[this.index].frame.on.hide();this.index=index;this.container.childNodes[this.index].frame.on.show();this.activeCircle.classList.remove('active-circle');this.activeCircle=this.circlesContainer.childNodes[index];this.activeCircle.classList.add('active-circle');CT.dom[this.activeCircle.nextSibling?"show":"hide"](this.nextButton);CT.dom[this.activeCircle.previousSibling?"show":"hide"](this.prevButton);},updatePosition:function(direction,force){var index=this.index,absdir=CT.drag._.dir2abs[direction],cccnl=this.circlesContainer.childNodes.length;if(CT.drag._.direction2orientation[direction]==this.opts.orientation){if(absdir=="forward"&&(force||this.activeCircle.nextSibling))
index+=1;else if(absdir=="backward"&&(force||this.activeCircle.previousSibling))
index-=1;if(cccnl)
this.updateIndicator((index+cccnl)%cccnl);}else if(this.opts.parent.slider)
this.opts.parent.slider.shift(direction,force);},trans:function(){var opts={},axis=CT.drag._.orientation2axis[this.opts.orientation];opts[axis]=this.container[axis+"Drag"]=-this.index*CT.align[this.dimension](this.container)/this.container.childNodes.length;opts.duration=this.opts.translateDuration;CT.trans.translate(this.container,opts);},shift:function(direction,force){this.updatePosition(direction,force||this.opts.circular);this.trans();},autoSlideCallback:function(){this.shift(CT.slider.orientation2abs[this.opts.orientation].forward,true);},prevButtonCallback:function(){this.pause();this.shift(CT.slider.orientation2abs[this.opts.orientation].backward);},nextButtonCallback:function(){this.pause();this.shift(CT.slider.orientation2abs[this.opts.orientation].forward);}});CT.slider.Frame=CT.Class({CLASSNAME:"CT.slider.Frame",on:{show:function(){},hide:function(){}},peekaboo:function(){var opts=this.opts,node=this.node,slider=this.slider,pulser,full=CT.dom.node(opts.content,"div","big carousel-content-full"),imageBack=CT.dom.node(CT.dom.img(opts.img||slider.opts.defaultImg,"abs"),"div","w1 h1 noflow carousel-content-image"),nodes=[imageBack,full];var teaserTap=function(){slider.pause();node._retracted=!node._retracted;if(node._retracted){CT.trans.resize(imageBack,{width:"40%",height:"30%",cb:function(){if(pulser)pulser.style.zIndex=200;}});CT.trans.trans({node:teaser,property:"left",value:"10px"});CT.trans.trans({node:teaser,property:"top",value:"0px"});slider.hideNav();this.tab&&this.tab.hide();}else{if(pulser)pulser.style.zIndex=0;CT.trans.resize(imageBack,{width:"100%",height:"100%"});CT.trans.trans({node:teaser,property:"left",value:"22.5%"});CT.trans.trans({node:teaser,property:"top",value:"100px"});slider.showNav();this.tab&&this.tab.show(slider.opts.parent);}};if(slider.opts.pan){imageBack.controller=CT.trans.pan(imageBack.firstChild,{duration:opts.panDuration||slider.opts.panDuration||slider.opts.autoSlideInterval});}else{CT.onload(function(){CT.dom.cover(imageBack.firstChild);},imageBack.firstChild);}
if(opts.title||opts.blurb){var blurbNode=CT.dom.div(opts.blurb,"bigger"),teaser=CT.dom.div([CT.dom.div(opts.title,"biggest"),blurbNode],"carousel-content-teaser transparent hoverglow pointer cc-teaser-"
+(slider.opts.translucentTeaser?"trans":"opaque"));CT.dom.fit(blurbNode);nodes.push(teaser);}
if(opts.pulse){pulser=CT.dom.img(opts.pulse,"carousel-pulse pointer");pulser.controller=CT.trans.pulse(pulser);CT.gesture.listen("tap",pulser,teaserTap);nodes.push(pulser);}
this.on.show=function(){if(opts.title||opts.blurb){CT.trans.fadeIn(teaser);blurbNode.style.maxHeight=(teaser.parentNode.clientHeight-200)+"px";blurbNode.fit();}
if(slider.opts.keys&&!slider.opts.noEnter&&teaser)
CT.key.on("ENTER",teaserTap);if(slider.opts.pan)
imageBack.controller.resume();if(opts.pulse)
pulser.controller.resume();if(this.tab)
this.tab.show(slider.opts.parent);};this.on.hide=function(){if(opts.title||opts.blurb)
CT.trans.fadeOut(teaser);if(node._retracted)
teaserTap();if(slider.opts.pan)
imageBack.controller.pause();if(opts.pulse)
pulser.controller.pause();if(this.tab)
this.tab.hide();};CT.dom.addEach(node,nodes);if(opts.content)
CT.gesture.listen("tap",teaser,teaserTap);else if(opts.onclick)
CT.gesture.listen("tap",teaser,opts.onclick);},chunk:function(){var slider=new CT.slider.Slider({parent:this.node,frames:this.opts.frames,mode:this.opts.mode||this.slider.opts.subMode,autoSlide:false,img:this.opts.img,pan:this.slider.opts.pan,arrow:this.slider.opts.arrow,startFrame:this.opts.startFrame,defaultImg:this.slider.opts.defaultImg,translucentTeaser:this.slider.opts.translucentTeaser,orientation:CT.slider.other_orientation[this.slider.opts.orientation],arrowPosition:"bottom"}),parent=this.slider;this.on.hide=slider.on.hide;this.on.show=function(){slider.on.show();if(parent.opts.keys){CT.key.on(slider.opts.orientation=="horizontal"?"LEFT":"UP",slider.prevButtonCallback);CT.key.on(slider.opts.orientation=="horizontal"?"RIGHT":"DOWN",slider.nextButtonCallback);}};},menu:function(){var menu=new CT.modal.Modal({transition:"slide",noClose:true,className:"round centered basicpopup above",content:this.opts.buttons.map(function(d){var n=CT.dom.node([CT.dom.node(d.label||d.page,"div","biggest bold bottombordered"),CT.dom.node(d.content)],"div","margined padded bordered round hoverglow pointer inline-block");n.onclick=function(){location=d.url||("/"+d.page+".html");};return n;})});var logos=function(logo){var arr=[];for(var i=0;i<5;i++)
arr.push(CT.dom.img(logo||this.slider.opts.defaultImg));return arr;};this.node.appendChild(CT.dom.marquee(logos(this.opts.logo),"abs top0 h20p fullwidth"));this.node.appendChild(CT.dom.marquee(logos(this.opts.logo),"abs bottom0 h20p fullwidth","right"));this.on.hide=menu.hide;this.on.show=menu.show;},profile:function(){var opts=CT.merge(this.opts,this.slider.opts,{panDuration:this.slider.opts.autoSlideInterval,controllerHook:this.on});opts.img=opts.img||this.slider.opts.defaultImg;CT.dom.addContent(this.node,CT.layout.profile(opts));},track:function(){var oz=this.opts,audio=CT.dom.audio(this.opts.src,true,false,false,null,this.slider.autoSlideCallback),pause=function(){audio.playing=false;audio.pause();},resume=function(){audio.playing=true;audio.play();},pauseResume=function(){audio.playing?pause():resume();};this.on.hide=pause;this.on.show=function(){resume();CT.key.on("SPACE",pauseResume);if(oz.deepLink)
document.location.hash=encodeURI(oz.album+"|"+oz.song);oz.onplay&&oz.onplay(oz.album,oz.song);};CT.dom.addContent(this.node,CT.dom.div([CT.dom.div(this.opts.song,"gigantic"),CT.dom.div(this.opts.album,"biggerest"),audio],"full-center outlined"));},custom:function(){CT.dom.addContent(this.node,this.slider.opts.frameCb(this.opts));},init:function(opts,slider){var mode=opts.mode||slider.opts.mode;this.opts=opts;this.node=CT.dom.div("","carousel-content-container full"
+CT.slider.other_dim[slider.dimension]+((mode=="custom")?" scroller":""));this.node.frame=this;this.slider=this.node.slider=slider;if(slider.dimension=="width")
this.node.style.display="inline-block";var topts=opts.tab||slider.opts.tab;if(topts){var tab=this.tab=new CT.modal.Modal({content:topts.content,center:false,noClose:true,className:"basicpopup abs rounder translucent above shiftall",transition:"slide",slide:{origin:topts.origin}});this.on.show=function(){if(tab.isClear())
tab.set(topts.content);tab.show(slider.opts.parent);};this.on.hide=tab.hide;}
this[mode]();}});;window.CT.stream=window.CT.stream||{};window.CT.stream.util=window.CT.stream.util||{};var _sutil=CT.stream.util={blob_to_b64:function(blob,cb){blob?_sutil.read(blob,cb):cb();},b64_to_blob:function(b64,cb){b64?fetch(b64.video||b64).then(function(res){return res.blob();}).then(cb):cb();},blob_to_buffer:function(blob,cb){blob?_sutil.read(blob,cb,true):cb();},b64_to_buffer:function(b64,cb){_sutil.b64_to_blob(b64,function(blob){_sutil.blob_to_buffer(blob,cb);});},blobs_to_b64s:function(blobs,cb){_sutil.blob_to_b64(blobs.video,function(b64video){_sutil.blob_to_b64(blobs.audio,function(b64audio){cb({video:b64video,audio:b64audio});});});},b64s_to_blobs:function(b64s,cb){_sutil.b64_to_blob(b64s.video,function(vblob){_sutil.b64_to_blob(b64s.audio,function(ablob){cb({video:vblob,audio:ablob});});});},blobs_to_buffers:function(blobs,cb){_sutil.blob_to_buffer(blobs.video,function(videobuffer){_sutil.blob_to_buffer(blobs.audio,function(audiobuffer){cb({video:videobuffer,audio:audiobuffer});});});},b64s_to_buffers:function(b64s,cb){_sutil.b64s_to_blobs(b64s,function(blobs){_sutil.blobs_to_buffers(blobs,cb);});},read:function(blob,cb,buffer){var signature="read"+(buffer?"buffer":"url"),fr=new FileReader();CT.log.startTimer(signature);fr.onloadend=function(){CT.log.endTimer(signature,fr.result.length||fr.result.byteLength);cb(fr.result);};buffer?fr.readAsArrayBuffer(blob):fr.readAsDataURL(blob);},update:function(signature,process,requiredInitChunk){var mt=CT.stream.opts.mropts.mimeType;if(requiredInitChunk&&!signature.endsWith("init")){CT.memcache.blob.get(requiredInitChunk,function(d){process(d);CT.memcache.blob.get(signature,process,mt);},mt);}else
CT.memcache.blob.get(signature,process,mt);},_recorder:function(ondata,onrecorder){return function(stream){var segment=0,recorder=new MediaRecorder(stream,CT.stream.opts.mropts);recorder.ondataavailable=function(blobevent){CT.log("ondataavailable!! "+blobevent.data.size);segment=(segment+1)%CT.stream.opts.segments;!recorder._stopped&&ondata&&ondata({video:blobevent.data},segment);};recorder.onerror=function(e){CT.log("error! "+e.message);};recorder.reset=function(){CT.log("RESETTING RECORDER");recorder.stop();recorder.start(CT.stream.opts.chunk);};recorder.start(CT.stream.opts.chunk);onrecorder&&onrecorder(recorder,stream);};},record:function(ondata,onrecorder,onfail,mediaType,deviceId){CT.log.startTimer("record","(attempt)");var vo=deviceId&&{deviceId:deviceId}||true;navigator.mediaDevices[mediaType||"getUserMedia"]({audio:true,video:vo}).then(_sutil._recorder(ondata,onrecorder))["catch"](onfail||function(err){CT.log.endTimer("record","got error: "+err);});}};CT.stream.util.fzn={_:{vids:{}},video:function(channel,videoClass,onrefresh){var _=CT.stream.util.fzn._,vid=_.vids[channel]=new CT.stream.Video({frame:false,fullscreen:{},activeAudio:true,onrefresh:onrefresh,videoClass:videoClass,onreset:function(){_.bridge.error({channel:channel,requiredInitChunk:vid.receivedInitChunk});}});CT.stream.util.fzn.init();_.bridge&&_.bridge.subscribe(channel);return vid;},init:function(){var _=CT.stream.util.fzn._,v;if(_.bridge)return;document.head.appendChild(CT.dom.script("https://fzn.party/CT/bridge.js",null,null,function(){_.bridge=PMB.bridge({widget:"/stream/vidsrc.html",senders:["subscribe","error"],receivers:{clip:function(data){_.vids[data.channel].bufferer(data.data);},mode:function(data){_.vids[data.channel].setEncoding(data.mode);}}});for(v in _.vids)
_.bridge.subscribe(v);}));}};;window.CT.stream.Audio=window.CT.stream.Audio||{};CT.stream.Audio=CT.Class({CLASSNAME:"CT.stream.Audio",_buffers:[],_flip:function(){if(this.disabled)return;this.active=!this.active;this.video.video.muted=!this.active;this.button.firstChild.classList[this.active?"add":"remove"]("buttonActive");},push:function(buff){this._buffers.push(buff);},build:function(){this.node=CT.dom.audio({className:"hidden",onpause:this.play});document.body.appendChild(this.node);},remove:function(){CT.dom.remove(this.node);},disable:function(){this.active=false;this.disabled=true;this.video.video.muted=true;},play:function(){var that=this;this.node.play()["catch"](function(err){that.log("play error (but we don't carerror!)",err.msg);});},init:function(active,video){this.active=active;this.video=video;this.button=CT.dom.img("/img/audio.png","w80p"+(active&&" buttonActive"||""),this._flip);if(!active)
video.video.muted=true;}});;window.CT.stream.Video=window.CT.stream.Video||{};CT.stream.Video=CT.Class({CLASSNAME:"CT.stream.Video",_buffers:[],_lastTime:0,_nextChunk:0,_sourceOpen:function(){this.log("sourceopen");this.setSourceBuffer();},_sourceUpdate:function(){this.log("_sourceUpdate",this._buffers.length,(this.sourceBuffer&&this.sourceBuffer.updating));if(this.video.error){this.log("ERROR - RESET video");this.reset();}else if(this.sourceBuffer&&!this.sourceBuffer.updating){if(this._buffers.length)
this.sourceBuffer.appendBuffer(this._buffers.shift());else if(this.mediaSource.readyState=="open")
this.mediaSource.endOfStream();}},_error:function(e){this.log("ERROR RESET",e.message,e.target.error);this.reset();},setSourceBuffer:function(){var mt=this.opts.mimeType;this.log("setSourceBuffer - exists:",!!this.sourceBuffer,"mimeType",mt);if(!this.sourceBuffer){this.sourceBuffer=this.mediaSource.addSourceBuffer(mt);this.sourceBuffer.mode='sequence';this.sourceBuffer.addEventListener("updateend",this._sourceUpdate);this.sourceBuffer.addEventListener("error",this._error);}},bufferer:function(buffer){var v=this.video;this._buffers.push(buffer);this._sourceUpdate();if(v.duration!=Infinity&&!isNaN(v.duration)){if(this._duration==v.duration){this.log("DURATION MATCH RESET!!!");this.reset();}
this._duration=v.duration;var target=v.duration-(CT.stream.opts.chunk/1000);if(v.currentTime<this._lastTime){this.log("SKIPPED RESET (backtracking)");}
this._lastTime=v.currentTime;if(!v.paused){if(v.currentTime>target)
v.playbackRate=0.5;else if(v.currentTime<target-1)
v.playbackRate=2;else
v.playbackRate=1;}}},process:function(blob){this.recorder&&this.recorder.remember(blob);CT.stream.util.blob_to_buffer(blob,this.bufferer);},start:function(){this.log("start (attempting) - paused:",this.video.paused);var that=this,prom=this.video.play();prom&&prom.then(function(){that.log("started!!! streaming!");})["catch"](function(error){that.log("play failed! awaiting user input (android)",error.message);if(CT.stream.opts.requiresInput&&!CT.stream.opts.requestedInput){that.audio.node&&CT.stream.opts.waiting.push(that.audio.node);CT.stream.opts.requestedInput=true;(new CT.modal.Prompt({cb:CT.stream.opts.startWaiting,transition:"fade",style:"single-choice",data:["Play Stream"],prompt:"Ready to stream?"})).show();}
CT.stream.opts.waiting.push(that.video);});},_miniRecorder:function(){var rec={blobs:[],remember:function(blob){if(rec.recording)
rec.blobs.push(blob);},start:function(){rec.recording=true;},stop:function(){rec.recording=false;},_save:function(blob_or_blobs){var fname=(new Date()).toString().split("-")[0].replace(/\W/g,"")+".webm",ctf=CT.file.make(blob_or_blobs);(new CT.modal.Modal({content:[CT.dom.div("Your file is ready for download!","bigger pb10"),ctf.download(fname,"click me!","bold centered block")]})).show();},save:function(){if(CT.stream.opts.transcoder)
CT.stream.opts.transcoder(rec._save)(new Blob(rec.blobs));else
rec._save(rec.blobs);rec.blobs=[];}};return rec;},save:function(){if(this.recorder){this._saveButton.firstChild.classList.remove("buttonActive");this.recorder.stop();this.recorder.save();clearTimeout(this._saveTimer);delete this._saveTimer;delete this.recorder;}else{this._saveButton.firstChild.classList.add("buttonActive");this.recorder=this._miniRecorder();this.recorder.start();this._saveTimer=setTimeout(this.save,CT.stream.opts.cutoff);}},remove:function(){this.video.src="";CT.dom.remove(this.node);this.audio.remove();},_wakeup:function(){if(this.video._lastct==this.video.currentTime)
this.video.currentTime+=1;this.video._lastct=this.video.currentTime;},setVideo:function(){this.video=this.opts.video||CT.dom.video(this.opts.stream,this.opts.videoClass,this.opts.videoId,this.opts.attrs);this.video.on("canplay",this.start);this.video.on("pause",this.start);this.video.on("error",this._error);},setMediaSource:function(){this.mediaSource=new MediaSource();this.video.src=URL.createObjectURL(this.mediaSource);this.mediaSource.addEventListener("sourceopen",this._sourceOpen);this.mediaSource.addEventListener("error",this._error);},fullscreen:function(){var v=this.video;if(v.requestFullscreen)
v.requestFullscreen();else if(v.webkitRequestFullscreen)
v.webkitRequestFullscreen();},switchEncoding:function(){var codecs=CT.stream.opts.codecs,oz=this.opts;oz.mimeType=(oz.mimeType==codecs.av)?codecs.video:codecs.av;this.log("switching encoding to",oz.mimeType);},setEncoding:function(mode){var oz=this.opts,prev=oz.mimeType;oz.mimeType=CT.stream.opts.modes[mode];this.log(mode,"mode:",oz.mimeType);if(this.sourceBuffer&&oz.mimeType!=prev){this.log("mode swap reset!");this.reset();}},reset:function(){if(!this.video.parentNode)return;var n=Date.now(),chunk=CT.stream.opts.chunk;if(this._lastReset){var diff=n-this._lastReset;this.log("RESET",diff);if(diff<chunk)
return;if(diff<chunk*8)
this.opts.onreset&&this.opts.onreset();}
this._lastReset=n;this.video.removeEventListener("canplay",this.start);this.video.removeEventListener("pause",this.start);this.video.removeEventListener("error",this._error);this.setVideo();this.video.muted=!this.audio.active;this.node.insertBefore(this.video,this.node.video);CT.dom.remove(this.node.video);this.node.video=this.video;this.sourceBuffer.removeEventListener("updateend",this._sourceUpdate);this.sourceBuffer.removeEventListener("error",this._error);delete this.sourceBuffer;this.mediaSource.removeEventListener("sourceopen",this._sourceOpen);this.mediaSource.removeEventListener("error",this._error);this.setMediaSource();if(this._buffers.length>10)
this._buffers.length=0;else
this._buffers.shift();this.requiredInitChunk=this.receivedInitChunk;this.opts.onrefresh&&this.opts.onrefresh();},init:function(opts){this.opts=opts=CT.merge(opts,{video:null,stream:null,className:null,id:null,frame:true,videoClass:null,videoId:null,watermark:null,mimeType:CT.stream.opts.codecs.av,activeAudio:false,onreset:null,buttons:[],record:{streamer:false,lurker:false,auto:false},fullscreen:{streamer:false,lurker:true},attrs:{autoplay:true}});if(opts.stream)
opts.attrs.srcObject=opts.stream;this.setVideo();this.audio=new CT.stream.Audio(opts.activeAudio,this);this._fullscreenButton=CT.dom.img("/img/fullscreen.png","defpointer hoverglow w80p",this.fullscreen);this._saveButton=CT.dom.img("/img/save.png","defpointer hoverglow w80p",this.save);this.node=opts.frame?CT.dom.div([this.video,CT.dom.div([this.audio.button,CT.dom.pad(2),this._fullscreenButton,CT.dom.pad(2),this._saveButton],"centered")],opts.className,opts.id):CT.dom.div(this.video,opts.className||"fulldef",opts.id);this.node.video=this.video;var hasRecorder=opts.record[opts.stream?"streamer":"lurker"],hasFullscreen=opts.fullscreen[opts.stream?"streamer":"lurker"];if(!opts.frame){var cbl=CT.dom.div(null,"abs cbl");if(hasRecorder)
cbl.appendChild(this._saveButton);if(hasFullscreen){if(cbl.childNodes.length)
cbl.appendChild(CT.dom.pad());cbl.appendChild(this._fullscreenButton);}
opts.buttons.forEach(function(b){if(cbl.childNodes.length)
cbl.appendChild(CT.dom.pad());cbl.appendChild(b);});if(cbl.childNodes.length)
this.node.appendChild(cbl);}
hasRecorder&&opts.record.auto&&this.save();if(opts.watermark)
this.node.appendChild(CT.dom.img(opts.watermark,"abs ctr w1-4 mosthigh nofilt"));if(opts.stream)
this.audio.disable();else{this.setMediaSource();this.audio.build();setInterval(this._wakeup,1000);}}});;window.CT.stream.Streamer=window.CT.stream.Streamer||{};CT.stream.Streamer=CT.Class({CLASSNAME:"CT.stream.Streamer",bounce:function(signature,blob){var video=this.opts.video;CT.stream.util.read(blob,function(result){CT.memcache.set(signature,result,function(){CT.memcache.get(signature,video.process,true);},true);});},chunk:function(blob,segment){this.bounce(this.opts.channel+segment,blob);},echo:function(blobs,segment){this.opts.video.process(blobs.video);},getNode:function(){return this.opts.video.node;},init:function(opts){this.opts=CT.merge(opts,{channel:"test",video:new CT.stream.Video()});}});;window.CT.stream.Multiplexer=window.CT.stream.Multiplexer||{};CT.stream.Multiplexer=CT.Class({CLASSNAME:"CT.stream.Multiplexer",initChunk:false,_push:function(blob,channel,signature){CT.memcache.blob.set(signature,blob,function(){CT.pubsub.publish(channel,{action:"clip",data:signature});});},join:function(channel){if(this.opts.singlechannel){var ckeys=Object.keys(this.channels);if(ckeys.length)
this.leave(ckeys[0]);this.channel=channel;}
if(!(channel in this.channels)){CT.pubsub.subscribe(channel);this.channels[channel]={};}},leave:function(channel){if(channel in this.channels){CT.pubsub.unsubscribe(channel);Object.values(this.channels[channel]).forEach(function(video){video.remove();});delete this.channels[channel];}},unsub:function(channel,user){var chan=this.channels[channel];if(chan&&chan[user]){chan[user].remove();delete chan[user];if(!Object.keys(chan).length&&this.opts.onstop)
this.opts.onstop();}},stop:function(){for(var chan in this.channels)
this.leave(chan);},push:function(blobs,segment,channel,stream){var signature=channel+this.opts.user,video=this.getVideo(channel,this.opts.user,stream);if(!this.initChunk){this.initChunk=true;signature+="init";}else
signature+=segment;video.recorder&&video.recorder.remember(blobs.video);this._push(blobs.video,channel,signature);return video;},chat:function(message,user){if(this.opts.chat){user=user||this.opts.user;var id=parseInt(user.slice(4)),msg=CT.dom.div(this.opts.chatnames?[CT.dom.span(user,"bold"),CT.dom.pad(),CT.dom.span(message.data)]:message.data);if(isNaN(id))
id=user.length;msg.style.color=this.opts.chatcolors[id%this.opts.chatcolors.length];this.chatOut.appendChild(msg);msg.scrollIntoViewIfNeeded();}},say:function(msg){this.chatIn.value="";CT.pubsub.publish(this.channel,{action:"chat",data:msg});this.chat({data:msg});},resetcb:function(chan,user){return function(){CT.pubsub.publish(chan,{action:"error",data:user});};},meta:function(data){this.getVideo(data.channel,data.user).setEncoding(data.meta.mode);},update:function(data){CT.log.startTimer("update",data.channel);if(data.message.action=="clip"){var v=this.getVideo(data.channel,data.user);CT.stream.util.update(data.message.data,v.process,v.requiredInitChunk);if(v.requiredInitChunk){v.receivedInitChunk=v.requiredInitChunk;delete v.requiredInitChunk;}}else if(data.message.action=="chat")
this.chat(data.message,data.user);else if(data.message.action=="error"&&this.opts.onerror)
this.opts.onerror(data.message.data);CT.log.endTimer("update",data.message.data.length
+" "+data.channel+" "+data.user);},getVideo:function(channel,user,stream){var chan=this.channels[channel],video=chan[user];if(!video){if(!Object.keys(chan).length&&this.opts.onstart)
this.opts.onstart();video=chan[user]=new CT.stream.Video(CT.merge(this.opts.vidopts,{stream:stream,onreset:this.resetcb(channel,this.opts.user)}));CT.dom.addContent(this.opts.node,video.node);video.requiredInitChunk=!stream&&(channel+user+"init");}
return video;},connect:function(){CT.pubsub.connect(this.opts.host,this.opts.port,this.opts.user);},init:function(opts){this.opts=opts=CT.merge(opts,{host:"localhost",port:8888,user:"user"+Math.floor(100*Math.random()),node:document.body,autoconnect:true,singlechannel:false,onstart:null,onstop:null,onerror:null,wserror:null,chat:true,title:null,vidopts:{},closeunsubs:true,chatnames:false,chatclass:"green",chatcolors:["pink","purple","blue","green","red","orange","yellow"],chatblurs:["say what?","any questions?","what's up?"]});if(opts.chat){opts.singlechannel=true;this.chatOut=CT.dom.div(null,"abs l0 t50 r0 b15 scrolly pointer "+opts.chatclass);var ci=this.chatIn=CT.dom.smartField({cb:this.say,blurs:opts.chatblurs,classname:"abs l0 b0 r0 h15p w1 p0 m0 noborder"});this.chatOut.onclick=function(){ci.focus();};opts.title.classList.remove("biggest");opts.title.classList.add("bigger");CT.dom.setContent(opts.chat,[opts.title,this.chatOut,this.chatIn]);}
this.channels={};CT.pubsub.set_cb("message",this.update);CT.pubsub.set_cb("meta",this.meta);if(opts.closeunsubs)
CT.pubsub.set_cb("leave",this.unsub);opts.wserror&&CT.pubsub.set_cb("wserror",opts.wserror);opts.autoconnect&&this.connect();}});;CT.stream.opts={requiresInput:true,requestedInput:false,segments:10,chunk:2000,reset:8000,cutoff:30000,width:320,height:240,waiting:[],transcoder:null,setTranscoder:function(cb){CT.stream.opts.transcoder=cb;},codecs:{av:'video/webm; codecs="vp8,opus"',video:'video/webm; codecs="vp8"',audio:'audio/webm; codecs="opus"'},startWaiting:function(){CT.stream.opts.waiting.forEach(function(w){w.play();});}};CT.stream.opts.modes={camera:CT.stream.opts.codecs.av,screenshare:CT.stream.opts.codecs.video};CT.stream.opts.mropts={mimeType:CT.stream.opts.codecs.video,};;window.CT.storage=window.CT.storage||{};CT.storage={"init":function(opts){if(!CT.storage.opts){CT.storage.opts=CT.merge(opts,{"backend":localStorage,"json":true,"compress":true});if(CT.storage.opts.compress)
CT.require("CT.lib.lz_string",true);}
return CT.storage.opts;},"_jsp":function(s){try{return JSON.parse(s);}catch(err){return null;}},"get":function(key){var opts=CT.storage.init(),val=opts.backend.getItem(key);if(opts.compress)
val=LZString.decompress(val);return opts.json?CT.storage._jsp(val):val;},"set":function(key,val){var opts=CT.storage.init();if(opts.json)
val=JSON.stringify(val);if(opts.compress)
val=LZString.compress(val);opts.backend.setItem(key,val);},"clear":function(){CT.storage.init().backend.clear();}};;window.CT.trans=window.CT.trans||{};CT.trans={_:{vender_prefixes:["-webkit-","-moz-","-ms-","-o-",""],enames:["webkitTransitionEnd","mozTransitionEnd","oTransitionEnd","transitionend"],defaults:{trans:{duration:500,property:"*",ease:"ease-in-out"},rotate:{degrees:180,duration:1000,property:"transform",ease:"linear",prefix:true},translate:{duration:300,property:"transform",ease:"linear",prefix:true,x:0,y:0,z:0},wobble:{axis:"x",radius:50,duration:100},pan:{duration:5000,ease:"linear",x:0,y:0},resize:{duration:300,ease:"linear"},fadeIn:{duration:1600,property:"opacity",value:1},fadeOut:{duration:1600,property:"opacity",value:0},pulse:{wait:1000},invert:{direction:"horizontal",property:"transform",prefix:true}}},setVenderPrefixed:function(node,property,value){for(var i=0;i<CT.trans._.vender_prefixes.length;i++)
node.style[CT.trans._.vender_prefixes[i]+property]=value;},trans:function(opts){opts=CT.merge(opts,CT.trans._.defaults.trans);if(typeof opts.node=="string")
opts.node=CT.dom.id(opts.node);if(opts.node){var prevTrans=opts.node.style.transition||"",transComponent=opts.property+" "+opts.duration+"ms "+opts.ease,fullTrans=(prevTrans&&prevTrans.indexOf(transComponent)==-1)?(prevTrans+", "+transComponent):transComponent;CT.trans.setVenderPrefixed(opts.node,"transition",fullTrans);}
if(opts.cb){var transTimeout,wrapper=function(){opts.node&&CT.trans.setVenderPrefixed(opts.node,"transition",prevTrans);clearTimeout(transTimeout);transTimeout=null;if(opts.node)CT.trans._.enames.forEach(function(ename){opts.node.removeEventListener(ename,wrapper,false);});opts.cb();}
if(opts.node){CT.trans._.enames.forEach(function(ename){opts.node.addEventListener(ename,wrapper,false);});opts.node.finish=wrapper;}else
transTimeout=setTimeout(wrapper,opts.duration);}
if(opts.node&&opts.property&&opts.property!="*"){if(opts.prefix)
CT.trans.setVenderPrefixed(opts.node,opts.property,opts.value);else
opts.node.style[opts.property]=opts.value;}},invert:function(node,opts){opts=CT.merge(opts,CT.trans._.defaults.invert);opts.node=node;opts.value="scale"+(opts.direction=="horizontal"?"X":"Y")+"(-1)";CT.trans.trans(opts);return node;},rotate:function(node,opts){opts=CT.merge(opts,CT.trans._.defaults.rotate);opts.node=node;opts.value="rotate("+opts.degrees+"deg)";if(opts.forever)opts.cb=function(){opts.degrees+=CT.trans._.defaults.rotate.degrees;CT.trans.rotate(node,opts);};CT.trans.trans(opts);return node;},translate:function(node,opts){opts=CT.merge(opts,CT.trans._.defaults.translate);opts.node=node;if(opts.axis)
opts[opts.axis]=opts.value;opts.value="translate3d("+opts.x+"px,"+opts.y+"px,"+opts.z+"px)",CT.trans.trans(opts);},wobble:function(node,opts){opts=CT.merge(opts,CT.trans._.defaults.wobble);CT.trans.translate(node,{axis:opts.axis,ease:"ease-out",value:opts.radius,duration:opts.duration,cb:function(){CT.trans.translate(node,{axis:opts.axis,ease:"ease-in-out",value:-opts.radius,duration:opts.duration*2,cb:function(){CT.trans.translate(node,{axis:opts.axis,ease:"ease-in",value:0,duration:opts.duration});}});}});},pan:function(node,opts){opts=CT.merge(opts,CT.trans._.defaults.pan);var setV=function(cb){node._vertical=CT.dom.cover(node);node._prop=node._vertical?"y":"x",node._dim=node._vertical?"clientHeight":"clientWidth";node._bound=node.parentNode[node._dim]-node[node._dim];if(opts[node._prop]<node._bound){opts[node._prop]=0;node.finish&&node.finish();}
cb&&setTimeout(cb);},controllercb=function(){opts[node._prop]=opts[node._prop]?0:node._bound;CT.trans.translate(node,opts);},controller=new CT.trans.Controller(controllercb);node.onload=function(){var oldprop=node._prop;setV();if(oldprop&&oldprop!=node._prop)
opts[oldprop]=0;setTimeout(controller.resume);};CT.onresize(node.onload);opts.cb=controller.tick;return controller;},resize:function(node,opts){var width=opts.width,height=opts.height,cb=opts.cb;delete opts.width;delete opts.height;delete opts.cb;opts.node=node;opts=CT.merge(opts,CT.trans._.defaults.resize);if(width){CT.trans.trans(CT.merge({property:"width",value:width},opts));}
if(height){CT.trans.trans(CT.merge({property:"height",value:height},opts));}
if(cb){CT.trans.trans(CT.merge({cb:cb},opts));}},fadeIn:function(node,opts){opts=CT.merge(opts,CT.trans._.defaults.fadeIn);opts.node=node;CT.trans.trans(opts);},fadeOut:function(node,opts){opts=CT.merge(opts,CT.trans._.defaults.fadeOut);opts.node=node;CT.trans.trans(opts);},pulse:function(node,opts,wait){opts=CT.merge(opts,CT.trans._.defaults.pulse);var faded,controller=new CT.trans.Controller(function(){faded=!faded;if(faded){setTimeout(function(){CT.trans.fadeIn(node,opts);},opts.wait);}else
CT.trans.fadeOut(node,opts);});opts.cb=controller.tick;if(!wait)
controller.tick();return controller;}};CT.trans.Controller=CT.Class({CLASSNAME:"CT.trans.Controller",pause:function(){this._paused=true;},resume:function(){if(this._paused!=false){this._paused=false;if(this._stalled){this._stalled=false;this.cb();}}},active:function(){return!this._paused;},tick:function(){if(this.active())
this.cb();else
this._stalled=true;},init:function(cb){this.cb=cb;this._stalled=true;}});;window.CT.upload=window.CT.upload||{};CT.upload={"form":function(uid,kval,sbutton,isize){var f=CT.dom.node("","form");f.action="/upload";f.enctype="multipart/form-data";f.method="post";var u=CT.dom.field();u.type="hidden";u.name="uid";u.value=uid;var k=CT.dom.field();k.type="hidden";k.name="key";if(kval)k.value=kval;var i=CT.dom.field();i.type="file";i.name="data";f.appendChild(u);f.appendChild(k);f.appendChild(i);if(sbutton){i.size="10";f.appendChild(sbutton);}
if(isize)
i.size=isize;return f;},"submit":function(f,success,failure,iskey){CT.require("CT.lib.aim",true);AIM.submit(f,{'onComplete':function(data){var didSucceed=data.charAt(0);if(didSucceed=='0')
(failure||alert)(data.slice(1));else if(iskey)
success(data.slice(2,-1));else
success(data.slice(1));}});f.submit();}};;window.CT.video=window.CT.video||{};CT.video={"rawVidTypes":["mp4","ogg","webm"],"player2url":{"facebook":"www.facebook.com/","google":"video.google.com?docid=","youtube":"www.youtube.com/watch?v=","vimeo":"vimeo.com/","ustream":"www.ustream.tv/recorded/","mp4":"","ogg":"","webm":""},"embed_url":{"facebook":"https://www.facebook.com/plugins/video.php?href=https%3A%2F%2Fwww.facebook.com%2F","youtube":location.protocol+"//www.youtube.com/embed/","vimeo":"//player.vimeo.com/video/","dtube":"https://emb.d.tube/#!/","rumble":"https://rumble.com/embed/","bitchute":"https://www.bitchute.com/embed/"},"urlFromData":function(player,docid){return player?(location.protocol+"//"+CT.video.player2url[player]+docid):"";},"getQSParam":function(url,param){var s=url.indexOf(param+"=")+param.length+1,e=url.indexOf("&",s);if(e==-1)
e=url.indexOf("#",s);if(e==-1)
return url.slice(s);return url.slice(s,e);},"docidFromUrl":function(url){if(url.indexOf("d.tube")!=-1)
return url.split("/v/")[1];else if(url.indexOf("bitchute.com")!=-1)
return url.split("/video/")[1];else if(url.indexOf("rumble.com")!=-1)
return url.split("/embed/")[1];else if(url.indexOf("video.google.com")!=-1)
return CT.video.getQSParam(url,"docid");else if(url.indexOf("youtube.com")!=-1)
return CT.video.getQSParam(url,"v");else if(url.indexOf("vimeo.com")!=-1)
return url.slice(url.lastIndexOf('/')+1);else if(url.indexOf("facebook.com")!=-1&&url.indexOf("video")!=-1)
return encodeURIComponent(url.split("facebook.com/")[1]);else if(url.indexOf("ustream.tv/recorded/")!=-1)
return url.split("recorded/")[1].split("?")[0];var spliturl=url.split('.'),ext=spliturl[spliturl.length-1];if(CT.video.rawVidTypes.indexOf(ext)!=-1)
return url.replace("http://","").replace("https://","");return"";},"playerFromUrl":function(url){if(url.indexOf("bitchute.com")!=-1)
return"bitchute";if(url.indexOf("rumble.com")!=-1)
return"rumble";if(url.indexOf("d.tube")!=-1)
return"dtube";if(url.indexOf("facebook.com")!=-1&&url.indexOf("video")!=-1)
return"facebook";if(url.indexOf("video.google.com")!=-1)
return"google";if(url.indexOf("youtube.com")!=-1)
return"youtube";if(url.indexOf("vimeo.com")!=-1)
return"vimeo";if(url.indexOf("ustream.tv")!=-1)
return"ustream";var spliturl=url.split('.'),ext=spliturl[spliturl.length-1];if(CT.video.rawVidTypes.indexOf(ext)!=-1)
return ext;return"";},"videoData":function(vlink){var player=CT.video.playerFromUrl(vlink);return player?{player:player,docid:CT.video.docidFromUrl(vlink)}:null;},"_embed":function(video,w,h){var dims="width="+w;if(h)
dims+=" height="+h;if(["facebook","dtube","bitchute"].indexOf(video.player)!=-1){if(typeof w=="number"){h=w*315/560;dims="width="+w+" height="+h;}else
w=254;}
var ifs=' style="border:none;overflow:hidden;max-width:100%;"',iurl=CT.video.embed_url[video.player]+video.docid;if(video.player=="dtube"||video.player=="bitchute")
return'<iframe '+dims+ifs+' src="'+iurl+'" frameborder="0" allowfullscreen></iframe>';else if(video.player=="rumble")
return'<iframe src="'+iurl+'" '+dims+ifs+' allowfullscreen></iframe>';else if(video.player=="facebook")
return'<iframe src="'+iurl+'&show_text=0&width='+w+'" '+dims+ifs+' scrolling="no" frameborder="0" allowTransparency="true" allowFullScreen="true"></iframe>';else if(video.player=="google")
return"<embed "+dims+" id=VideoPlayback src="+location.protocol+"//video.google.com/googleplayer.swf?docid="+video.docid+"&hl=en&fs=true allowFullScreen=true allowScriptAccess=always type=application/x-shockwave-flash> </embed>";else if(video.player=="youtube"||video.player=="vimeo")
return"<iframe src=\""+iurl+"?html5=1\" "+dims+ifs+" frameborder=0 webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>";else if(video.player=="ustream")
return"<object type=application/x-shockwave-flash data="+location.protocol+"//static-cdn1.ustream.tv/swf/live/viewerqos:21.swf "+dims+"id=utv"+video.docid+" name=utv"+video.docid+"><param name=flashvars value=autoplay=true&locale=en_US&referrer=http%3A%2F%2Fwww.ustream.tv%2Frecorded%2F"+video.docid+"%3Futm_campaign%3Dustre.am%26utm_source%3Dustre.am%2F%3A44gEy%26utm_medium%3Dsocial%26utm_content%3D20150324210416&autoResize=false&enablejsapi=true&sv=6&volume=1&ts=1427256261325&vid="+video.docid+"&loc="+video.docid+"&hasticket=false><param name=allowfullscreen value=true><param name=allowscriptaccess value=always><param name=bgcolor value=000000><param name=wmode value=transparent></object>"
else if(CT.video.rawVidTypes.indexOf(video.player)!=-1)
return"<video "+dims+" controls style='max-width:100%'><source src="+location.protocol+"//"+video.docid+" type=video/"+video.player+"></video>";else
alert("unknown video player: "+video.player);},"embed":function(video,small){var w=small?375:400;var h=small?180:220;return CT.video._embed(video,w,h);},"fit":function(video){return CT.video._embed(video,"90%","90%");},"full":function(video){return CT.video._embed(video,"100%","100%");},"unthumb":function(key,rand){var n=CT.dom.id("thumb"+rand+key);n.classList.remove("vidthumb");CT.dom.setContent(n,CT.video.embed(CT.data.get(key)));},"thumbnail":function(video,htmlSafe){if(htmlSafe){var rand=Math.floor(Math.random()*1000);return'<div class="vidthumb" id="thumb'+rand+video.key+'"><img class="w1 pointer" src="'+video.thumbnail+'" onclick="CT.video.unthumb(\''+video.key+'\', '+rand+')"></div>';}
var thumb=CT.dom.img(video.thumbnail,"w1",function(){thumb.parentNode.innerHTML=CT.video.embed(video);},null,null,null,null,"vidthumb");return CT.dom.div(thumb);}};;;window.core=window.core||{};window.core.config=window.core.config||{};core.config={"header":{"centerLogo":false,"logo":CT.dom.img("/img/logo.png","h1"),"right":[CT.dom.link("code",null,"https://github.com/bubbleboy14/cantools",null,null,null,true),CT.dom.pad(4),CT.dom.link("plugins",null,"/plugins.html"),CT.dom.pad(4),CT.dom.link("docs",null,"/docs"),CT.dom.pad(4),CT.dom.link("nitty gritty",null,"/nitty_gritty.html")]},"footer":{"logoClass":"abs b0 l0 hgrow","linksClass":"abs b0 r0 small mosthigh","logo":"cantools","extra":CT.dom.node([CT.dom.node(",/\\~~/\\.","center"),CT.dom.node([CT.dom.node("(","span"),CT.dom.pad(),CT.dom.node([CT.dom.node("c","span","biggest",null,null,{verticalAlign:"sub"}),CT.dom.node("+","span","smaller inline-block",null,null,{marginLeft:"-5px"})],"div","inline-block","lefteye"),CT.dom.pad(),CT.dom.node([CT.dom.node("c","span","biggest",null,null,{verticalAlign:"sub"}),CT.dom.node("+","span","smaller inline-block",null,null,{marginLeft:"-5px"})],"div","inline-block","righteye"),CT.dom.pad(),CT.dom.node(")","span")],"center")],null,"abs b0 pointer","winker"),"bottom":["user","blog","store","stream","map","net","coop","unes","docs"].map(function(pname){var p="ct"+pname;return CT.dom.link(p,function(){if(location.pathname=="/plugins.html")
CT.dom.id("tl"+p).trigger();else
window.location="/plugins.html#"+p;},null,"ph10");}),"links":[{content:"MIT License",href:"https://github.com/bubbleboy14/cantools/blob/master/LICENSE"}]},"css":[],"mobile":{"scale":false},"ctdocs":{"base":"https://github.com/bubbleboy14/cantools/blob/master/","source":function(name){var base=core.config.ctdocs.base;if(name=="about")
return base+"README.md";else if(name=="pubsub")
return base+"cantools/scripts/pubsub/ps.py";else if(name.endsWith(".js"))
return base+"cantools/CT/"+name;else
return base+"cantools/scripts/"+name+".py";}}};;window.core.util=window.core.util||{};core.util={_users:["snuggler","cuddler","mittens","meowzer","wowzer","woozle"],chat:function(){core.util.chat=new core.util.Chat();core.util.chatNode=CT.dom.node([CT.dom.img("/img/cat.png","pointer hoverglow",core.util.toggleChat),CT.dom.node(core.util.chat.node,"div","w300p h400p")],"div","abs r0 b0 above","chat");document.body.appendChild(core.util.chatNode);},toggleChat:function(){core.util.chatNode._on=!core.util.chatNode._on;core.util.chat.setActive(core.util.chatNode._on);core.util.chatNode.classList[core.util.chatNode._on?"add":"remove"]("nobm");CT.trans.wobble(core.util._winker,{axis:"y",radius:-5,duration:200});},buildPage:function(data,ctype,ltype){CT.initCore();var opts={data:data};if(ctype)
opts.contentClass=ctype;if(ltype)
opts.listClass=ltype;CT.layout.listView(opts);},settle:function(){core.util._winker=CT.dom.id("winker");core.util._winker.classList.add("viswink");core.util._winker.onclick=core.util.toggleChat;},init:function(){core.util.chat();setTimeout(core.util.settle);}};core.util.Chat=CT.Class({CLASSNAME:"core.util.Chat",setActive:function(bool){this.active=bool;},message:function(data){var u=parseInt(data.user)%core.util._users.length;CT.dom.addContent(this.outy,[CT.dom.img("/img/users/"+u+".jpg"),CT.dom.pad(),CT.dom.node(core.util._users[u]+" says:","b"),CT.dom.pad(),CT.dom.node(data.message,"span")]);this.alert.play();if(this.active)
this.outy.lastChild.scrollIntoViewIfNeeded();},init:function(){var inny=CT.dom.smartField({isTA:true,classname:"h1-5 w1",blurs:["any questions?","what's on your mind?","what's the matter?","are you confused?","what's up?"],cb:function(val){inny.value="";inny.blur();CT.pubsub.publish("chat",val);}});this.outy=CT.dom.node(null,null,"h4-5 w1","outy");this.alert=CT.dom.audio("/mp3/alert.mp3");this.node=CT.dom.node([this.outy,inny,this.alert],"div","h1 w1");CT.pubsub.connect(location.hostname,9999);CT.pubsub.subscribe("chat");CT.pubsub.set_autohistory(true);CT.pubsub.set_cb("message",this.message);}});CT.onload(core.util.init);;;CT.onload(function(){core.util.buildPage([{name:"Architecture",content:CT.dom.img("/img/architecture.png","w1")},{name:"Initialization",content:[CT.dom.div("Installing cantools","bigger bold pv10"),"Pop open a terminal and clone cantools:",CT.dom.div("~> git clone https://github.com/bubbleboy14/cantools.git","code"),"Install it:",CT.dom.div(["~> cd cantools","~/cantools> sudo python setup.py install","~/cantools> sudo python setup.py develop",],"code"),CT.dom.div("Creating A Project","bigger bold pv10"),"Then navigate somewhere else and make up a name for your project:",CT.dom.div(["~/cantools> cd ..","~> ctinit greatprojectname",],"code"),CT.dom.div("Refreshing A Project","bigger bold pv10"),"Maybe you're jumping into someone else's project. That's fine. First, make sure cantools is installed (see above). If you already have it, it doesn't hurt to make sure it's up to date. In your terminal:",CT.dom.div("~> ctinit -u","code"),[CT.dom.span("That command pulls in the latest cantools, and also updates any managed plugins (more about that"),CT.dom.pad(),CT.dom.link("here",function(){CT.dom.id("tlPlugins").trigger();}),CT.dom.span("). Now navigate to your project and refresh:")],CT.dom.div(["~> cd someproject","~/someproject> ctinit -r"],"code"),"That command installs all necessary plugins and adds in all the symlinks that don't belong in a repository."]},{name:"Object Relational Mapper",content:[CT.dom.div("Choosing Your Backend","bigger bold pv10"),[CT.dom.span("The cantools abstraction layer is like a rodeo performer riding two horses simultaneously:"),CT.dom.pad(),CT.dom.link("the GAE neopythonic cloud datastore",null,"https://cloud.google.com/appengine/docs/python/ndb/",null,null,null,true),CT.dom.span("; and the SQL database of your choice (our recommendation), via"),CT.dom.pad(),CT.dom.link("sqlalchemy",null,"http://www.sqlalchemy.org/",null,null,null,true),CT.dom.span(".")],CT.dom.div("Modeling Data","bigger bold pv10"),[CT.dom.span("Now that you've got a project to mess around with, check out model.py. It will be mostly empty. For a good example of the sorts of things you can type there, feast your eyes on the"),CT.dom.pad(),CT.dom.link("ctuser",null,"/plugins.html#ctuser"),CT.dom.pad(),CT.dom.span("plugin's"),CT.dom.pad(),CT.dom.link("model injections",null,"https://github.com/bubbleboy14/ctuser/blob/master/ctuser/model.py"),CT.dom.span(". Our sleek api is <b>boilerplateless</b> thanks to the"),CT.dom.pad(),CT.dom.link("metaclass magic of the model module",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/db/sql/model.py")],CT.dom.div("Queries","bigger bold pv10"),[CT.dom.div("Access Your Data","big pv10"),[CT.dom.span("The cantools abstraction layer manages"),CT.dom.pad(),CT.dom.link("database sessions",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/db/sql/session.py",null,null,null,true),CT.dom.pad(),CT.dom.span("under the hood, allowing numerous incrementally alternating request -bound sessions, as well as any number of simultaneous long-running thread -bound sessions, to coexist, reading and writing data at will. The session manager is utilized by individual"),CT.dom.pad(),CT.dom.link("Query",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/db/sql/query.py",null,null,null,true),CT.dom.pad(),CT.dom.span("instances, which in turn are used by the"),CT.dom.pad(),CT.dom.link("getters",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/db/sql/getters.py",null,null,null,true),CT.dom.span(", which themselves instantiate Query objects with the query() function attached to each data model (as do the"),CT.dom.pad(),CT.dom.link("setters",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/db/sql/setters.py",null,null,null,true),CT.dom.span(").")],CT.dom.div("Even From Javascript(!)","big pv10"),[CT.dom.span("Check out the"),CT.dom.pad(),CT.dom.link("CT.db",null,"/docs#db.js"),CT.dom.pad(),CT.dom.span("module to learn all about querying and messing with your data from all the way over in the client. Really!")]],CT.dom.div("Migration","bigger bold pv10"),[CT.dom.span("Wherever you choose to squirrel away your data, you'll eventually have to move it somewhere. Check out"),CT.dom.pad(),CT.dom.link("ctmigrate",null,"/docs#migrate"),CT.dom.pad(),CT.dom.span("to learn more!")]]},{name:"Routing",content:[CT.dom.div("The Basics","bigger bold pv10"),[CT.dom.span("All routing is handled in the <b>app.yaml</b> file,"),CT.dom.pad(),CT.dom.link("YAML",null,"http://yaml.org/",null,null,null,true),CT.dom.span("-style (parsed"),CT.dom.pad(),CT.dom.link("here",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/web/dez_server/routes.py",null,null,null,true),CT.dom.span("). Each rule consists of a <b>url</b>, which may be a regular expression, followed by either a <b>script</b> line or a <b>static_dir</b> line.")],CT.dom.div("Static Directories","bigger bold pv10"),"A static rule looks like this:",CT.dom.div(["- url: /css",CT.dom.pad(2),CT.dom.span("static_dir: css"),],"code"),CT.dom.div("Web Handlers","bigger bold pv10"),"A dynamic rule looks like this:",CT.dom.div(["- url: /_db",CT.dom.pad(2),CT.dom.span("script: _db.py"),],"code"),CT.dom.div("What's That Stuff At The Bottom?","bigger bold pv10"),"At some point in your <b>app.yaml</b> file, you'll see the following line:",CT.dom.div("## MODE SWITCHING -- DON'T MESS WITH (unless you know what you're doing)!","code"),[CT.dom.span("The stuff after that is used by"),CT.dom.pad(),CT.dom.link("the compiler",null,"/docs#deploy"),CT.dom.pad(),CT.dom.span("to switch between compilation modes. Now you know.")]]},{name:"Request Handling",content:[CT.dom.span("The"),CT.dom.pad(),CT.dom.link("dez",null,"https://github.com/bubbleboy14/dez",null,null,null,true),CT.dom.span("-backed <b>cantools.web</b> module is built around a"),CT.dom.pad(),CT.dom.link("modified",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/web/dez_server/controller.py",null,null,null,true),CT.dom.pad(),CT.dom.link("SocketController",null,"https://github.com/bubbleboy14/dez/blob/master/dez/network/controller.py",null,null,null,true),CT.dom.pad(),CT.dom.span("pulling the strings of"),CT.dom.pad(),CT.dom.link("2 subclassed",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/web/dez_server/daemons.py",null,null,null,true),CT.dom.pad(),CT.dom.link("HTTPApplication",null,"https://github.com/bubbleboy14/dez/blob/master/dez/http/application.py",null,null,null,true),CT.dom.pad(),CT.dom.span("instances (for regular <b>HTTP</b> and <b>Admin Servers</b>) and a"),CT.dom.pad(),CT.dom.link("Cron Manager",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/web/dez_server/cron.py",null,null,null,true),CT.dom.span(". The controller dynamically loads modules (as specified by <b>app.yaml</b> routing rules) to handle cron jobs and ("),CT.dom.link("all manner of",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/web/dez_server/response.py",null,null,null,true),CT.dom.span(") requests as they come up."),CT.dom.br(),CT.dom.span("At this point you're probably dying to see more, so sneak a peak at the"),CT.dom.pad(),CT.dom.link("blog plugin",null,"/plugins.html#ctblog"),CT.dom.span("'s"),CT.dom.pad(),CT.dom.link("request handler",null,"https://github.com/bubbleboy14/ctblog/blob/master/ctblog/_blog.py",null,null,null,true),CT.dom.span(".")]},{name:"Services",content:[CT.dom.div("Cron","bigger bold pv10"),[CT.dom.span("The"),CT.dom.pad(),CT.dom.link("cron module",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/web/dez_server/cron.py",null,null,null,true),CT.dom.pad(),CT.dom.span("parses the <b>cron.yaml</b> file and schedules the individual jobs accordingly. The <b>YAML</b>-style rules look very similar to those found in <b>app.yaml</b> (the routing config file). Anyway, it should look something like this:")],CT.dom.div(["- description: basic scan",[CT.dom.pad(2),CT.dom.span("url: /cronscan")],[CT.dom.pad(2),CT.dom.span("schedule: every 24 hours")]],"code"),CT.dom.div("Mail","bigger bold pv10"),[CT.dom.span("The"),CT.dom.pad(),CT.dom.link("mail module",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/web/dez_server/mail.py",null,null,null,true),CT.dom.pad(),CT.dom.span("is a minimal wrapper around"),CT.dom.pad(),CT.dom.link("yagmail",null,"https://github.com/kootenpv/yagmail",null,null,null,true),CT.dom.span(". To enable mailing, add a sender address to <b>ct.cfg</b>, something like:")],CT.dom.div("MAILER = Robot &lt;robot@yourthing.com&gt;","code"),"Send emails with <b>send_mail</b>():",CT.dom.div(["from cantools.web import send_mail",CT.dom.br(),"send_mail(to='someone@email.com', subject='hello old friend', body='how are you?')"],"code")]},{name:"Javascript",content:["Folks hate Javascript for 2 basic reason: the absence of <b>classes</b> and <b>modules</b>, which constitute the core of most scripting languages; and the auto-open nature of the code, which after all, is directly transmitted by the server. Now don't get me wrong, we're all about open source. We're just not all about vulnerable applications.",CT.dom.div("Modules","bigger bold pv10"),CT.dom.div("CT.require","big pv10"),"The <b>CT.require</b>() function ties it all together by dynamically acquiring modules, <b>AJAX</b>-style. Here are a few examples:",CT.dom.div(["// require a CT package",'CT.require ("CT.map");',CT.dom.br(),"// require some other package",'CT.require ("mything.gizmos");',CT.dom.br(),"// require dynamically -- compiler skips this import",'CT.require ("mything.modes." + modeVar, true);'],"code"),CT.dom.div("CT.scriptImport","big pv10"),"But maybe you want to use some third party library that in turn imports other stuff. Such a library generally determines where to find those other things based on its own location, which is typically derived from its script tag. Without a script tag, all is lost. In these cases, we use <b>CT.scriptImport</b>():",CT.dom.div('CT.scriptImport("http://some.third.party.package.com/whatever.js");',"code"),"<b>CT.require</b>() is synchronous, so you can use the module on the the next line. <b>CT.scriptImport</b>() is asynchronous, so either stick it before the page loads (triggering your main code in an onload callback, for instance via <b>CT.onload</b>()) or include your followup logic in a callback:",CT.dom.div(['CT.scriptImport("http://some.third.party.package.com/whatever.js");',CT.dom.br(),'CT.onload(function() {',[CT.dom.pad(4),CT.dom.span('alert("ready to go!");')],"});"],"code"),"or",CT.dom.div(['CT.scriptImport("http://blah.com/bloop.js", function() {',[CT.dom.pad(4),CT.dom.span('alert("ready to go!");')],"});"],"code"),CT.dom.div("Classes","bigger bold pv10"),"Classes are the crucial ingredient of any object-oriented project, foremost among the grown-up tools today's rich web applications require to make any sense of the data landscape they necessarily must traverse. Use the <b>CT.Class</b>() function to create a class.",CT.dom.div(["Person = CT.Class({",[CT.dom.pad(4),CT.dom.span('CLASSNAME: "MyClass",')],CT.dom.br(),[CT.dom.pad(4),CT.dom.span('init: function(opts) {')],[CT.dom.pad(8),CT.dom.span('this.opts = opts;')],[CT.dom.pad(8),CT.dom.span('this.name = opts.name;')],[CT.dom.pad(4),CT.dom.span('},')],CT.dom.br(),[CT.dom.pad(4),CT.dom.span('doIt: function() {')],[CT.dom.pad(8),CT.dom.span('this.log("we did it! (" + this.name + ")");')],[CT.dom.pad(4),CT.dom.span('}')],"});",CT.dom.br(),'var plorpus = new Person({ name: "plorpus" });','plorpus.doIt();'],"code"),CT.dom.div("Compilation Modes","bigger bold pv10"),[CT.dom.span("We've got 3 compilation modes for ya. Below are the basics (but you'll want to review the"),CT.dom.pad(),CT.dom.link("ctdeploy module",null,"/docs#deploy"),CT.dom.pad(),CT.dom.span("for deets).")],CT.dom.div("dynamic","big pv10"),"In dynamic, or development mode, your application is loaded in chunks as <b>CT.require</b>() statements are encountered. Your site won't load as quickly as in the other modes, but does not require recompilation to reflect the latest changes.",CT.dom.div("static","big pv10"),"In static, or debug mode, all non-dynamic imports (<b>CT.require</b>() statements) are precompiled into the head as script tags referencing the files. These imports, unlike dynamic imports, play nice with the Chrome debugger, enabling, for instance, the developer to set break points that persist between refreshes. The downside is that any changes to the markup (html files) are <b>not</b> reflected in the served application without a recompile.",CT.dom.div("production","big pv10"),"In production, or garbled mode, all referenced Javascript is compressed, obfuscated, and compiled into the head of each page. Additionally, production-mode applications encode all client-server communications, rendering your app hard to debug and harder to hack."]},{name:"Configuration",content:[CT.dom.div("Client","bigger bold pv10"),[CT.dom.span("The client-side configuration lives in <b>core.config</b>, which is the <b>/js/core/config.js</b> file that is generated by"),CT.dom.pad(),CT.dom.link("ctinit",null,"/docs#init"),CT.dom.pad(),CT.dom.span("on project initialization. It contains the default configuration for each specified plugin, in addition to default (empty) properties used by any page that invokes <b>CT.initCore</b>(): <b>header</b>{}, <b>footer</b>{}, and <b>css</b>[]. The <b>css</b>[] array consists of stylesheet links to be loaded, and <b>header</b>{} / <b>footer</b>{} are passed to the"),CT.dom.pad(),CT.dom.link("layout module",null,"/docs#layout.js"),CT.dom.span(".")],CT.dom.div("Server","bigger bold pv10"),[CT.dom.span("When your application starts up, the"),CT.dom.pad(),CT.dom.link("config module",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/config.py",null,null,null,true),CT.dom.pad(),CT.dom.span("parses the"),CT.dom.pad(),CT.dom.link("default server configuration",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/cfg.py",null,null,null,true),CT.dom.span(". Next, it pulls in each plugin's configuration, as optionally specified by a <b>cfg</b> line in the <b>init.py</b> file found in each plugin. A good example of this can be found in the"),CT.dom.pad(),CT.dom.link("init",null,"https://github.com/bubbleboy14/ctdecide/blob/master/ctdecide/init.py",null,null,null,true),CT.dom.pad(),CT.dom.span("and"),CT.dom.pad(),CT.dom.link("config",null,"https://github.com/bubbleboy14/ctdecide/blob/master/ctdecide/config.py",null,null,null,true),CT.dom.pad(),CT.dom.span("files of the"),CT.dom.pad(),CT.dom.link("decide plugin",null,"/plugins.html#ctdecide"),CT.dom.span(". Once the defaults are all loaded, we finally apply the specific application's configuration from <b>ct.cfg</b>, which will look something like this:")],CT.dom.div(["ENCODE = False","MODE = dynamic","WEB_SERVER = dez","PLUGINS = ctuser"],"code")]},{name:"Logging",content:[CT.dom.div("Client","bigger bold pv10"),[CT.dom.span("Client-side logging is handled by the"),CT.dom.pad(),CT.dom.link("CT.log",null,"/docs#ct.js"),CT.dom.pad(),CT.dom.span("module. As a convenience, a <b>log</b>{} object is added to every application's <b>core.config</b> object. It contains two arrays, <b>include</b>[] and <b>exclude</b>[], which the default <b>core.util</b> passes to <b>CT.log.greg</b>():")],CT.dom.div("CT.log.grep(core.config.log.include, core.config.log.exclude);","code"),CT.dom.div("Server","bigger bold pv10"),"Enable specific logs in your <b>ct.cfg</b> file with the <b>LOG_ALLOW</b> option, something like:",CT.dom.div("LOG_ALLOW = DEGUG|ERROR","code"),"By default, cantools emits <b>info</b>, <b>log</b>, and <b>error</b> messages. One might also desire to persist logs to files. For this, we have a few more config lines to play around with:",CT.dom.div(["WEB_LOG = web.log","ADMIN_LOG = admin.log","PUBSUB_LOG = pubsub.log"],"code")]},{name:"Caching",content:[CT.dom.div("Client","bigger bold pv10"),"Caching is supported in multiple layers of the cantools frontend stack.",CT.dom.div("CT.data","big pv10"),[CT.dom.span("The"),CT.dom.pad(),CT.dom.link("data module",null,"/docs#data.js"),CT.dom.pad(),CT.dom.span("provides functions (<b>get</b>(), <b>add</b>(), <b>addSet</b>(), <b>has</b>()) for maintaining a central set of data for use throughout your application.")],CT.dom.div("CT.net","big pv10"),[CT.dom.span("The"),CT.dom.pad(),CT.dom.link("net module",null,"/docs#ct.js"),CT.dom.pad(),CT.dom.span("supports request caching (default <b>false</b>) via the <b>setCache</b>() function:")],CT.dom.div("CT.net.setCache(true);","code"),"Under the hood, <b>setCache</b>() uses <b>CT.storage</b>.",CT.dom.div("CT.storage","big pv10"),[CT.dom.span("The"),CT.dom.pad(),CT.dom.link("storage module",null,"/docs#storage.js"),CT.dom.pad(),CT.dom.span("is intended for session-level data that must persist across pages. It configurably sits atop either <b>localStorage</b> (the default) or <b>sessionStorage</b> (which we shim for old browsers). By default, it treats your data as JSON and insanely compresses it before filing it away.")],CT.dom.div("Server","bigger bold pv10"),"The server's memcache layer can be accessed through 3 functions found in the <b>web</b> module:",CT.dom.div("from cantools.web import getmem, setmem, clearmem","code"),"Those functions are enough to use memcache, but if you're too lazy even for that, you're gonna love the predefined memcache behaviors.",CT.dom.div("db","big pv10"),[CT.dom.span("The db cache is enabled by default. If all your data transactions are handled through the"),CT.dom.pad(),CT.dom.link("/_db handler",null,"https://github.com/bubbleboy14/cantools/blob/master/cantools/_db.py",null,null,null,true),CT.dom.span(", which itself is used by"),CT.dom.pad(),CT.dom.link("CT.db",null,"/docs#db.js"),CT.dom.span(", this is the setting for you. If you're messing with data elsewhere, you might want to turn it off in your <b>ct.cfg</b> file, like so:")],CT.dom.div("MEMCACHE_DB = False","code"),CT.dom.div("request","big pv10"),"Requests can also be globally cached, but this behavior is disabled by default because it only makes sense if the requests change nothing and always return the same response. If you really want to, you can enable it in <b>ct.cfg</b>:",CT.dom.div("MEMCACHE_REQUEST = True","code"),"Alternatively, you can selectively enable caching per-request by passing <b>cache=True</b> when you call <b>succeed()</b> and using <b>trysavedresponse()</b>:",CT.dom.div(["from cantools.web import respond, cgi_get, succeed, trysavedresponse","from mylogic import get_response",CT.dom.br(),"def response():",[CT.dom.pad(4),CT.dom.span("trysavedresponse()")],[CT.dom.pad(4),CT.dom.span("resp = get_response(cgi_get('whatever_token'))")],[CT.dom.pad(4),CT.dom.span("succeed(resp, cache=True)")],CT.dom.br(),"respond(response)"],"code")]},{name:"Plugins",content:[CT.dom.div("Using Plugins","bigger bold pv10"),[CT.dom.span("To initialize a fresh project with one or more plugins, use"),CT.dom.pad(),CT.dom.link("ctinit",null,"/docs#init"),CT.dom.span("'s <b>-p (--plugins)</b> flag, like so:")],CT.dom.div("~> ctinit mymusicdotcom -p ctunes","code"),"Child's play. But what about adding some new functionality fragment mid-project? No problem, just add the name of the plugin to the <b>PLUGIN_MODULES</b> line in your <b>ct.cfg</b> file and refresh:",CT.dom.div("~/myblogorsomething> ctinit -r","code"),"That's it.",CT.dom.div("Building Plugins","bigger bold pv10"),[CT.dom.span("Building a plugin is easy. You mainly just need one file, <b>init.py</b>. It tells"),CT.dom.pad(),CT.dom.link("ctinit",null,"/docs#init"),CT.dom.pad(),CT.dom.span("how the plugin is supposed to relate to the application. A good example is"),CT.dom.pad(),CT.dom.link("ctblog",null,"/plugins.html#ctblog"),CT.dom.span("'s"),CT.dom.pad(),CT.dom.link("init config",null,"https://github.com/bubbleboy14/ctblog/blob/master/ctblog/init.py",null,null,null,true),CT.dom.span(". If your frontend requires configuration, simply include a <b>config.js</b> file ("),CT.dom.link("ctuser",null,"/plugins.html#ctuser"),CT.dom.span("'s"),CT.dom.pad(),CT.dom.link("configuration",null,"https://github.com/bubbleboy14/ctuser/blob/master/ctuser/js/config.js",null,null,null,true),CT.dom.pad(),CT.dom.span("is a great example), which"),CT.dom.pad(),CT.dom.link("ctinit",null,"/docs#init"),CT.dom.pad(),CT.dom.span("compiles, along with objects for other plugins and general items like <b>header</b>{} and <b>css</b>[], into <b>core.config</b>.")]]},{name:"Admin Dashboard",content:[[CT.dom.span("The admin dashboards run on port 8002 by default (see"),CT.dom.pad(),CT.dom.link("ctinit",null,"/docs#init"),CT.dom.pad(),CT.dom.span("options). You can't get in without the admin password, which you set when you"),CT.dom.pad(),CT.dom.link("run the server",null,"/docs#start"),CT.dom.pad(),CT.dom.span("for the first time.")],CT.dom.div("db","bigger bold pv10"),"Peruse and mess with your data.",CT.dom.div("memcache","bigger bold pv10"),"Review an up-to-the-moment snapshot of your server's memcache.",CT.dom.div("monitor","bigger bold pv10"),"What's your system doing right now? Graphs.",CT.dom.div("pubsub","bigger bold pv10"),"Who's saying what where?",CT.dom.div("logs","bigger bold pv10"),"Explore your logs. It's great!"]}],"ctcontent3","ctlist3 big");});;</script> </head><body><div id="ctheader"></div><div id="ctmain"></div><noscript><div style="position: absolute; left:0px; top:0px;"> This site requires Javascript to function properly. To enable Javascript in your browser, please follow <a href="http://www.google.com/support/bin/answer.py?answer=23852">these instructions</a>. Thank you, and have a nice day. </div></noscript></body></html>